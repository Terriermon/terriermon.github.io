
 <!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>TextKit学习笔记一基本使用 | 次元空间</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="terriermon">
    

    
    <meta name="description" content="一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。 首先看看，使用富文本属性设置多格式字符串.12345678910111213141516171819202122//原始数据字符串NSString *string = @&amp;quot;我是好人我是好人我是个好人额鹅鹅鹅鹅鹅鹅饿哇哇哇哇哇哇哇&amp;quot;;// 创建可变属性化字符串NS">
<meta property="og:type" content="article">
<meta property="og:title" content="TextKit学习笔记一基本使用">
<meta property="og:url" content="http://yoursite.com/2017/08/13/TextKit学习笔记一基本使用/index.html">
<meta property="og:site_name" content="次元空间">
<meta property="og:description" content="一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。 首先看看，使用富文本属性设置多格式字符串.12345678910111213141516171819202122//原始数据字符串NSString *string = @&amp;quot;我是好人我是好人我是个好人额鹅鹅鹅鹅鹅鹅饿哇哇哇哇哇哇哇&amp;quot;;// 创建可变属性化字符串NS">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://m1.yea.im/2Iz.png">
<meta property="og:image" content="http://i3.tietuku.com/07926cd5b5f028b1.png">
<meta property="og:updated_time" content="2019-04-08T13:53:54.637Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TextKit学习笔记一基本使用">
<meta name="twitter:description" content="一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。 首先看看，使用富文本属性设置多格式字符串.12345678910111213141516171819202122//原始数据字符串NSString *string = @&amp;quot;我是好人我是好人我是个好人额鹅鹅鹅鹅鹅鹅饿哇哇哇哇哇哇哇&amp;quot;;// 创建可变属性化字符串NS">
<meta name="twitter:image" content="http://m1.yea.im/2Iz.png">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/courage.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/courage.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="次元空间" title="次元空间"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="次元空间">次元空间</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">异世界的大门</a></li>
					
						<li><a href="/archives">档案岛</a></li>
					
						<li><a href="/about">AboutMe</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search">
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/13/TextKit学习笔记一基本使用/" title="TextKit学习笔记一基本使用" itemprop="url">TextKit学习笔记一基本使用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="terriermon" target="_blank" itemprop="author">terriermon</a>
		
  </p><p class="article-time">
    <time datetime="2017-08-13T15:09:43.000Z" itemprop="datePublished"> Published 2017-08-13</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。"><span class="toc-number">1.</span> <span class="toc-text">一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#首先看看，使用富文本属性设置多格式字符串"><span class="toc-number">2.</span> <span class="toc-text">首先看看，使用富文本属性设置多格式字符串.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TextKit中主要用到的几个Api"><span class="toc-number">3.</span> <span class="toc-text">TextKit中主要用到的几个Api:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo1-实现一个文字个性排版"><span class="toc-number">4.</span> <span class="toc-text">Demo1: 实现一个文字个性排版.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo2-简单实现一个图文混排的demo，效果图如下"><span class="toc-number">5.</span> <span class="toc-text">Demo2: 简单实现一个图文混排的demo，效果图如下:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No1-ViewController中，创建BookView（封装图文混排的view）"><span class="toc-number">6.</span> <span class="toc-text">No1. ViewController中，创建BookView（封装图文混排的view）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No2-BookView内部封装一个TextView实现图文混排"><span class="toc-number">7.</span> <span class="toc-text">No2. BookView内部封装一个TextView实现图文混排</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No3-ExclusionView作为排除文字排版的区域view的容器"><span class="toc-number">8.</span> <span class="toc-text">No3. ExclusionView作为排除文字排版的区域view的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No4-ParagraphAttributes封装段落文字的富文本属性设置项的实体类"><span class="toc-number">9.</span> <span class="toc-text">No4. ParagraphAttributes封装段落文字的富文本属性设置项的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No4-StringAttributeItem封装一个具体的富文本设置项"><span class="toc-number">10.</span> <span class="toc-text">No4. StringAttributeItem封装一个具体的富文本设置项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No5-最后一个搜索关键词，并设置富文本属性改变样式"><span class="toc-number">11.</span> <span class="toc-text">No5. 最后一个搜索关键词，并设置富文本属性改变样式</span></a></li></ol>
		
		</div>
		
		<h3 id="一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。"><a href="#一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。" class="headerlink" title="一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。"></a>一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。</h3><hr>
<h3 id="首先看看，使用富文本属性设置多格式字符串"><a href="#首先看看，使用富文本属性设置多格式字符串" class="headerlink" title="首先看看，使用富文本属性设置多格式字符串."></a>首先看看，使用富文本属性设置多格式字符串.</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//原始数据字符串</span><br><span class="line">NSString *string = @&quot;我是好人我是好人我是个好人额鹅鹅鹅鹅鹅鹅饿哇哇哇哇哇哇哇&quot;;</span><br><span class="line"></span><br><span class="line">// 创建可变属性化字符串</span><br><span class="line">NSMutableAttributedString *attrString = [[NSMutableAttributedString alloc] initWithString:string];</span><br><span class="line"></span><br><span class="line">//改变字符串当中从第18位置向后的10位数的字体</span><br><span class="line">UIFont *smallFont = [UIFont systemFontOfSize:30];</span><br><span class="line">[attrString addAttribute:NSFontAttributeName</span><br><span class="line">value:smallFont</span><br><span class="line">range:NSMakeRange(5, 10)];</span><br><span class="line"></span><br><span class="line">//改变字符串当中第一个“1”的颜色</span><br><span class="line">UIColor *rcolor = [UIColor redColor];</span><br><span class="line">[attrString addAttribute:NSForegroundColorAttributeName</span><br><span class="line">value:rcolor</span><br><span class="line">range:[string rangeOfString:@&quot;是&quot;]];</span><br><span class="line"></span><br><span class="line">UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(20, 44, 320, 200)];</span><br><span class="line">label.numberOfLines = 0;</span><br><span class="line">[self.view addSubview:label];</span><br><span class="line">label.attributedText = attrString;</span><br></pre></td></tr></table></figure>
<p>小结富文本字符串属性三个东西:</p>
<ol>
<li><p>要设置的富文本属性名字. 【如: NSForegroundColorAttributeName颜色】</p>
</li>
<li><p>要设置的富文本属性对应的值.【如: [UIColor redColor]】</p>
</li>
<li><p>上如富文本设置对应的范围. [如:[string rangeOfString:@”是”]]</p>
</li>
</ol>
<p>也就是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. attribute key</span><br><span class="line">2. attribute value</span><br><span class="line">3. range</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="TextKit中主要用到的几个Api"><a href="#TextKit中主要用到的几个Api" class="headerlink" title="TextKit中主要用到的几个Api:"></a>TextKit中主要用到的几个Api:</h3><ul>
<li><p><strong>NSTextStorage</strong>对象 ， 表示存储一段需要被处理的原始文本字符串和一些富文本属性设置项（NSAttributeString）</p>
</li>
<li><p><strong>NSLayoutManager</strong>对象 ，文字排版布局管理</p>
</li>
<li><p><strong>NSTextContainer</strong>对象 ，决定能够显示内容的区域</p>
</li>
<li><p><strong>NSAttributeString</strong>， <strong>NSMUtableAttrinuteString</strong>，<strong>NSParagraphStyle</strong> ….等等一些富文本基本设置key</p>
</li>
</ul>
<hr>
<h3 id="Demo1-实现一个文字个性排版"><a href="#Demo1-实现一个文字个性排版" class="headerlink" title="Demo1: 实现一个文字个性排版."></a>Demo1: 实现一个文字个性排版.</h3><ul>
<li>第一步:创建textView</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">[super viewDidLoad];</span><br><span class="line"></span><br><span class="line">self.title = @&quot;关于我们&quot;;</span><br><span class="line"></span><br><span class="line">[self createTextView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第二步:创建TextView时，创建NSTextContainer</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)createTextView &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_textView = [[UITextView alloc] initWithFrame:CGRectMake(20, CGRectGetMaxY(self.lebel.frame) + 30, SCREEN_WIDTH-40, CGRectGetMaxY(self.view.frame)-CGRectGetMaxY(_lebel.frame)) textContainer:self.textContainer];</span><br><span class="line"></span><br><span class="line">_textView.scrollEnabled                    = YES;</span><br><span class="line">_textView.editable                         = NO;</span><br><span class="line">_textView.selectable                       = NO;</span><br><span class="line">_textView.layer.masksToBounds              = YES;</span><br><span class="line">_textView.showsVerticalScrollIndicator     = NO;</span><br><span class="line">//    _textView.delegate                         = self;</span><br><span class="line"></span><br><span class="line">[self.view addSubview:_textView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第三步:创建NSTextContainer时，同时创建NSTextStorage、NSLayoutManager</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (NSTextContainer *)textContainer &#123;</span><br><span class="line"></span><br><span class="line">NSString *text = @&quot;我加金融是深圳中顺易金融服务有限公司（以下简称“中顺易”）打造的互联网信托平台，致力于为客户提供投资理财、消费信托、社区金融等多元化金融产品和创新消费服务。\n中顺易公司由由中信信托有限责任公司、顺丰速运(集团)有限公司、杭州网易投资有限公司联合发起设立，注册资本10亿元。\n基于互联网+、发展普惠金融、扩大消费等国家战略，秉承三家股东公司在信托金融服务、现代物流服务和互联网技术创新方面的优势，中顺易通过互联网信息技术，有效整合资金流、信息流和物流，为用户提供稳健收益、品质消费的互联网金融产品和服务。&quot;;</span><br><span class="line"></span><br><span class="line">_textStorage = [[NSTextStorage alloc] initWithString:text attributes:self.paragraphyDict];</span><br><span class="line"></span><br><span class="line">_layoutManager = [[NSLayoutManager alloc] init];</span><br><span class="line">[_textStorage addLayoutManager:_layoutManager];</span><br><span class="line"></span><br><span class="line">_textContainer = [[NSTextContainer alloc] init];</span><br><span class="line">CGFloat width  = SCREEN_WIDTH - 20 * 2;</span><br><span class="line">CGSize size = CGSizeMake(width, MAXFLOAT);</span><br><span class="line">_textContainer.size = size;</span><br><span class="line"></span><br><span class="line">[_layoutManager addTextContainer:_textContainer];</span><br><span class="line"></span><br><span class="line">return _textContainer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第四步，创建告诉TextKit如何排版TextView内容的<code>富文本属性字典</code>.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (NSDictionary *)paragraphyDict &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NSMutableDictionary *attributes = [NSMutableDictionary dictionary];</span><br><span class="line"></span><br><span class="line">UIColor *textColor = [UIColor hexString:@&quot;#666666&quot;];</span><br><span class="line">[attributes setValue:textColor forKey:NSForegroundColorAttributeName];</span><br><span class="line"></span><br><span class="line">UIFont *textFont = [UIFont systemFontOfSize:13.f];</span><br><span class="line">[attributes setValue:textFont forKey:NSFontAttributeName];</span><br><span class="line"></span><br><span class="line">//创建段落样式</span><br><span class="line">[attributes setValue:[self style] forKey:NSParagraphStyleAttributeName];</span><br><span class="line"></span><br><span class="line">return attributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第五步、由上调用得到一个<code>段落样式</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableParagraphStyle *)style &#123;</span><br><span class="line"></span><br><span class="line">NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc] init];</span><br><span class="line"></span><br><span class="line">style.lineSpacing = 8.5f;</span><br><span class="line">style.paragraphSpacing = 25.f;</span><br><span class="line">style.firstLineHeadIndent = 20.f;</span><br><span class="line"></span><br><span class="line">return style;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>最终效果图示</li>
</ul>
<p><img src="http://m1.yea.im/2Iz.png" alt="效果图"></p>
<ul>
<li>小结下关于<code>NSMutableParagraphStyle段落样式</code>的所有属性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// 段落的风格（设置首行，行间距，对齐方式什么的）看自己需要什么属性，写什么  </span><br><span class="line"></span><br><span class="line">NSMutableParagraphStyle *paragraphStyle = [[NSMutableParagraphStyle alloc] init];  </span><br><span class="line"></span><br><span class="line">// 字体的行间距</span><br><span class="line">paragraphStyle.lineSpacing = 10;  </span><br><span class="line"></span><br><span class="line">//首行缩进  </span><br><span class="line">paragraphStyle.firstLineHeadIndent = 20.0f;</span><br><span class="line"></span><br><span class="line">//段头缩进(首行除外) </span><br><span class="line">paragraphStyle.headIndent = 20;</span><br><span class="line"></span><br><span class="line">//段尾缩进</span><br><span class="line">paragraphStyle.tailIndent = 20;</span><br><span class="line"></span><br><span class="line">//（两端对齐的）文本对齐方式：（左，中，右，两端对齐，自然）  </span><br><span class="line">paragraphStyle.alignment = NSTextAlignmentJustified;</span><br><span class="line"></span><br><span class="line">//结尾（还有头部、中间）部分的内容以……方式省略 ( &quot;...wxyz&quot; ,&quot;abcd...&quot; ,&quot;ab...yz&quot;) </span><br><span class="line">paragraphStyle.lineBreakMode = NSLineBreakByTruncatingTail;</span><br><span class="line"></span><br><span class="line">//最低行高</span><br><span class="line">paragraphStyle.minimumLineHeight = 10;  </span><br><span class="line"></span><br><span class="line">//最大行高</span><br><span class="line">paragraphStyle.maximumLineHeight = 20;  </span><br><span class="line"></span><br><span class="line">//段与段之间的间距  </span><br><span class="line">paragraphStyle.paragraphSpacing = 15;</span><br><span class="line"></span><br><span class="line">//段首行空白空间</span><br><span class="line">paragraphStyle.paragraphSpacingBefore = 22.0f;</span><br><span class="line"></span><br><span class="line">//从左到右的书写方向（还有其他方向）</span><br><span class="line">paragraphStyle.baseWritingDirection = NSWritingDirectionLeftToRight;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">paragraphStyle.lineHeightMultiple = 15;</span><br><span class="line"></span><br><span class="line">//连字属性 在iOS，唯一支持的值分别为0和1 </span><br><span class="line">paragraphStyle.hyphenationFactor = 1;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Demo2-简单实现一个图文混排的demo，效果图如下"><a href="#Demo2-简单实现一个图文混排的demo，效果图如下" class="headerlink" title="Demo2: 简单实现一个图文混排的demo，效果图如下:"></a>Demo2: 简单实现一个图文混排的demo，效果图如下:</h3><p><img src="http://i3.tietuku.com/07926cd5b5f028b1.png" alt></p>
<hr>
<h3 id="No1-ViewController中，创建BookView（封装图文混排的view）"><a href="#No1-ViewController中，创建BookView（封装图文混排的view）" class="headerlink" title="No1. ViewController中，创建BookView（封装图文混排的view）"></a>No1. ViewController中，创建BookView（封装图文混排的view）</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setupBookView &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1. 创建BookView</span></span><br><span class="line">_bookView = [[BookView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, Width<span class="number">-20</span>, <span class="keyword">self</span>.view.frame.size.height - <span class="number">10</span>)];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:_bookView];</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 设置BookView要显示的文字</span></span><br><span class="line">_bookView.text = _text;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 设置BookView段落样式字典</span></span><br><span class="line">_bookView.paregaphyAttributeArgument = [ParagraphAttributes paragraphStyle1];</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 设置BookView富文本属性</span></span><br><span class="line">_bookView.attributeStringArray = @[</span><br><span class="line"></span><br><span class="line"><span class="comment">//字体颜色                            </span></span><br><span class="line">[StringAttributeItem foregroundColor:[<span class="built_in">UIColor</span> blackColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">9</span>)],</span><br><span class="line"></span><br><span class="line"><span class="comment">//字体大小、字体样式                                      </span></span><br><span class="line">[StringAttributeItem font:[<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">22.0</span>f] range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">9</span>)]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//5. 设置BookView不让文字排版的区域</span></span><br><span class="line"><span class="comment">//每一个排除的区域，使用一个 ExclusionView 表示</span></span><br><span class="line">ExclusionView *excludeView = [[ExclusionView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">150</span>, <span class="number">200</span>, <span class="number">150</span>)];</span><br><span class="line"><span class="keyword">self</span>.bookView.exclusionViews = @[excludeView];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView       = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:excludeView.bounds];</span><br><span class="line">imageView.image              = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"image"</span>];</span><br><span class="line">[excludeView addSubview:imageView];</span><br><span class="line"></span><br><span class="line"><span class="comment">//6. 创建BookView内部的TextView，并设置排版</span></span><br><span class="line">[<span class="keyword">self</span>.bookView createSubviews];</span><br><span class="line"></span><br><span class="line"><span class="comment">//..</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:_bookView];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="No2-BookView内部封装一个TextView实现图文混排"><a href="#No2-BookView内部封装一个TextView实现图文混排" class="headerlink" title="No2. BookView内部封装一个TextView实现图文混排"></a>No2. BookView内部封装一个TextView实现图文混排</h3><p>BookView.h</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BookView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//显示的文字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"></span><br><span class="line"><span class="comment">//段落设置</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSDictionary</span> *paregaphyAttributeArgument;</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSAttrribute数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *attributeStringArray;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储的图文混排的views</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)   <span class="built_in">NSArray</span>        *exclusionViews;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建内部TextView，开始图文混排</span></span><br><span class="line">- (<span class="keyword">void</span>)createSubviews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>BookView.m</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//创建UITextView</span></span><br><span class="line">- (<span class="keyword">void</span>)createSubviews &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.</span></span><br><span class="line">[<span class="keyword">self</span> textStorage];</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.</span></span><br><span class="line">[<span class="keyword">self</span> configAllAttributeStringOptions];</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.</span></span><br><span class="line">[<span class="keyword">self</span> layoutManager];</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.</span></span><br><span class="line">[<span class="keyword">self</span> textContainer];</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.</span></span><br><span class="line">_textView = [<span class="keyword">self</span> textView];</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.</span></span><br><span class="line">[<span class="keyword">self</span> markWord:<span class="string">@"汉子"</span> inTextStorage:<span class="keyword">self</span>.textStorage];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建文本容器 NSTextStorage， 并设置段落样式</span></span><br><span class="line">- (<span class="built_in">NSTextStorage</span> *)textStorage &#123;</span><br><span class="line"><span class="keyword">if</span> (!_textStorage) &#123;</span><br><span class="line">_textStorage = [[<span class="built_in">NSTextStorage</span> alloc] initWithString:<span class="keyword">self</span>.text</span><br><span class="line">attributes:<span class="keyword">self</span>.paregaphyAttributeArgument];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _textStorage;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给textStorage设置富文本属性</span></span><br><span class="line">- (<span class="keyword">void</span>)configAllAttributeStringOptions &#123;</span><br><span class="line"><span class="keyword">for</span> (StringAttributeItem *item <span class="keyword">in</span> <span class="keyword">self</span>.attributeStringArray) &#123;</span><br><span class="line">[<span class="keyword">self</span>.textStorage addAttribute:[item attributeKey]</span><br><span class="line">value:[item value]</span><br><span class="line">range:[item range]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSLayoutManager</span> *)layoutManager &#123;</span><br><span class="line"><span class="keyword">if</span> (!_layoutManager) &#123;</span><br><span class="line"></span><br><span class="line">_layoutManager = [[<span class="built_in">NSLayoutManager</span> alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.textStorage addLayoutManager:<span class="keyword">self</span>.layoutManager];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _layoutManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置可以显示的区域</span></span><br><span class="line">- (<span class="built_in">NSTextContainer</span> *)textContainer &#123;</span><br><span class="line"><span class="keyword">if</span> (!_textContainer) &#123;</span><br><span class="line"></span><br><span class="line">_textContainer = [[<span class="built_in">NSTextContainer</span> alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> width  = <span class="keyword">self</span>.frame.size.width;</span><br><span class="line"><span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(width, MAXFLOAT);<span class="comment">//TextView无限制向下显示</span></span><br><span class="line">_textContainer.size = size;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.layoutManager addTextContainer:_textContainer];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _textContainer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _textContainer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给TextView添加带有内容和布局的容器</span></span><br><span class="line">- (<span class="built_in">UITextView</span> *)textView &#123;</span><br><span class="line"><span class="keyword">if</span> (!_textView) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 NSTextContainer对象，创建出UITextView， 控制显示区域</span></span><br><span class="line">_textView = [[<span class="built_in">UITextView</span> alloc] initWithFrame:<span class="keyword">self</span>.frame</span><br><span class="line">textContainer:<span class="keyword">self</span>.textContainer];</span><br><span class="line"></span><br><span class="line">_textView.scrollEnabled                    = <span class="literal">YES</span>;</span><br><span class="line">_textView.editable                         = <span class="literal">NO</span>;</span><br><span class="line">_textView.selectable                       = <span class="literal">NO</span>;</span><br><span class="line">_textView.layer.masksToBounds              = <span class="literal">YES</span>;</span><br><span class="line">_textView.showsVerticalScrollIndicator     = <span class="literal">NO</span>;</span><br><span class="line">_textView.delegate                         = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重要: 设置不让文字排版的view所在区域</span></span><br><span class="line">[<span class="keyword">self</span> configExcludeViews:_textView];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span> addSubview:_textView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _textView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将不让文字排版区域的path都保存下来，设置给TextContainer</span></span><br><span class="line">- (<span class="keyword">void</span>)configExcludeViews:(<span class="built_in">UITextView</span> *)textView &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((!<span class="keyword">self</span>.exclusionViews) || (<span class="keyword">self</span>.exclusionViews.count == <span class="number">0</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableArray</span> *excludePaths = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:<span class="keyword">self</span>.exclusionViews.count];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (ExclusionView *excludeView <span class="keyword">in</span> <span class="keyword">self</span>.exclusionViews) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将排除不显示文字的view依次加入到 _textView</span></span><br><span class="line">[textView addSubview:excludeView];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIBezierPath</span> *bezierPath = [excludeView createExcludeBezierPathWithSelf];</span><br><span class="line">[excludePaths addObject:bezierPath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将不显示文字的区域，设置给 textView.textContainer</span></span><br><span class="line"><span class="keyword">self</span>.textContainer.exclusionPaths = excludePaths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="No3-ExclusionView作为排除文字排版的区域view的容器"><a href="#No3-ExclusionView作为排除文字排版的区域view的容器" class="headerlink" title="No3. ExclusionView作为排除文字排版的区域view的容器"></a>No3. ExclusionView作为排除文字排版的区域view的容器</h3><p>//.h</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ExclusionView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据自身的frame构造处UIBezierPath边界</span></span><br><span class="line">- (<span class="built_in">UIBezierPath</span> *)createExcludeBezierPathWithSelf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>//.m</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ExclusionView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIBezierPath</span> *)createExcludeBezierPathWithSelf &#123;</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIBezierPath</span> bezierPathWithRect:<span class="keyword">self</span>.frame];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="No4-ParagraphAttributes封装段落文字的富文本属性设置项的实体类"><a href="#No4-ParagraphAttributes封装段落文字的富文本属性设置项的实体类" class="headerlink" title="No4. ParagraphAttributes封装段落文字的富文本属性设置项的实体类"></a>No4. ParagraphAttributes封装段落文字的富文本属性设置项的实体类</h3><p>.h</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ParagraphAttributes</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//实体属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIColor</span> *textColor;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIFont</span> *textFont;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> textPadding;<span class="comment">//文字之间的间距</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSNumber</span> *perLinePadding;<span class="comment">//行之间的间距</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSNumber</span> *paragraphPadding;<span class="comment">//段落之间的间距</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSNumber</span> *firstLineInParagraphPadding;<span class="comment">//每一个段落第一行缩进距离</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//将实体属性，封装成富文本属性的NSDictionary</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)createAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//一个工厂方法获取对象的分类</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ParagraphAttributes</span> (<span class="title">Factory</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSDictionary</span> *)paragraphStyle1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>.m</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ParagraphAttributes</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)createAttributes &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *attributes = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line"></span><br><span class="line"><span class="comment">//字体颜色</span></span><br><span class="line"><span class="built_in">UIColor</span> *textColor = <span class="keyword">self</span>.textColor ? <span class="keyword">self</span>.textColor : [ParagraphConfig default_textColor];</span><br><span class="line">[attributes setValue:textColor forKey:<span class="built_in">NSForegroundColorAttributeName</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//字体样式</span></span><br><span class="line"><span class="built_in">UIFont</span> *textFont = <span class="keyword">self</span>.textFont ? <span class="keyword">self</span>.textFont : [ParagraphConfig default_textFont];</span><br><span class="line">[attributes setValue:textFont forKey:<span class="built_in">NSFontAttributeName</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//段落样式构造，使用一个单独的函数写</span></span><br><span class="line">[attributes setValue:[<span class="keyword">self</span> paragraphStyle] forKey:<span class="built_in">NSParagraphStyleAttributeName</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//每个字的间距</span></span><br><span class="line"><span class="built_in">NSNumber</span> *kern = (<span class="keyword">self</span>.textPadding &lt;=<span class="number">0</span>)?@([ParagraphConfig default_textPadding]):@(<span class="keyword">self</span>.textPadding);</span><br><span class="line">[attributes setValue:kern forKey:<span class="built_in">NSKernAttributeName</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> attributes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableParagraphStyle</span> *)paragraphStyle &#123;</span><br><span class="line"><span class="built_in">NSMutableParagraphStyle</span> *style = [[<span class="built_in">NSMutableParagraphStyle</span> alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">//行间距</span></span><br><span class="line">style.lineSpacing = <span class="keyword">self</span>.perLinePadding?<span class="keyword">self</span>.perLinePadding.floatValue:[ParagraphConfig default_linePadding];</span><br><span class="line"></span><br><span class="line"><span class="comment">//段落间距</span></span><br><span class="line">style.paragraphSpacing = <span class="keyword">self</span>.paragraphPadding?<span class="keyword">self</span>.paragraphPadding.floatValue:[ParagraphConfig default_paragraphPadding];</span><br><span class="line"></span><br><span class="line"><span class="comment">//段落首航缩进</span></span><br><span class="line">style.firstLineHeadIndent = <span class="keyword">self</span>.firstLineInParagraphPadding?<span class="keyword">self</span>.firstLineInParagraphPadding.floatValue:[ParagraphConfig default_FirLinePadding];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> style;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//分类</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ParagraphAttributes</span> (<span class="title">Factory</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//提供一个快速得到一个对象的工厂方法</span></span><br><span class="line">+ (<span class="built_in">NSDictionary</span> *)paragraphStyle1 &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1. 创建实体类对象</span></span><br><span class="line">ParagraphAttributes *style = [[ParagraphAttributes alloc] init];</span><br><span class="line"></span><br><span class="line">style.textColor = READ_WORD_COLOR;</span><br><span class="line">style.textFont = [<span class="built_in">UIFont</span> fontWithName:<span class="string">@"FZQKBYSJW--GB1-0"</span> size:<span class="number">22.</span>f];</span><br><span class="line">style.textPadding = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">style.perLinePadding = @(<span class="number">10</span>);</span><br><span class="line">style.paragraphPadding = @(<span class="number">40</span>);</span><br><span class="line">style.firstLineInParagraphPadding = @(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 打包成富文本属性字典，返回出去</span></span><br><span class="line"><span class="keyword">id</span> styleDict = [style createAttributes];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> styleDict;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="No4-StringAttributeItem封装一个具体的富文本设置项"><a href="#No4-StringAttributeItem封装一个具体的富文本设置项" class="headerlink" title="No4. StringAttributeItem封装一个具体的富文本设置项"></a>No4. StringAttributeItem封装一个具体的富文本设置项</h3><p>.h</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StringAttributeItem</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *attributeKey;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="keyword">id</span> value;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSRange</span> range;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通用配置</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)attributeItemWithKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">Value:(<span class="keyword">id</span>)value</span><br><span class="line">Range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置字体</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)font:(<span class="built_in">UIFont</span> *)font</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置字体颜色</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)foregroundColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置字体背景颜色</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)backgroundColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字体描边颜色</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)strokeColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字体描边宽度</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)strokeWidth:(<span class="keyword">float</span>)number</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置字体阴影</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)shadow:(<span class="built_in">NSShadow</span> *)shadow</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置文字的中划线</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)strikethroughStyle:(<span class="built_in">NSInteger</span>)number</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置文字的下划线</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)underlineStyle:(<span class="built_in">NSInteger</span>)number</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字间距</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)kern:(<span class="keyword">float</span>)number</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 段落样式(需要将UILabel中的numberOfLines设置成0才有用)</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)paragraphStyle:(<span class="built_in">NSMutableParagraphStyle</span> *)style</span><br><span class="line">range:(<span class="built_in">NSRange</span>)range;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>.m </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//举一个方法</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)strokeColor:(<span class="built_in">UIColor</span> *)color range:(<span class="built_in">NSRange</span>)range &#123;</span><br><span class="line">StringAttributeItem *config = [<span class="keyword">self</span> new];</span><br><span class="line"></span><br><span class="line"><span class="comment">//1. key   </span></span><br><span class="line">config.attributeKey = <span class="built_in">NSStrokeColorAttributeName</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 对应的配置对象</span></span><br><span class="line">config.value = color;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 区域</span></span><br><span class="line">config.range = range;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> config;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="No5-最后一个搜索关键词，并设置富文本属性改变样式"><a href="#No5-最后一个搜索关键词，并设置富文本属性改变样式" class="headerlink" title="No5. 最后一个搜索关键词，并设置富文本属性改变样式"></a>No5. 最后一个搜索关键词，并设置富文本属性改变样式</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) markWord:(<span class="built_in">NSString</span>*)word inTextStorage:(<span class="built_in">NSTextStorage</span>*)textStorage</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//1. regx</span></span><br><span class="line"><span class="built_in">NSRegularExpression</span> *regex = [<span class="built_in">NSRegularExpression</span> regularExpressionWithPattern:word</span><br><span class="line">options:<span class="number">0</span></span><br><span class="line">error:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 查找到单词的位置</span></span><br><span class="line"><span class="built_in">NSArray</span> *matches = [regex matchesInString:<span class="keyword">self</span>.textView.text</span><br><span class="line">options:<span class="number">0</span></span><br><span class="line">range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, [<span class="keyword">self</span>.textView.text length])];</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 设置文字效果</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSTextCheckingResult</span> *match <span class="keyword">in</span> matches) &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSRange</span> matchRange = [match range];</span><br><span class="line"></span><br><span class="line"><span class="comment">//storage添加属性字符串设置</span></span><br><span class="line">[textStorage addAttribute:<span class="built_in">NSForegroundColorAttributeName</span></span><br><span class="line">value:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">range:matchRange];</span><br><span class="line"></span><br><span class="line">[textStorage addAttribute:<span class="built_in">NSFontAttributeName</span></span><br><span class="line">value:[<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">22.0</span>f]</span><br><span class="line">range:matchRange];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2017/08/13/TextKit学习笔记一基本使用/" data-title="TextKit学习笔记一基本使用 | 次元空间" data-tsina class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/2017/08/20/git使用遇到的问题/" title="git使用遇到的问题">
  <strong>上一篇：</strong><br>
  <span>
  git使用遇到的问题</span>
</a>
</div>


<div class="next">
<a href="/2017/08/12/Autolayout3/" title="Autolayout3">
 <strong>下一篇：</strong><br> 
 <span>Autolayout3
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2017/08/13/TextKit学习笔记一基本使用/" data-title="TextKit学习笔记一基本使用" data-url="http://yoursite.com/2017/08/13/TextKit学习笔记一基本使用/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。"><span class="toc-number">1.</span> <span class="toc-text">一直都是使用别人封装的框架完成的图文混排，于是今天自己学习一下图文混排的简单实现原理，使用ios7的TextKit。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#首先看看，使用富文本属性设置多格式字符串"><span class="toc-number">2.</span> <span class="toc-text">首先看看，使用富文本属性设置多格式字符串.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TextKit中主要用到的几个Api"><span class="toc-number">3.</span> <span class="toc-text">TextKit中主要用到的几个Api:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo1-实现一个文字个性排版"><span class="toc-number">4.</span> <span class="toc-text">Demo1: 实现一个文字个性排版.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo2-简单实现一个图文混排的demo，效果图如下"><span class="toc-number">5.</span> <span class="toc-text">Demo2: 简单实现一个图文混排的demo，效果图如下:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No1-ViewController中，创建BookView（封装图文混排的view）"><span class="toc-number">6.</span> <span class="toc-text">No1. ViewController中，创建BookView（封装图文混排的view）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No2-BookView内部封装一个TextView实现图文混排"><span class="toc-number">7.</span> <span class="toc-text">No2. BookView内部封装一个TextView实现图文混排</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No3-ExclusionView作为排除文字排版的区域view的容器"><span class="toc-number">8.</span> <span class="toc-text">No3. ExclusionView作为排除文字排版的区域view的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No4-ParagraphAttributes封装段落文字的富文本属性设置项的实体类"><span class="toc-number">9.</span> <span class="toc-text">No4. ParagraphAttributes封装段落文字的富文本属性设置项的实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No4-StringAttributeItem封装一个具体的富文本设置项"><span class="toc-number">10.</span> <span class="toc-text">No4. StringAttributeItem封装一个具体的富文本设置项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No5-最后一个搜索关键词，并设置富文本属性改变样式"><span class="toc-number">11.</span> <span class="toc-text">No5. 最后一个搜索关键词，并设置富文本属性改变样式</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  

  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 业精于勤而荒于嬉，行成于思而毁于随 <br>
			天空不曾流过痕迹，但鸟儿已飞过天空</p>
	</section>
	 
	<div class="social-font">
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:codermoe@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="terriermon">terriermon</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"codermoe"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 









<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77667620-1', '');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
