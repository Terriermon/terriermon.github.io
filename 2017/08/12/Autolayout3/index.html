
 <!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>Autolayout3 | 次元空间</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="terriermon">
    

    
    <meta name="description" content="Masonry使用记录一 使用Masonry完成如下例子 例子1、UILabel高度动态变化、以及动态改变UIView的高度  例子2、动态的添加UIView  例子3、UIScrollView  例子4、键盘上方的ToolBar工具栏  例子5、Alert    大概步骤: 第一步、创建subviews对象，添加到superView  第二步、设置一些不会变化的subviews的约束  第三步、">
<meta property="og:type" content="article">
<meta property="og:title" content="Autolayout3">
<meta property="og:url" content="http://yoursite.com/2017/08/12/Autolayout3/index.html">
<meta property="og:site_name" content="次元空间">
<meta property="og:description" content="Masonry使用记录一 使用Masonry完成如下例子 例子1、UILabel高度动态变化、以及动态改变UIView的高度  例子2、动态的添加UIView  例子3、UIScrollView  例子4、键盘上方的ToolBar工具栏  例子5、Alert    大概步骤: 第一步、创建subviews对象，添加到superView  第二步、设置一些不会变化的subviews的约束  第三步、">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://i5.tietuku.com/52e1d12e9832f24c.png">
<meta property="og:image" content="http://i5.tietuku.com/7e406fdefd2148f1.png">
<meta property="og:image" content="http://i5.tietuku.com/9d65ddc1a958898b.png">
<meta property="og:image" content="http://i5.tietuku.com/e2b8a812a5aeca81.png">
<meta property="og:image" content="http://i5.tietuku.com/8b91d0a931999c80.png">
<meta property="og:image" content="http://i5.tietuku.com/e9836ca12ceebb5f.png">
<meta property="og:image" content="http://i5.tietuku.com/ff9d7cd2fd143181.png">
<meta property="og:image" content="http://i5.tietuku.com/587146ae51261274.png">
<meta property="og:image" content="http://i5.tietuku.com/05fdcd0661d56497.jpg">
<meta property="og:updated_time" content="2019-04-08T13:44:50.968Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Autolayout3">
<meta name="twitter:description" content="Masonry使用记录一 使用Masonry完成如下例子 例子1、UILabel高度动态变化、以及动态改变UIView的高度  例子2、动态的添加UIView  例子3、UIScrollView  例子4、键盘上方的ToolBar工具栏  例子5、Alert    大概步骤: 第一步、创建subviews对象，添加到superView  第二步、设置一些不会变化的subviews的约束  第三步、">
<meta name="twitter:image" content="http://i5.tietuku.com/52e1d12e9832f24c.png">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/courage.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/courage.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="次元空间" title="次元空间"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="次元空间">次元空间</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">异世界的大门</a></li>
					
						<li><a href="/archives">档案岛</a></li>
					
						<li><a href="/about">AboutMe</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search">
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/12/Autolayout3/" title="Autolayout3" itemprop="url">Autolayout3</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="terriermon" target="_blank" itemprop="author">terriermon</a>
		
  </p><p class="article-time">
    <time datetime="2017-08-12T03:00:04.000Z" itemprop="datePublished"> Published 2017-08-12</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Masonry使用记录一"><span class="toc-number">1.</span> <span class="toc-text">Masonry使用记录一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Masonry完成如下例子"><span class="toc-number">2.</span> <span class="toc-text">使用Masonry完成如下例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大概步骤"><span class="toc-number">3.</span> <span class="toc-text">大概步骤:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子1、UILabel高度动态变化、以及动态改变UIView的高度"><span class="toc-number">4.</span> <span class="toc-text">例子1、UILabel高度动态变化、以及动态改变UIView的高度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图示"><span class="toc-number">4.1.</span> <span class="toc-text">效果图示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现"><span class="toc-number">4.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的"><span class="toc-number">5.</span> <span class="toc-text">例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图"><span class="toc-number">5.1.</span> <span class="toc-text">效果图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现-1"><span class="toc-number">5.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子3、ScrollView"><span class="toc-number">6.</span> <span class="toc-text">例子3、ScrollView</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图示效果"><span class="toc-number">6.1.</span> <span class="toc-text">图示效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现-2"><span class="toc-number">6.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子4、键盘上的工具栏"><span class="toc-number">7.</span> <span class="toc-text">例子4、键盘上的工具栏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子5、Alert"><span class="toc-number">8.</span> <span class="toc-text">例子5、Alert</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图示-1"><span class="toc-number">8.1.</span> <span class="toc-text">效果图示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现-3"><span class="toc-number">8.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li></ol>
		
		</div>
		
		<h3 id="Masonry使用记录一"><a href="#Masonry使用记录一" class="headerlink" title="Masonry使用记录一"></a>Masonry使用记录一</h3><hr>
<h3 id="使用Masonry完成如下例子"><a href="#使用Masonry完成如下例子" class="headerlink" title="使用Masonry完成如下例子"></a>使用Masonry完成如下例子</h3><ul>
<li><p>例子1、UILabel高度动态变化、以及动态改变UIView的高度</p>
</li>
<li><p>例子2、动态的添加UIView</p>
</li>
<li><p>例子3、UIScrollView</p>
</li>
<li><p>例子4、键盘上方的ToolBar工具栏</p>
</li>
<li><p>例子5、Alert</p>
</li>
</ul>
<hr>
<h3 id="大概步骤"><a href="#大概步骤" class="headerlink" title="大概步骤:"></a>大概步骤:</h3><ul>
<li><p>第一步、创建subviews对象，添加到superView</p>
</li>
<li><p>第二步、设置一些不会变化的subviews的约束</p>
</li>
<li><p>第三步、声明属性变量或约束对象，来存放要改变的约束的值或直接保存一个约束对象</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eg.1</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) CGFloat middleLabelHeight;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eg.2</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) MASConstraint *middleLabelConstraint</span><br></pre></td></tr></table></figure>
<ul>
<li><p>第四步、需要改变约束一定要在<code>-[UIView updateConstraints]</code>方法里面进行设置</p>
</li>
<li><p>第一种，直接在 <code>-[UIView updateConstraints]</code>设置全部的约束</p>
</li>
<li>第二种，在subviews创建时就设置约束，需要改变的约束使用属性保存起来，然后在<code>-[UIView updateConstraints]</code>修改</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">eg.1 将所有的约束都在回调函数设置</span><br><span class="line"></span><br><span class="line">- (void)updateConstraints &#123;</span><br><span class="line"></span><br><span class="line">[self.middleLabel mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line"></span><br><span class="line">//1. 这些是不会变化值的约束make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.top.mas_equalTo(self.topLabel.mas_bottom).offset(10);</span><br><span class="line"></span><br><span class="line">//2. 如下这个约束的值是会变化的，直接将约束中的值使用变化后的变量值即可</span><br><span class="line">//表示约束优先级普通，一旦约束变化时，可能会影响其他View的布局</span><br><span class="line">//make.height.mas_equalTo(self.middleLabelHeight);</span><br><span class="line">//表示约束优先级较低，不会影响其他View的布局</span><br><span class="line">make.height.mas_equalTo(self.middleLabelHeight).priorityLow();</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//这句必学写</span><br><span class="line">[super updateConstraints];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">eg.2 在回调函数设置只设置部分需要改变的约束</span><br><span class="line"></span><br><span class="line">- (void)updateConstraints &#123;</span><br><span class="line"></span><br><span class="line">//1. 先取消这个约束</span><br><span class="line">[self.middleLabelConstraint uninstall];</span><br><span class="line"></span><br><span class="line">//2. 再使用新的约束</span><br><span class="line">self.middleLabelConstraint.mas_equalTo(self.middleLabelHeight).priorityLow();</span><br><span class="line"></span><br><span class="line">//这句必学写</span><br><span class="line">[super updateConstraints];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第五步、修改约束的值，触发执行动画，会执行<code>-[UIView updateConstraints]</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">eg. </span><br><span class="line"></span><br><span class="line">//1. 改变高度</span><br><span class="line">self.middleLabelHeight = 50.f;</span><br><span class="line"></span><br><span class="line">//2. 更新约束</span><br><span class="line">[self setNeedsUpdateConstraints];</span><br><span class="line">[self updateConstraintsIfNeeded];</span><br><span class="line"></span><br><span class="line">//3. 执行动画</span><br><span class="line">[UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">[self layoutIfNeeded];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="例子1、UILabel高度动态变化、以及动态改变UIView的高度"><a href="#例子1、UILabel高度动态变化、以及动态改变UIView的高度" class="headerlink" title="例子1、UILabel高度动态变化、以及动态改变UIView的高度"></a>例子1、UILabel高度动态变化、以及动态改变UIView的高度</h3><h4 id="效果图示"><a href="#效果图示" class="headerlink" title="效果图示"></a>效果图示</h4><ul>
<li>点击之前</li>
</ul>
<p><img src="http://i5.tietuku.com/52e1d12e9832f24c.png" alt></p>
<ul>
<li>点击之后</li>
</ul>
<p><img src="http://i5.tietuku.com/7e406fdefd2148f1.png" alt></p>
<ul>
<li>点击之后，多出了一个View <code>请填写手机号码</code></li>
</ul>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>代码都在一个单独的UIView子类<code>RootView</code>完成</p>
<ul>
<li><code>RootView.h</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;RootView.h&quot;</span><br><span class="line">#import &lt;Masonry/Masonry.h&gt;</span><br><span class="line">#import &lt;ReactiveCocoa/ReactiveCocoa.h&gt;</span><br><span class="line">#import &lt;ReactiveCocoa/RACEXTScope.h&gt;</span><br><span class="line"></span><br><span class="line">@interface RootView : UIView</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>RootView.m</code> 实现方式1</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@interface RootView ()</span><br><span class="line"></span><br><span class="line">//顶部文字描述的Label</span><br><span class="line">@property (nonatomic, strong) UILabel *topLabel;</span><br><span class="line"></span><br><span class="line">//中间的Label，高度需要动态改变的</span><br><span class="line">@property (nonatomic, strong) UILabel *middleLabel;</span><br><span class="line"></span><br><span class="line">//底部按钮</span><br><span class="line">@property (nonatomic, strong) UIButton *bottmButton;</span><br><span class="line"></span><br><span class="line">//记录改变高度Label的高度值</span><br><span class="line">@property (nonatomic, assign) CGFloat middleLabelHeight;</span><br><span class="line"></span><br><span class="line">//保存中间的Label，高度约束</span><br><span class="line">@property (nonatomic, strong) MASConstraint *middleLabelConstraint;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">@implementation RootView</span><br><span class="line"></span><br><span class="line">- (void)dealloc &#123;</span><br><span class="line">//....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithCoder:(NSCoder *)aDecoder &#123;</span><br><span class="line">self = [super initWithCoder:aDecoder];</span><br><span class="line">if (self) &#123;</span><br><span class="line"></span><br><span class="line">//1. 初始化变量值</span><br><span class="line">[self initVariables];</span><br><span class="line"></span><br><span class="line">//2. 创建Subviews</span><br><span class="line">[self initSubviews];</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//初始化变量值</span><br><span class="line">- (void)initVariables &#123;</span><br><span class="line"></span><br><span class="line">//默认中间Label的高度，开始为0</span><br><span class="line">self.middleLabelHeight = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initSubviews &#123;</span><br><span class="line"></span><br><span class="line">//1. 创建TopLabel，并设置约束</span><br><span class="line">[self initTopLabel];</span><br><span class="line"></span><br><span class="line">//2. 创建MiddleLabel，默认高度为0</span><br><span class="line">[self initMiddleLabel];</span><br><span class="line"></span><br><span class="line">//3. 创建底部按钮</span><br><span class="line">[self initBottmButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initTopLabel &#123;</span><br><span class="line"></span><br><span class="line">self.topLabel = [[UILabel alloc] init];</span><br><span class="line">self.topLabel.layer.borderWidth = 2;</span><br><span class="line"></span><br><span class="line">//必须设置1，Label内容的字体</span><br><span class="line">self.topLabel.font = [UIFont fontWithName:@&quot;HelveticaNeue-Bold&quot; size:17.0f];</span><br><span class="line"></span><br><span class="line">//必须设置2，Label内容自动换行</span><br><span class="line">self.topLabel.numberOfLines = 0;</span><br><span class="line"></span><br><span class="line">//必须设置3，Label内容最大行宽度，才能动态的改变Label高度</span><br><span class="line">self.topLabel.preferredMaxLayoutWidth = [UIScreen mainScreen].bounds.size.width - 2 * 10;</span><br><span class="line"></span><br><span class="line">[self addSubview:self.topLabel];</span><br><span class="line"></span><br><span class="line">self.topLabel.text = @&quot;dawd不阿布速度爱上度噶预算的刮痧油的刮痧油冬瓜意思冬瓜是高端是孤独呀阿哥速度呀A股上移动古雅是够短时孤独感udawd不阿布速度爱上度噶预算的刮痧油的刮痧油冬瓜意思冬瓜是高端是孤独呀阿哥速度呀A股上移动古雅是够短时孤独感udawd不阿布速度爱上度噶预算的刮痧油的刮痧油冬瓜意思冬瓜是高端是孤独呀阿哥速度呀A股上移动古雅是够短时孤独感udawd不阿布速度爱上度噶预算的刮痧油的刮痧油冬瓜意思冬瓜是高端是孤独呀阿哥速度呀A股上移动古雅是够短时孤独感udawd不阿布速度爱上度噶预算的刮痧油的刮痧油冬瓜意思冬瓜是高端是孤独呀阿哥速度呀A股上移动古雅是够短时孤独感udawd不阿布速度爱上度噶预算的刮痧油的刮痧油冬瓜意思冬瓜是高端是孤独呀阿哥速度呀A股上移动古雅是够短时孤独感u&quot;;</span><br><span class="line"></span><br><span class="line">//设置约束</span><br><span class="line">[self.topLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.top.mas_equalTo(self.mas_top).offset(20);</span><br><span class="line"></span><br><span class="line">//注意: 不需要设置高度的约束，因为高度是动态变化的</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initMiddleLabel &#123;</span><br><span class="line"></span><br><span class="line">self.middleLabel = [[UILabel alloc] init];</span><br><span class="line">self.middleLabel.numberOfLines = 1;</span><br><span class="line">self.middleLabel.font = [UIFont fontWithName:@&quot;HelveticaNeue-Bold&quot; size:14.0f];</span><br><span class="line">[self addSubview:self.middleLabel];</span><br><span class="line"></span><br><span class="line">//middleLabel的约束的需要改变，不在此设置约束   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initBottmButton &#123;</span><br><span class="line"></span><br><span class="line">self.bottmButton = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">[self.bottmButton setBackgroundColor:[UIColor lightGrayColor]];</span><br><span class="line">[self.bottmButton setTitle:@&quot;点击改变中间Label的高度&quot; forState:UIControlStateNormal];</span><br><span class="line">[self addSubview:self.bottmButton];</span><br><span class="line"></span><br><span class="line">[self.bottmButton mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.top.mas_equalTo(self.middleLabel.mas_bottom).offset(10);</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.height.mas_equalTo(40);</span><br><span class="line">make.bottom.lessThanOrEqualTo(self.mas_bottom).offset(-10);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//----------------------------------------------------------------------------------</span><br><span class="line">//按钮点击之后，改变middleLabel的高度约束值</span><br><span class="line">@weakify(self);</span><br><span class="line">[[self.bottmButton rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) &#123;</span><br><span class="line">@strongify(self);</span><br><span class="line"></span><br><span class="line">//1. 改变高度</span><br><span class="line">self.middleLabelHeight = 50.f;</span><br><span class="line"></span><br><span class="line">//2. 设置Label显示内容</span><br><span class="line">self.middleLabel.text = @&quot;请填写手机号码...&quot;;</span><br><span class="line"></span><br><span class="line">//3. 通知要更新约束，会执行 -[UIView updateConstraints]方法</span><br><span class="line">[self setNeedsUpdateConstraints];</span><br><span class="line">[self updateConstraintsIfNeeded];</span><br><span class="line"></span><br><span class="line">//4. 约束改变过程，执行动画</span><br><span class="line">[UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">[self layoutIfNeeded];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 更新约束计算Frame</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 改变约束的的View，其约束都需要在该方法中设置</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">- (void)updateConstraints &#123;</span><br><span class="line"></span><br><span class="line">//设置中间Label的约束</span><br><span class="line">[self.middleLabel mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.top.mas_equalTo(self.topLabel.mas_bottom).offset(10);</span><br><span class="line"></span><br><span class="line">//表示约束优先级普通，一旦约束变化时，可能会影响其他View的布局</span><br><span class="line">//make.height.mas_equalTo(self.middleLabelHeight);</span><br><span class="line"></span><br><span class="line">//表示约束优先级较低，不会影响其他View的布局</span><br><span class="line">make.height.mas_equalTo(self.middleLabelHeight).priorityLow();</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//这句必学写</span><br><span class="line">[super updateConstraints];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>RootView.m</code> 实现方式2，主要对上述修改如下几个方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (void)initMiddleLabel &#123;</span><br><span class="line"></span><br><span class="line">self.middleLabel = [[UILabel alloc] init];</span><br><span class="line">self.middleLabel.numberOfLines = 1;</span><br><span class="line">self.middleLabel.font = [UIFont fontWithName:@&quot;HelveticaNeue-Bold&quot; size:14.0f];</span><br><span class="line">[self addSubview:self.middleLabel];</span><br><span class="line"></span><br><span class="line">//保存需要改变的约束对象</span><br><span class="line">[self.middleLabel mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.top.mas_equalTo(self.topLabel.mas_bottom).offset(10);</span><br><span class="line"></span><br><span class="line">//表示约束优先级普通，一旦约束变化时，可能会影响其他View的布局</span><br><span class="line">//make.height.mas_equalTo(self.middleLabelHeight);</span><br><span class="line"></span><br><span class="line">//表示约束优先级较低，不会影响其他View的布局</span><br><span class="line">self.middleLabelConstraint = make.height.mas_equalTo(self.middleLabelHeight).priorityLow();</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//只需要修改需要改变的约束，而不需要改变所有的约束</span><br><span class="line"></span><br><span class="line">- (void)updateConstraints &#123;</span><br><span class="line"></span><br><span class="line">//设置中间Label的约束</span><br><span class="line"></span><br><span class="line">//1. 先取消这个约束</span><br><span class="line">[self.middleLabelConstraint uninstall];</span><br><span class="line"></span><br><span class="line">//2. 再设置新的约束self.middleLabelConstraint.mas_equalTo(self.middleLabelHeight).priorityLow();</span><br><span class="line"></span><br><span class="line">//这句必学写</span><br><span class="line">[super updateConstraints];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的"><a href="#例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的" class="headerlink" title="例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的"></a>例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的</h3><h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><ul>
<li>点击前，只有三个View</li>
</ul>
<p><img src="http://i5.tietuku.com/9d65ddc1a958898b.png" alt></p>
<ul>
<li>点击之后，多出两个View的位置，并且压缩了紫色的高度</li>
</ul>
<p><img src="http://i5.tietuku.com/e2b8a812a5aeca81.png" alt></p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><p>代码都在一个独立的UIView子类<code>DynamicRootView</code>中</p>
<ul>
<li><code>DynamicRootView.h</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@interface DynamicRootView : UIView</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic) UIView *firstView;</span><br><span class="line">@property (strong, nonatomic) UIView *secondtView;</span><br><span class="line">@property (strong, nonatomic) UIView *thirdView;</span><br><span class="line">@property (strong, nonatomic) UIView *fourthView;</span><br><span class="line">@property (strong, nonatomic) UIView *fiveView;</span><br><span class="line"></span><br><span class="line">//记录改变的高度</span><br><span class="line">@property (assign, nonatomic) NSInteger firstViewH;</span><br><span class="line">@property (assign, nonatomic) NSInteger thirdViewH;</span><br><span class="line">@property (assign, nonatomic) NSInteger fiveViewH;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>DynamicRootView.m</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;DynamicRootView.h&quot;</span><br><span class="line">#import &lt;Masonry/Masonry.h&gt;</span><br><span class="line">#import &lt;ReactiveCocoa/ReactiveCocoa.h&gt;</span><br><span class="line">#import &lt;ReactiveCocoa/RACEXTScope.h&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">@implementation DynamicRootView</span><br><span class="line"></span><br><span class="line">- (void)dealloc &#123;</span><br><span class="line">//....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithCoder:(NSCoder *)aDecoder &#123;</span><br><span class="line">self = [super initWithCoder:aDecoder];</span><br><span class="line">if (self) &#123;</span><br><span class="line">[self initSubviews];</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">self = [super initWithFrame:frame];</span><br><span class="line">if (self) &#123;</span><br><span class="line">[self initSubviews];</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initSubviews &#123;</span><br><span class="line"></span><br><span class="line">//添加一个点击手势，测试点击后改变约束</span><br><span class="line">[self addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(update:)]];</span><br><span class="line"></span><br><span class="line">_firstView = [[UIView alloc] init];</span><br><span class="line">_secondtView = [[UIView alloc] init];</span><br><span class="line">_thirdView = [[UIView alloc] init];</span><br><span class="line">_fourthView = [[UIView alloc] init];</span><br><span class="line">_fiveView = [[UIView alloc] init];</span><br><span class="line"></span><br><span class="line">_firstView.backgroundColor = [UIColor redColor];</span><br><span class="line">_secondtView.backgroundColor = [UIColor blueColor];</span><br><span class="line">_thirdView.backgroundColor = [UIColor yellowColor];</span><br><span class="line">_fourthView.backgroundColor = [UIColor grayColor];</span><br><span class="line">_fiveView.backgroundColor = [UIColor purpleColor];</span><br><span class="line"></span><br><span class="line">[self addSubview:_firstView];</span><br><span class="line">[self addSubview:_secondtView];</span><br><span class="line">[self addSubview:_thirdView];</span><br><span class="line">[self addSubview:_fourthView];</span><br><span class="line">[self addSubview:_fiveView];</span><br><span class="line"></span><br><span class="line">//一开始高度设置为0，后面代码改变高度</span><br><span class="line">_firstViewH = 0;</span><br><span class="line">_thirdViewH = 0;</span><br><span class="line">_fiveViewH = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 这个函数必须写</span><br><span class="line">+ (BOOL)requiresConstraintBasedLayout</span><br><span class="line">&#123;</span><br><span class="line">return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//这个函数为了防止y起始点下移64</span><br><span class="line">- (UIRectEdge)edgesForExtendedLayout &#123;</span><br><span class="line">return UIRectEdgeNone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 手势点击回调</span><br><span class="line">- (void)gestureDidClick:(UITapGestureRecognizer *) gesture&#123;</span><br><span class="line"></span><br><span class="line">//1. 改动的约束</span><br><span class="line">self.firstViewH = 50;</span><br><span class="line">self.thirdViewH = 80;</span><br><span class="line">self.fiveViewH = 100;</span><br><span class="line"></span><br><span class="line">//2. 通常更新约束</span><br><span class="line">[self setNeedsUpdateConstraints];</span><br><span class="line">[self updateConstraintsIfNeeded];</span><br><span class="line"></span><br><span class="line">//3. 执行动画</span><br><span class="line">[UIView animateWithDuration:0.8 animations:^&#123;</span><br><span class="line">[self layoutIfNeeded];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 在更新约束回调方法中设置subviews的约束</span><br><span class="line">- (void)updateConstraints &#123;</span><br><span class="line"></span><br><span class="line">//view1 高度动态改变</span><br><span class="line">[self.firstView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.top.mas_equalTo(@5);</span><br><span class="line">make.height.mas_equalTo(self.firstViewH).priorityLow();//约束可以改变</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//view2 高度不变</span><br><span class="line">[self.secondtView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.bottom.mas_equalTo(self.thirdView.mas_top).offset(-10);</span><br><span class="line">make.top.mas_equalTo(self.firstView.mas_bottom).offset(10);</span><br><span class="line">make.height.mas_equalTo(@50).priorityHigh();//约束不能改变</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//view3 高度动态改变</span><br><span class="line">[self.thirdView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.bottom.mas_equalTo(self.fourthView.mas_top).offset(-10);</span><br><span class="line">make.top.mas_equalTo(self.secondtView.mas_bottom).offset(10);</span><br><span class="line"></span><br><span class="line">make.height.mas_equalTo(self.thirdViewH).priorityLow();//约束可以改变</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//view4 高度不变</span><br><span class="line">[self.fourthView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.bottom.mas_equalTo(self.fiveView.mas_top).offset(-10);</span><br><span class="line">make.top.mas_equalTo(self.thirdView.mas_bottom).offset(10);</span><br><span class="line"></span><br><span class="line">make.height.mas_equalTo(@100).priorityLow();//约束不能改变</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//view5 高度动态改变</span><br><span class="line">[self.fiveView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(self.mas_left).offset(10);</span><br><span class="line">make.right.mas_equalTo(self.mas_right).offset(-10);</span><br><span class="line">make.bottom.mas_equalTo(self.mas_bottom).offset(-10).priorityLow();//约束可以改变</span><br><span class="line">make.top.mas_equalTo(self.fourthView.mas_bottom).offset(10);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[super updateConstraints];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="例子3、ScrollView"><a href="#例子3、ScrollView" class="headerlink" title="例子3、ScrollView"></a>例子3、ScrollView</h3><h4 id="图示效果"><a href="#图示效果" class="headerlink" title="图示效果"></a>图示效果</h4><p><img src="http://i5.tietuku.com/8b91d0a931999c80.png" alt></p>
<h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><ul>
<li>自定义UIScrollView <code>ScrollRootView.h</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface ScrollRootView : UIView</span><br><span class="line"></span><br><span class="line">//传入一个数组初始化subviews</span><br><span class="line">@property (strong, nonatomic) NSArray *dataList;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>自定义UIScrollView <code>ScrollRootView.m</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;ScrollRootView.h&quot;</span><br><span class="line">#import &lt;Masonry/Masonry.h&gt;</span><br><span class="line">#import &quot;UIColor+RandomColor.h&quot;</span><br><span class="line"></span><br><span class="line">@interface ScrollRootView ()</span><br><span class="line"></span><br><span class="line">//里面有一个UIScrollView</span><br><span class="line">@property (strong, nonatomic) UIScrollView *scrollView;</span><br><span class="line"></span><br><span class="line">//添加到UIScrollView的管理subviews的容器的，最后使用这个contentView计算约束得到contentSize</span><br><span class="line">@property (strong, nonatomic) UIView *contentView;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">@implementation ScrollRootView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">self = [super initWithFrame:frame];</span><br><span class="line">if (self) &#123;</span><br><span class="line">[self initScrollView];</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//创建UIScrollview实例</span><br><span class="line">- (void)initScrollView &#123;</span><br><span class="line"></span><br><span class="line">//1. </span><br><span class="line">_scrollView = [[UIScrollView alloc] init];</span><br><span class="line">[self addSubview:_scrollView];</span><br><span class="line"></span><br><span class="line">//2. 给scrollView设置初始时的约束</span><br><span class="line">[_scrollView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.edges.equalTo(self);</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//创建scrollView内部的contentView</span><br><span class="line">- (void)initContentView &#123;</span><br><span class="line"></span><br><span class="line">//1. </span><br><span class="line">_contentView = UIView.new;</span><br><span class="line">[_scrollView addSubview:_contentView];</span><br><span class="line"></span><br><span class="line">//2. 给contentView设置初始时的约束</span><br><span class="line">[_contentView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.edges.equalTo(self.scrollView);</span><br><span class="line">make.width.equalTo(self.scrollView);//纵向滚动</span><br><span class="line">//        make.height.equalTo(self.scrollView);//横向滚动</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragama mark - 根据传入的数组个数，创建subviews，并添加到contentView</span><br><span class="line"></span><br><span class="line">- (void)setDataList:(NSArray *)dataList &#123;</span><br><span class="line"></span><br><span class="line">_dataList = dataList;</span><br><span class="line"></span><br><span class="line">//创建contentView实例</span><br><span class="line">[self initContentView];</span><br><span class="line"></span><br><span class="line">//保存最后一个被添加到contentView的subview</span><br><span class="line">__block UIView *lastViwe = nil;</span><br><span class="line"></span><br><span class="line">//间距</span><br><span class="line">CGFloat padding = 10;</span><br><span class="line"></span><br><span class="line">//依次创建subview，并添加到contentView</span><br><span class="line">for (NSString *value in _dataList) &#123;</span><br><span class="line"></span><br><span class="line">//1.</span><br><span class="line">UIView *subView = UIView.new;</span><br><span class="line">subView.backgroundColor = [UIColor randomColor];</span><br><span class="line"></span><br><span class="line">//2.</span><br><span class="line">[_contentView addSubview:subView];</span><br><span class="line"></span><br><span class="line">//3. 添加手势点击</span><br><span class="line">UITapGestureRecognizer *singleTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTap:)];</span><br><span class="line">[subView addGestureRecognizer:singleTap];</span><br><span class="line"></span><br><span class="line">//4. 设置subview的约束</span><br><span class="line">[subView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line"></span><br><span class="line">//1. 顶部约束需要判断</span><br><span class="line">make.top.mas_equalTo(lastViwe ? lastViwe.mas_bottom : @0).offset(padding);</span><br><span class="line"></span><br><span class="line">//其他的都不变</span><br><span class="line">make.height.mas_equalTo(@80);</span><br><span class="line">make.left.mas_equalTo(_contentView.mas_left).offset(padding);</span><br><span class="line">make.right.mas_equalTo(_contentView.mas_right).offset(-padding);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//5. 最后一定要保存为最后添加到subview</span><br><span class="line">lastViwe = subView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//6. 根据最后一个被添加的subview的底部，来确定contentView的高度</span><br><span class="line">[_contentView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.bottom.mas_equalTo(lastViwe.mas_bottom);</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//scrollview点击</span><br><span class="line">- (void)singleTap:(UITapGestureRecognizer*)sender &#123;</span><br><span class="line"></span><br><span class="line">//1. 设置被点击的view透明度变化</span><br><span class="line">[sender.view setAlpha:sender.view.alpha / 1.20];</span><br><span class="line"></span><br><span class="line">//2. 让scrollView滚动到被点击这个view的位置</span><br><span class="line">[self.scrollView scrollRectToVisible:sender.view.frame animated:YES];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="例子4、键盘上的工具栏"><a href="#例子4、键盘上的工具栏" class="headerlink" title="例子4、键盘上的工具栏"></a>例子4、键盘上的工具栏</h3><ul>
<li>键盘View</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@interface KeyBoardView : UIView</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KeyBoardView</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>TooBar</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface ToolBarView ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) KeyBoardView *keyBoardView;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">@implementation ToolBarView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">self = [super initWithFrame:frame];</span><br><span class="line">if (self) &#123;</span><br><span class="line">[self initSubveiws];</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initSubveiws &#123;</span><br><span class="line"></span><br><span class="line">UITextField *txt = [[UITextField alloc] init];</span><br><span class="line">txt.placeholder = @&quot;....&quot;;</span><br><span class="line">[self addSubview:txt];</span><br><span class="line"></span><br><span class="line">[txt mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.center.mas_equalTo(self);</span><br><span class="line">make.size.mas_equalTo(CGSizeMake(200, 45));</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">_keyBoardView = [[KeyBoardView alloc] init];</span><br><span class="line">_keyBoardView.backgroundColor = [UIColor redColor];</span><br><span class="line">[self addSubview:_keyBoardView];</span><br><span class="line"></span><br><span class="line">[_keyBoardView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.centerX.mas_equalTo(self.mas_centerX);</span><br><span class="line">make.width.mas_equalTo(self.mas_width);</span><br><span class="line">make.height.mas_equalTo(44);</span><br><span class="line">make.bottom.mas_equalTo(self);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//键盘通知</span><br><span class="line">NSNotificationCenter *center = [NSNotificationCenter defaultCenter];</span><br><span class="line"></span><br><span class="line">[center addObserver:self</span><br><span class="line">selector:@selector(keyboardEvent:)</span><br><span class="line">name:UIKeyboardWillChangeFrameNotification</span><br><span class="line">object:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - </span><br><span class="line"></span><br><span class="line">- (void)keyboardEvent:(NSNotification *)notify &#123;</span><br><span class="line"></span><br><span class="line">CGFloat duration = [notify.userInfo[UIKeyboardAnimationDurationUserInfoKey] floatValue];</span><br><span class="line"></span><br><span class="line">CGRect keyBoardFrame = [notify.userInfo[UIKeyboardFrameEndUserInfoKey] CGRectValue];</span><br><span class="line"></span><br><span class="line">if (self.frame.size.height == keyBoardFrame.origin.y) &#123;</span><br><span class="line">//键盘未弹起，还原位置</span><br><span class="line">[UIView animateWithDuration:duration animations:^&#123;</span><br><span class="line">_keyBoardView.transform = CGAffineTransformIdentity;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">//键盘已经弹起，改变位置</span><br><span class="line">CGFloat h = keyBoardFrame.size.height;</span><br><span class="line">[UIView animateWithDuration:duration animations:^&#123;</span><br><span class="line">_keyBoardView.transform = CGAffineTransformMakeTranslation(0, -h);</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><p>小结:</p>
</li>
<li><p>并没有通过修改约束值，来改变位置</p>
</li>
<li>而是通过Transform形变，直接改变frame来完成</li>
<li>因为此时肯定是有frame</li>
<li>所以不一定所有的都得用<code>改变约束</code>，也可以结合使用<code>Transform</code>来改变位置</li>
</ul>
<hr>
<h3 id="例子5、Alert"><a href="#例子5、Alert" class="headerlink" title="例子5、Alert"></a>例子5、Alert</h3><h4 id="效果图示-1"><a href="#效果图示-1" class="headerlink" title="效果图示"></a>效果图示</h4><ul>
<li>被点击之前</li>
</ul>
<p><img src="http://i5.tietuku.com/e9836ca12ceebb5f.png" alt></p>
<ul>
<li>点击之后，弹出一个AlertView，显示输入框风格</li>
</ul>
<p><img src="http://i5.tietuku.com/ff9d7cd2fd143181.png" alt></p>
<ul>
<li>点击之后，弹出一个AlertView，显示提示信息</li>
</ul>
<p><img src="http://i5.tietuku.com/587146ae51261274.png" alt></p>
<ul>
<li>点击之后，弹出一个AlertView，显示提示信息，且当提示信息超过一定<code>高度</code>时，内部使用<code>UITextView</code>来显示</li>
</ul>
<p><img src="http://i5.tietuku.com/05fdcd0661d56497.jpg" alt></p>
<h4 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h4><ul>
<li>先看看封装后的使用Api</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">@implementation AlertDemoController</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//展示显示信息的Alert</span><br><span class="line">- (void)showInfo &#123;</span><br><span class="line"></span><br><span class="line">//1.</span><br><span class="line">SFPayMessageAlertView *vc = [[SFPayMessageAlertView alloc] init];</span><br><span class="line"></span><br><span class="line">//2.</span><br><span class="line">[vc showInfoWithTile:@&quot;标题&quot; Content:@&quot;n你好啊啊啊hidden安徽宿大户室大户室胡&quot; DoneButton:@&quot;我知道了&quot; OnDoneButtonClick:^(SFPayAlertButton *button) &#123;</span><br><span class="line"></span><br><span class="line">&#125; CancelButton:@&quot;取消&quot; OnCancelButtonClick:^(SFPayAlertButton *button) &#123;</span><br><span class="line"></span><br><span class="line">&#125; duration:2 InViewController:self OnDissmiss:^&#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//展示编辑框的Alert</span><br><span class="line">- (void)showEdit &#123;</span><br><span class="line">//1.</span><br><span class="line">SFPayMessageAlertView *vc = [[SFPayMessageAlertView alloc] init];</span><br><span class="line"></span><br><span class="line">//2.</span><br><span class="line">[vc addInputItemWithPlaceholder:@&quot;请输入手机号码...&quot; OnValueChanged:^(SFPayAlertTextfiled *clickItem) &#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[vc addInputItemWithPlaceholder:@&quot;请输入用户名...&quot; OnValueChanged:^(SFPayAlertTextfiled *clickItem) &#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[vc addInputItemWithPlaceholder:@&quot;请输入密码...&quot; OnValueChanged:^(SFPayAlertTextfiled *clickItem) &#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[vc addInputItemWithPlaceholder:@&quot;请输入密码...&quot; OnValueChanged:^(SFPayAlertTextfiled *clickItem) &#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[vc showEditWithTile:@&quot;填写信息&quot; Content:@&quot;f安顿好杀敌阿红丝带阿是但还是大海&quot; SubmitButton:@&quot;提交&quot; OnSubmitButtonClick:^(NSMutableArray *dataArray) &#123;</span><br><span class="line"></span><br><span class="line">&#125; CancelButton:@&quot;取消&quot; OnCancelButtonClick:^&#123;</span><br><span class="line"></span><br><span class="line">&#125; duration:2 InViewController:self</span><br><span class="line"></span><br><span class="line">OnDissmiss:^&#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>实现1、Alert中的每一个按钮自定义类 <code>SFPayAlertButton</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SFPayAlertButton : UIButton</span><br><span class="line"></span><br><span class="line">@property (copy, nonatomic) void (^onButtonClick)(SFPayAlertButton *clickedButton);</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;SFPayAlertButton.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation SFPayAlertButton</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>主要就是保存一个Block，回传按钮自己</p>
<ul>
<li>实现2、Alert中的每一个输入框自定义类 <code>SFPayAlertTextfiled</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SFPayAlertTextfiled : UITextField</span><br><span class="line"></span><br><span class="line">@property (copy, nonatomic)void (^onChanged)(SFPayAlertTextfiled *filed);</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;SFPayAlertTextfiled.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation SFPayAlertTextfiled</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>主要就是保存一个Block，回传输入框自己</p>
<ul>
<li><p>实现3、AlertView</p>
</li>
<li><p>其实是继承自一个UIViewController的控制器类</p>
</li>
</ul>
<ul>
<li><code>SFPayMessageAlertView.h</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &quot;SFPayAlertButton.h&quot;</span><br><span class="line">#import &quot;SFPayAlertTextfiled.h&quot;</span><br><span class="line"></span><br><span class="line">//定义Alert显示的样式</span><br><span class="line">typedef NS_ENUM(NSInteger, XZHAlertViewType) &#123;</span><br><span class="line">XZHAlertViewTypeInfo = 1,    //信息</span><br><span class="line">XZHAlertViewTypeEdit ,    //编辑</span><br><span class="line">XZHAlertViewTypeWaring , //警告</span><br><span class="line">XZHAlertViewTypeFail , //失败</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@interface SFPayMessageAlertView : UIViewController</span><br><span class="line"></span><br><span class="line">/* 在Alert上添加按钮 */</span><br><span class="line">- (SFPayAlertButton *)addButtonItemWithTitle:(NSString *)title</span><br><span class="line">OnClick:(void (^)(SFPayAlertButton *clickedButton))callback;</span><br><span class="line"></span><br><span class="line">/* 在Alert上添加输入框 */</span><br><span class="line">- (SFPayAlertTextfiled *)addInputItemWithPlaceholder:(NSString *)placeHolder</span><br><span class="line">OnValueChanged:(void (^)(SFPayAlertTextfiled *clickItem)) callback;</span><br><span class="line"></span><br><span class="line">/* 显示弹窗信息 */</span><br><span class="line">- (void)showInfoWithTile:(NSString *)title</span><br><span class="line">Content:(NSString *)content</span><br><span class="line">DoneButton:(NSString *)done</span><br><span class="line">OnDoneButtonClick:(void (^)(SFPayAlertButton *button)) onDoneClick</span><br><span class="line">CancelButton:(NSString *)cancel</span><br><span class="line">OnCancelButtonClick:(void (^)(SFPayAlertButton *button)) onCancelClick</span><br><span class="line">duration:(NSTimeInterval)duration</span><br><span class="line">InViewController:(UIViewController *)targetController</span><br><span class="line">OnDissmiss:(void (^)(void)) onDismiss;</span><br><span class="line"></span><br><span class="line">/* 显示输入框 */</span><br><span class="line">- (void)showEditWithTile:(NSString *)title</span><br><span class="line">Content:(NSString *)content</span><br><span class="line">SubmitButton:(NSString *)submit</span><br><span class="line">OnSubmitButtonClick:(void (^)(NSMutableArray *dataArray))onDoneClick</span><br><span class="line">CancelButton:(NSString *)cancel</span><br><span class="line">OnCancelButtonClick:(void (^)(void))onCancelClick</span><br><span class="line">duration:(NSTimeInterval)duration</span><br><span class="line">InViewController:(UIViewController *)targetController</span><br><span class="line">OnDissmiss:(void (^)(void)) onDismiss;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>SFPayMessageAlertView.m</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;SFPayMessageAlertView.h&quot;</span><br><span class="line">#import &lt;Masonry/Masonry.h&gt;</span><br><span class="line"></span><br><span class="line">//解决键盘遮挡</span><br><span class="line">#import &lt;IQKeyboardManager/IQKeyboardManager.h&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//iOS系统版本判断宏</span><br><span class="line">#define SYSTEM_VERSION_EQUAL_TO(v)                  ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] == NSOrderedSame)</span><br><span class="line">#define SYSTEM_VERSION_GREATER_THAN(v)              ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] == NSOrderedDescending)</span><br><span class="line">#define SYSTEM_VERSION_GREATER_THAN_OR_EQUAL_TO(v)  ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] != NSOrderedAscending)</span><br><span class="line">#define SYSTEM_VERSION_LESS_THAN(v)                 ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] == NSOrderedAscending)</span><br><span class="line">#define SYSTEM_VERSION_LESS_THAN_OR_EQUAL_TO(v)     ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] != NSOrderedDescending)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//定义输入框最小输入的长度</span><br><span class="line">static NSInteger kTextfileLength = 6;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">@interface SFPayMessageAlertView () &lt;UITextFieldDelegate&gt; &#123;</span><br><span class="line"></span><br><span class="line">//AlertView的宽度</span><br><span class="line">NSInteger _AlertViewWidth;</span><br><span class="line"></span><br><span class="line">//AlertView的高度</span><br><span class="line">NSInteger _AlertViewHeight;</span><br><span class="line"></span><br><span class="line">//subviews之间的间距</span><br><span class="line">NSInteger _Padding;</span><br><span class="line"></span><br><span class="line">//标题Label的高度</span><br><span class="line">NSInteger _TitleLabelHeight;</span><br><span class="line"></span><br><span class="line">NSInteger _ButtonHeight;</span><br><span class="line">NSInteger _FiledHeight;</span><br><span class="line"></span><br><span class="line">//记录内容显示的最高高度</span><br><span class="line">//1.没有超过这个高度，就使用 _contentLabel显示</span><br><span class="line">//2.一旦超过这个高度，就使用 _textView来滚动显示</span><br><span class="line">NSInteger _MaxTextHeight;</span><br><span class="line"></span><br><span class="line">//记录所有的输入框</span><br><span class="line">NSMutableArray *_inputs;</span><br><span class="line"></span><br><span class="line">//记录所有的按钮</span><br><span class="line">NSMutableArray *_buttons;</span><br><span class="line"></span><br><span class="line">//标题Label</span><br><span class="line">UILabel *_titleLabel;</span><br><span class="line"></span><br><span class="line">//显示提示信息的Label，当提示信息没有超过规定长度时</span><br><span class="line">UILabel *_contentLabel;</span><br><span class="line"></span><br><span class="line">//显示提示信息的UItextView，当提示信息超过规定长度时，替换掉_contentLabel来显示信息</span><br><span class="line">UITextView *_textView;</span><br><span class="line"></span><br><span class="line">//标题Label的字体</span><br><span class="line">UIFont *_titleLabelFont;</span><br><span class="line"></span><br><span class="line">//提示信息的字体</span><br><span class="line">UIFont *_contentTextFont;</span><br><span class="line"></span><br><span class="line">//按钮的字体</span><br><span class="line">UIFont *_buttonTextFont;</span><br><span class="line"></span><br><span class="line">//保存添加到当前控制器View的最下方的一个View</span><br><span class="line">UIView *_lastView;</span><br><span class="line"></span><br><span class="line">//保存传入的控制器对象</span><br><span class="line">UIViewController *_targetController;</span><br><span class="line"></span><br><span class="line">//添加到控制器view上的AlertView</span><br><span class="line">UIView *_rootView;</span><br><span class="line"></span><br><span class="line">//当前Alert显示的样式</span><br><span class="line">XZHAlertViewType _type;</span><br><span class="line"></span><br><span class="line">//计时器</span><br><span class="line">NSTimer *_timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//当Alert移除时，执行的Block</span><br><span class="line">@property (copy, nonatomic) void (^onDismiss)(void);</span><br><span class="line"></span><br><span class="line">//当Alert提交按钮点击时，执行的Block，并回传输入框的数据</span><br><span class="line">@property (copy, nonatomic) void (^onSubmit)(NSArray *datas);</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>####接下来都是<code>@implementation SFPayMessageAlertView ... @end</code>的实现代码</p>
<ul>
<li>dealloc函数，释放内存，移除键盘通知</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)dealloc &#123;</span><br><span class="line"></span><br><span class="line">_rootView = nil;</span><br><span class="line">_inputs = nil;</span><br><span class="line">_buttons = nil;</span><br><span class="line">_timer = nil;</span><br><span class="line"></span><br><span class="line">_titleLabelFont = nil;</span><br><span class="line">_contentTextFont = nil;</span><br><span class="line">_buttonTextFont = nil;</span><br><span class="line"></span><br><span class="line">_onDismiss = nil;</span><br><span class="line">_onSubmit = nil;</span><br><span class="line"></span><br><span class="line">[[NSNotificationCenter defaultCenter] removeObserver:self name:UIKeyboardWillShowNotification object:nil];</span><br><span class="line">[[NSNotificationCenter defaultCenter] removeObserver:self name:UIKeyboardWillHideNotification object:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>init函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)init &#123;</span><br><span class="line">self = [super init];</span><br><span class="line">if (self) &#123;</span><br><span class="line"></span><br><span class="line">//1. 初始化变量值</span><br><span class="line">[self initVariables];</span><br><span class="line"></span><br><span class="line">//2. 创建subviews</span><br><span class="line">[self initSubviews];</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>计算比例，返回当前屏幕宽度与320的比例，后续的所有宽度和高度，都得乘上这个比例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (NSInteger)screenWithRate &#123;</span><br><span class="line">NSInteger rate = [UIScreen mainScreen].bounds.size.width / 320;</span><br><span class="line">return rate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>initVariables函数，初始化所有的变量值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (void)initVariables &#123;</span><br><span class="line"></span><br><span class="line">//都得乘上这个比例</span><br><span class="line"></span><br><span class="line">_AlertViewWidth = 280 * [self screenWithRate];</span><br><span class="line"></span><br><span class="line">_AlertViewHeight = 0;</span><br><span class="line"></span><br><span class="line">_Padding = 10 * [self screenWithRate];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_TitleLabelHeight = 30 * [self screenWithRate];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_ButtonHeight = 44 * [self screenWithRate];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_FiledHeight = 40 * [self screenWithRate];</span><br><span class="line"></span><br><span class="line">_MaxTextHeight = 300 * [self screenWithRate];</span><br><span class="line"></span><br><span class="line">_inputs = [NSMutableArray array];</span><br><span class="line"></span><br><span class="line">_buttons = [NSMutableArray array];</span><br><span class="line"></span><br><span class="line">//监听键盘事件</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(onKeyboardWillShow:) name:UIKeyboardWillShowNotification object:nil];</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(onKeyboardWillHide:) name:UIKeyboardWillHideNotification object:nil];</span><br><span class="line"></span><br><span class="line">[[IQKeyboardManager sharedManager] setEnable:YES];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>键盘事件回调处理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (void)onKeyboardWillShow:(NSNotification *)sender &#123;</span><br><span class="line"></span><br><span class="line">//没用</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)onKeyboardWillHide:(NSNotification *)sender &#123;</span><br><span class="line">BOOL isValid = YES;</span><br><span class="line"></span><br><span class="line">NSMutableArray *array = [NSMutableArray array];</span><br><span class="line"></span><br><span class="line">//查看所有的输入框的值，是否都满足最小长度</span><br><span class="line">for (SFPayAlertTextfiled *filed in _inputs) &#123;</span><br><span class="line"></span><br><span class="line">isValid = isValid &amp;&amp; [self isLengthForTextfile:filed];</span><br><span class="line">[array addObject:filed.text];</span><br><span class="line"></span><br><span class="line">//如果没满足最小长度，就让输入框的layer color显示红色，如果符合还原颜色</span><br><span class="line">if ([self isLengthForTextfile:filed]) &#123;</span><br><span class="line">filed.layer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">filed.layer.borderColor = [UIColor redColor].CGColor;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>initSubviews函数，创建所有的subviews，添加到当前控制器View上</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">- (void)initSubviews &#123;</span><br><span class="line"></span><br><span class="line">// font</span><br><span class="line">_titleLabelFont = [UIFont fontWithName:@&quot;HelveticaNeue-Bold&quot; size:17.0f];</span><br><span class="line">_contentTextFont = [UIFont fontWithName:@&quot;HelveticaNeue&quot; size:14.0f];</span><br><span class="line">_buttonTextFont = [UIFont fontWithName:@&quot;HelveticaNeue&quot; size:14.0f];</span><br><span class="line"></span><br><span class="line">// rootView，也就是AlertView</span><br><span class="line">_rootView = [[UIView alloc] init];</span><br><span class="line">_rootView.backgroundColor = [UIColor whiteColor];</span><br><span class="line">_rootView.userInteractionEnabled = YES;</span><br><span class="line">_rootView.layer.cornerRadius = 10.0f;</span><br><span class="line">_rootView.layer.masksToBounds = YES;</span><br><span class="line">_rootView.layer.borderWidth = 3.0f;</span><br><span class="line">_rootView.layer.borderColor = [UIColor lightGrayColor].CGColor;</span><br><span class="line">[self.view addSubview:_rootView];</span><br><span class="line"></span><br><span class="line">// titleLabel</span><br><span class="line">_titleLabel = [[UILabel alloc] init];</span><br><span class="line">_titleLabel.numberOfLines = 1;</span><br><span class="line">_titleLabel.font = _titleLabelFont;</span><br><span class="line">_titleLabel.textAlignment = NSTextAlignmentCenter;</span><br><span class="line">[_rootView addSubview:_titleLabel];</span><br><span class="line"></span><br><span class="line">[_titleLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(_rootView.mas_left);</span><br><span class="line">make.right.mas_equalTo(_rootView.mas_right);</span><br><span class="line">make.top.mas_equalTo(_rootView.mas_top).offset(_Padding);</span><br><span class="line">make.height.mas_equalTo(_TitleLabelHeight);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//累计AlertView的高度</span><br><span class="line">_AlertViewHeight += _TitleLabelHeight;</span><br><span class="line"></span><br><span class="line">// contentLabel</span><br><span class="line">//先累加一个间距的高度</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line"></span><br><span class="line">_contentLabel = [[UILabel alloc] init];</span><br><span class="line">[_rootView addSubview:_contentLabel];</span><br><span class="line">_contentLabel.textColor = [UIColor blackColor];</span><br><span class="line">_contentLabel.preferredMaxLayoutWidth = _AlertViewWidth - 2 * _Padding;//设置最大显示宽度</span><br><span class="line">_contentLabel.numberOfLines = 0;//自动换行</span><br><span class="line">_contentLabel.font = _contentTextFont;</span><br><span class="line"></span><br><span class="line">// textView</span><br><span class="line">_textView = [[UITextView alloc] init];</span><br><span class="line">[_rootView addSubview:_textView];</span><br><span class="line">_textView.editable = NO;</span><br><span class="line">_textView.font = _contentTextFont;</span><br><span class="line">_textView.textColor = [UIColor redColor];</span><br><span class="line">_textView.allowsEditingTextAttributes = YES;</span><br><span class="line">_textView.textAlignment = NSTextAlignmentCenter;</span><br><span class="line"></span><br><span class="line">//按系统版本，设置UITextView的内容的上、下、左、右、的缩进为0</span><br><span class="line">if (SYSTEM_VERSION_GREATER_THAN_OR_EQUAL_TO(@&quot;7.0&quot;))</span><br><span class="line">&#123;</span><br><span class="line">_textView.textContainerInset = UIEdgeInsetsZero;</span><br><span class="line">_textView.textContainer.lineFragmentPadding = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//累加间距高度</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>小结<code>initSubviews</code>函数做的事情:</p>
</li>
<li><p>1) <code>_rootView</code>也就是作为AlertView</p>
</li>
<li>2) 首先先把所有的subviews都创建，并且添加到<code>_rootView</code>，不需要的就先<code>hiden</code></li>
<li>3) 给<code>_titleLabel</code>设置了约束，因为他的frame是不会变化的</li>
<li><p>4) 此时只是累计了<code>padding</code> + <code>_titleLabel的定高度</code> + <code>padding</code>总高度</p>
</li>
<li><p>显示提示信息入口</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (void)showInfoWithTile:(NSString *)title</span><br><span class="line">Content:(NSString *)content</span><br><span class="line">DoneButton:(NSString *)done</span><br><span class="line">OnDoneButtonClick:(void (^)(SFPayAlertButton *button)) onDoneClick</span><br><span class="line">CancelButton:(NSString *)cancel</span><br><span class="line">OnCancelButtonClick:(void (^)(SFPayAlertButton *button)) onCancelClick</span><br><span class="line">duration:(NSTimeInterval)duration</span><br><span class="line">InViewController:(UIViewController *)targetController</span><br><span class="line">OnDissmiss:(void (^)(void)) onDismiss</span><br><span class="line">&#123;    </span><br><span class="line"></span><br><span class="line">//1. 添加subveiws</span><br><span class="line">//如果需要添加Done按钮（OK按钮）</span><br><span class="line">if (done) &#123;</span><br><span class="line">[self addButtonItemWithTitle:done OnClick:[onDoneClick copy]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//如果需要添加取消按钮</span><br><span class="line">if (cancel) &#123;</span><br><span class="line">[self addButtonItemWithTitle:cancel OnClick:[onDoneClick copy]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//2. 调用创建输入框和按钮的统一入口函数</span><br><span class="line">//完成添加完成的所有subviews的约束设置</span><br><span class="line">[self showAlertViewWithTitle:title</span><br><span class="line">Content:content</span><br><span class="line">Type:XZHAlertViewTypeInfo</span><br><span class="line">duration:3</span><br><span class="line">InViewController:targetController</span><br><span class="line">OnDissmiss:onDismiss];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>显示编辑框的入口</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">- (void)showEditWithTile:(NSString *)title</span><br><span class="line">Content:(NSString *)content</span><br><span class="line">SubmitButton:(NSString *)submit</span><br><span class="line">OnSubmitButtonClick:(void (^)(NSMutableArray *dataArray))onSubmit</span><br><span class="line">CancelButton:(NSString *)cancel</span><br><span class="line">OnCancelButtonClick:(void (^)(void))onCancelClick</span><br><span class="line">duration:(NSTimeInterval)duration</span><br><span class="line">InViewController:(UIViewController *)targetController</span><br><span class="line">OnDissmiss:(void (^)(void)) onDismiss</span><br><span class="line">&#123;</span><br><span class="line">//保存提交按钮点击后的回调执行Block</span><br><span class="line">self.onSubmit = [onSubmit copy];</span><br><span class="line"></span><br><span class="line">__weak __typeof(self)weakSelf = self;</span><br><span class="line"></span><br><span class="line">//1. 添加subveiws</span><br><span class="line">//1.1 添加一个按钮提交按钮，并给按钮设置好回调Block，就是检查所有输入框</span><br><span class="line">if (submit) &#123;</span><br><span class="line"></span><br><span class="line">[self addButtonItemWithTitle:submit</span><br><span class="line">OnClick:^(SFPayAlertButton *clickedButton)</span><br><span class="line">&#123;</span><br><span class="line">__strong __typeof(weakSelf)strongSelf = weakSelf;</span><br><span class="line"></span><br><span class="line">//验证所有输入框的输入值长度是否合法</span><br><span class="line">BOOL isValid = YES;</span><br><span class="line">NSMutableArray *array = [NSMutableArray array];</span><br><span class="line">for (SFPayAlertTextfiled *filed in strongSelf-&gt;_inputs) &#123;</span><br><span class="line">isValid = isValid &amp;&amp; [strongSelf isLengthForTextfile:filed];</span><br><span class="line">[array addObject:filed.text];</span><br><span class="line"></span><br><span class="line">if ([strongSelf isLengthForTextfile:filed]) &#123;</span><br><span class="line">filed.layer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">filed.layer.borderColor = [UIColor redColor].CGColor;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isValid) &#123;</span><br><span class="line"></span><br><span class="line">//如果长度都合法，执行提交按钮点击的回调Block</span><br><span class="line">if (strongSelf.onSubmit) &#123;</span><br><span class="line">strongSelf.onSubmit(array);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//释放block</span><br><span class="line">strongSelf.onSubmit = nil;</span><br><span class="line"></span><br><span class="line">//执行Alert移除Block</span><br><span class="line">[strongSelf onAlertViewDismiss:nil];</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//1.2 添加一个按钮取消按钮，设置回调Block</span><br><span class="line">if (cancel) &#123;</span><br><span class="line"></span><br><span class="line">[self addButtonItemWithTitle:cancel OnClick:^(SFPayAlertButton *clickedButton) &#123;</span><br><span class="line">__strong __typeof(weakSelf)strongSelf = weakSelf;</span><br><span class="line"></span><br><span class="line">//清除所有输入框的值</span><br><span class="line">for (SFPayAlertTextfiled *filed in strongSelf-&gt;_inputs) &#123;</span><br><span class="line">filed.text = @&quot;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//执行取消按钮被点击的回调Block</span><br><span class="line">if (onCancelClick) onCancelClick();</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//2. 调用创建输入框和按钮的统一入口函数</span><br><span class="line">//完成添加完成的所有subviews的约束设置</span><br><span class="line">[self showAlertViewWithTitle:title</span><br><span class="line">Content:content</span><br><span class="line">Type:XZHAlertViewTypeEdit</span><br><span class="line">duration:duration</span><br><span class="line">InViewController:targetController</span><br><span class="line">OnDissmiss:onDismiss];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>统一在Alert<code>_rootView</code>上完成最终的操作</p>
</li>
<li><p>添加所有的subviews</p>
</li>
<li>设置所有subviews的约束</li>
<li>移除不要的subview</li>
<li>输入框校验</li>
<li>按钮点击事件，按钮的Block设置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">- (void)showAlertViewWithTitle:(NSString *)title</span><br><span class="line">Content:(NSString *)content</span><br><span class="line">Type:(XZHAlertViewType) type</span><br><span class="line">duration:(NSTimeInterval)duration</span><br><span class="line">InViewController:(UIViewController *)targetController</span><br><span class="line">OnDissmiss:(void (^)(void)) onDismiss</span><br><span class="line">&#123;    </span><br><span class="line">//copy block</span><br><span class="line">_onDismiss = [onDismiss copy];</span><br><span class="line"></span><br><span class="line">//保存要显示的Alert样式</span><br><span class="line">_type = type;</span><br><span class="line"></span><br><span class="line">//设置控制器View的背景色，带有透明度</span><br><span class="line">self.view.backgroundColor = [[UIColor lightGrayColor] colorWithAlphaComponent:0.5];</span><br><span class="line"></span><br><span class="line">//保存要显示Alert的目标控制器</span><br><span class="line">_targetController = targetController;</span><br><span class="line"></span><br><span class="line">//将我们自己的AlertController.view 添加到 目标控制器.view </span><br><span class="line">[targetController.view addSubview:self.view];</span><br><span class="line"></span><br><span class="line">//让我们AlertController引用目标控制器</span><br><span class="line">[targetController addChildViewController:self];</span><br><span class="line"></span><br><span class="line">//添加点击手势，点击之后，执行移除Alert</span><br><span class="line">UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(onAlertViewDismiss:)];</span><br><span class="line">[self.view addGestureRecognizer:tap];</span><br><span class="line"></span><br><span class="line">//设置 _titleLable显示的内容</span><br><span class="line">[_titleLabel setText:title];</span><br><span class="line"></span><br><span class="line">//根据显示的内容长度，判断使用 _contentLabel 还是 _textView</span><br><span class="line">[_contentLabel setText:content];</span><br><span class="line"></span><br><span class="line">//计算 _contentLabel设置内容后的一个size</span><br><span class="line">__block CGSize size = [_contentLabel sizeThatFits:CGSizeMake(_contentLabel.preferredMaxLayoutWidth, MAXFLOAT)];</span><br><span class="line"></span><br><span class="line">//如果高度大于规定高度，使用 _textView来代替显示内容</span><br><span class="line">if (size.height &gt; _MaxTextHeight) &#123;//超过规定高度</span><br><span class="line"></span><br><span class="line">//将 _contentLabel移除</span><br><span class="line">[_contentLabel removeFromSuperview];</span><br><span class="line">_contentLabel = nil;</span><br><span class="line"></span><br><span class="line">//使用 _textView来显示内容</span><br><span class="line">_textView.text = content;</span><br><span class="line"></span><br><span class="line">//设置 _textView 约束</span><br><span class="line">[_textView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.top.mas_equalTo(_titleLabel.mas_bottom).offset(_Padding);</span><br><span class="line"></span><br><span class="line">//textView的高度为 _MaxTextHeight </span><br><span class="line">make.height.mas_equalTo(_MaxTextHeight);</span><br><span class="line"></span><br><span class="line">make.left.mas_equalTo(_rootView).offset(_Padding);</span><br><span class="line">make.width.mas_equalTo(_AlertViewWidth - 2 * _Padding);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//记录 _textView 为最后加入的subview</span><br><span class="line">_lastView = _textView;</span><br><span class="line"></span><br><span class="line">//累计 _textView的高度</span><br><span class="line">_AlertViewHeight += _MaxTextHeight;</span><br><span class="line"></span><br><span class="line">//累计一个间距的高度</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line"></span><br><span class="line">//内容没有超过规定高度，</span><br><span class="line">[_textView removeFromSuperview];</span><br><span class="line"></span><br><span class="line">//记录 _contentLabel 为最后加入的subview</span><br><span class="line">_lastView = _contentLabel;</span><br><span class="line"></span><br><span class="line">//这里不用记录 _contentLabel 的高度</span><br><span class="line">//因为此种情况时，可以通过 _lastView 来设置下一个subview的top约束</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//添加所有的输入框</span><br><span class="line">for (UITextField *filed in _inputs) &#123;</span><br><span class="line"></span><br><span class="line">//设置约束</span><br><span class="line">[filed mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.top.mas_equalTo(_lastView.mas_bottom).offset(_Padding);</span><br><span class="line">make.left.mas_equalTo(_rootView).offset(_Padding);</span><br><span class="line">make.width.mas_equalTo(_AlertViewWidth - 2 * _Padding);</span><br><span class="line">make.height.mas_equalTo(_FiledHeight);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//累计一个间距的高度</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line"></span><br><span class="line">//累计一个输入框的高度</span><br><span class="line">_AlertViewHeight += _FiledHeight;</span><br><span class="line"></span><br><span class="line">//记录 filed 为最后加入的subview</span><br><span class="line">_lastView = filed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 内容显示下面的一条分割线</span><br><span class="line">UIView *line = [[UIView alloc] init];</span><br><span class="line">[_rootView addSubview:line];</span><br><span class="line">line.backgroundColor = [UIColor lightGrayColor];</span><br><span class="line">[line mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.top.mas_equalTo(_lastView.mas_bottom).offset(_Padding);</span><br><span class="line">make.height.mas_equalTo(1);</span><br><span class="line">make.left.mas_equalTo(_rootView.mas_left);</span><br><span class="line">make.width.mas_equalTo(_rootView);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//记录 line 为最后加入的subview</span><br><span class="line">_lastView = line;</span><br><span class="line"></span><br><span class="line">//累计一个间距的高度</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line"></span><br><span class="line">//所有按钮的创建，分两种情况</span><br><span class="line">//1. 只有一个按钮</span><br><span class="line">//2. 两个按钮</span><br><span class="line">if ([_buttons count] == 1) &#123;</span><br><span class="line"></span><br><span class="line">//设置约束</span><br><span class="line">SFPayAlertButton *btn = [_buttons objectAtIndex:0];</span><br><span class="line">[btn mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(_rootView.mas_left).offset(_Padding);</span><br><span class="line">make.width.mas_equalTo(_AlertViewWidth - 2 * _Padding);</span><br><span class="line">make.top.mas_equalTo(_lastView.mas_bottom).offset(_Padding);</span><br><span class="line">make.height.mas_equalTo(_ButtonHeight);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//累计一个按钮的高度</span><br><span class="line">_AlertViewHeight += _ButtonHeight;</span><br><span class="line"></span><br><span class="line">//累计一个间距的高度</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line"></span><br><span class="line">//记录 btn 为最后加入的subview</span><br><span class="line">_lastView = btn;</span><br><span class="line"></span><br><span class="line">&#125; else if ([_buttons count] == 2) &#123;</span><br><span class="line"></span><br><span class="line">//计算得到每一个按钮的宽度</span><br><span class="line">NSInteger width = (_AlertViewWidth - 3 * _Padding) / 2;</span><br><span class="line"></span><br><span class="line">UIView *lastTmpView = nil;</span><br><span class="line"></span><br><span class="line">for (SFPayAlertButton *btn in _buttons) &#123;</span><br><span class="line">[btn mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo((lastTmpView?lastTmpView.mas_right:@0)).offset(_Padding);</span><br><span class="line">make.width.mas_equalTo(width);</span><br><span class="line">make.top.mas_equalTo(_lastView.mas_bottom).offset(_Padding);</span><br><span class="line">make.height.mas_equalTo(_ButtonHeight);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//记录最后添加的subview</span><br><span class="line">lastTmpView = btn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//累计按钮高度</span><br><span class="line">_AlertViewHeight += _ButtonHeight;</span><br><span class="line"></span><br><span class="line">//累计一个间距的高度</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">//按钮数大于 &gt; 2，那么纵向排列按钮</span><br><span class="line">//待实现...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>小结</p>
</li>
<li><p>根据计算出<code>_contentLabel</code>设置内容后的size.height，如果超过规定高度，将其溢出，换成<code>UITextView</code>来显示内容</p>
</li>
<li><p><code>_AlertViewHeight</code>记录了当前subviews在<code>_rootView</code>中的<code>总高度</code></p>
</li>
<li><p>从目标控制器.view 移除 AlertController.view</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (void)onAlertViewDismiss:(id)sender &#123;</span><br><span class="line"></span><br><span class="line">__weak __typeof(self)weakSelf = self;</span><br><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">__strong __typeof(weakSelf)strongSelf = weakSelf;</span><br><span class="line"></span><br><span class="line">//移除</span><br><span class="line">[strongSelf.view removeFromSuperview];</span><br><span class="line">[strongSelf removeFromParentViewController];</span><br><span class="line"></span><br><span class="line">//执行Block回调</span><br><span class="line">if (strongSelf.onDismiss) &#123;</span><br><span class="line">strongSelf.onDismiss();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>添加按钮</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark  添加按钮</span><br><span class="line">- (SFPayAlertButton *)addButtonItemWithTitle:(NSString *)title</span><br><span class="line">OnClick:(void (^)(SFPayAlertButton *clickedButton))callback</span><br><span class="line">&#123;</span><br><span class="line">SFPayAlertButton *button = [SFPayAlertButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">[_rootView addSubview:button];</span><br><span class="line"></span><br><span class="line">//复制传入的按钮的Block</span><br><span class="line">button.onButtonClick = callback;</span><br><span class="line"></span><br><span class="line">button.titleLabel.font = _buttonTextFont;</span><br><span class="line">[button setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];</span><br><span class="line">[button setTitle:title forState:UIControlStateNormal];</span><br><span class="line"></span><br><span class="line">//按钮的点击事件，统一处理</span><br><span class="line">[button addTarget:self action:@selector(buttonDidClick:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line"></span><br><span class="line">//保存到数组</span><br><span class="line">[_buttons addObject:button];</span><br><span class="line"></span><br><span class="line">return button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)buttonDidClick:(SFPayAlertButton *)clickedBtn</span><br><span class="line">&#123;</span><br><span class="line">__weak __typeof(self)weakSelf = self;</span><br><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">__strong __typeof(weakSelf)strongSelf = weakSelf;</span><br><span class="line"></span><br><span class="line">if (clickedBtn.onButtonClick) &#123;</span><br><span class="line">clickedBtn.onButtonClick(clickedBtn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//如果Alert只是显示提示信息，点击按钮后，直接移除Alert</span><br><span class="line">if (strongSelf-&gt;_type == XZHAlertViewTypeInfo) &#123;</span><br><span class="line">[strongSelf onAlertViewDismiss:nil];</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>添加输入框</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (SFPayAlertTextfiled *)addInputItemWithPlaceholder:(NSString *)placeHolder</span><br><span class="line">OnValueChanged:(void (^)(SFPayAlertTextfiled *clickItem)) callback</span><br><span class="line">&#123;</span><br><span class="line">SFPayAlertTextfiled *filed = [[SFPayAlertTextfiled alloc] init];</span><br><span class="line">filed.delegate = self;</span><br><span class="line">filed.layer.borderWidth = 1;</span><br><span class="line">filed.placeholder = placeHolder;</span><br><span class="line">filed.onChanged = callback;</span><br><span class="line">[_rootView addSubview:filed];</span><br><span class="line"></span><br><span class="line">[_inputs addObject:filed];</span><br><span class="line"></span><br><span class="line">return filed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>UITextfiledDelegate方法，检验输入框的值是否合法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)textFieldShouldReturn:(SFPayAlertTextfiled *)textField &#123;</span><br><span class="line">if (textField == [_inputs lastObject]) &#123;</span><br><span class="line">if ([self isLengthForTextfile:textField]) &#123;</span><br><span class="line">[textField resignFirstResponder];</span><br><span class="line">textField.layer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">textField.layer.borderColor = [UIColor redColor].CGColor;</span><br><span class="line">&#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">if ([self isLengthForTextfile:textField]) &#123;</span><br><span class="line">NSInteger currentIdx = [_inputs indexOfObject:textField];</span><br><span class="line">[[_inputs objectAtIndex:(currentIdx + 1)] becomeFirstResponder];</span><br><span class="line">textField.layer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">textField.layer.borderColor = [UIColor redColor].CGColor;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isLengthForTextfile:(SFPayAlertTextfiled *)filed &#123;</span><br><span class="line">if (filed.text.length &gt;= kTextfileLength) &#123;</span><br><span class="line">return YES;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">return NO;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如下方法必须重写</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)requiresConstraintBasedLayout &#123;</span><br><span class="line">return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>重写系统更新约束的函数，设置 <code>_rootView</code>的最终约束</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">- (void)updateViewConstraints &#123;</span><br><span class="line"></span><br><span class="line">//如果显示提示提示，使用的 _contentLabel</span><br><span class="line">if (_contentLabel) &#123;</span><br><span class="line"></span><br><span class="line">//1. 得到size</span><br><span class="line">__block CGSize size = [_contentLabel sizeThatFits:CGSizeMake(_contentLabel.preferredMaxLayoutWidth, MAXFLOAT)];</span><br><span class="line"></span><br><span class="line">//2. 设置 _contentLabel的约束</span><br><span class="line">[_contentLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">make.left.mas_equalTo(_rootView.mas_left).offset(_Padding);</span><br><span class="line">make.width.mas_equalTo(_AlertViewWidth - 2 * _Padding);</span><br><span class="line">make.top.mas_equalTo(_titleLabel.mas_bottom).offset(_Padding);</span><br><span class="line"></span><br><span class="line">//主要是设置高度约束</span><br><span class="line">make.height.mas_equalTo(size.height);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//3. 累计高度</span><br><span class="line">_AlertViewHeight += size.height;</span><br><span class="line">_AlertViewHeight += _Padding;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//最终设置 _rootView（Alert）的约束</span><br><span class="line">[_rootView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line"></span><br><span class="line">//设置中心约束</span><br><span class="line">make.center.mas_equalTo(self.view);</span><br><span class="line">make.width.mas_equalTo(_AlertViewWidth);</span><br><span class="line"></span><br><span class="line">//主要是将最后累计得到的高度</span><br><span class="line">//设置给 _rootView</span><br><span class="line">make.height.mas_equalTo(_AlertViewHeight);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[super updateViewConstraints];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>小结更新约束</p>
</li>
<li><p>1) 提示信息Alert时，不能有<code>输入框</code></p>
</li>
<li><p>2) <code>_AlertViewHeight</code>变量最终累计的高度，作为<code>_rootView</code>的高度</p>
</li>
<li><p>iOS7</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (UIRectEdge)edgesForExtendedLayout &#123;</span><br><span class="line">return UIRectEdgeNone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>小结:</p>
</li>
<li><p>主要是通过 <code>[targetController.view addSubview:alertControlelr.view];</code></p>
</li>
<li><p>累计总高度，作为 Alert的高度</p>
</li>
<li><p>先添加完所有的subviews，然后进行约束的设置</p>
</li>
<li><p><code>https://git.coding.net/xiongzenghui/AutoLayout.git</code></p>
</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2017/08/12/Autolayout3/" data-title="Autolayout3 | 次元空间" data-tsina class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/2017/08/12/NSMutableAttributedString/" title="NSMutableAttributedString">
  <strong>上一篇：</strong><br>
  <span>
  NSMutableAttributedString</span>
</a>
</div>


<div class="next">
<a href="/2017/08/11/urlscheme/" title="urlscheme">
 <strong>下一篇：</strong><br> 
 <span>urlscheme
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2017/08/12/Autolayout3/" data-title="Autolayout3" data-url="http://yoursite.com/2017/08/12/Autolayout3/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Masonry使用记录一"><span class="toc-number">1.</span> <span class="toc-text">Masonry使用记录一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Masonry完成如下例子"><span class="toc-number">2.</span> <span class="toc-text">使用Masonry完成如下例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大概步骤"><span class="toc-number">3.</span> <span class="toc-text">大概步骤:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子1、UILabel高度动态变化、以及动态改变UIView的高度"><span class="toc-number">4.</span> <span class="toc-text">例子1、UILabel高度动态变化、以及动态改变UIView的高度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图示"><span class="toc-number">4.1.</span> <span class="toc-text">效果图示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现"><span class="toc-number">4.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的"><span class="toc-number">5.</span> <span class="toc-text">例子2、有点像例子1让中间的Label慢慢的变出来，给别人错觉是动态添加进来的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图"><span class="toc-number">5.1.</span> <span class="toc-text">效果图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现-1"><span class="toc-number">5.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子3、ScrollView"><span class="toc-number">6.</span> <span class="toc-text">例子3、ScrollView</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图示效果"><span class="toc-number">6.1.</span> <span class="toc-text">图示效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现-2"><span class="toc-number">6.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子4、键盘上的工具栏"><span class="toc-number">7.</span> <span class="toc-text">例子4、键盘上的工具栏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#例子5、Alert"><span class="toc-number">8.</span> <span class="toc-text">例子5、Alert</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图示-1"><span class="toc-number">8.1.</span> <span class="toc-text">效果图示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现-3"><span class="toc-number">8.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  

  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 业精于勤而荒于嬉，行成于思而毁于随 <br>
			天空不曾流过痕迹，但鸟儿已飞过天空</p>
	</section>
	 
	<div class="social-font">
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:codermoe@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="terriermon">terriermon</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"codermoe"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 









<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77667620-1', '');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
