
 <!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>weibo | 次元空间</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="terriermon">
    

    
    <meta name="description" content="###自己模仿Sina Weibo做了一个Demo，记录一下。  ###使用CocoaPods导入第三方的框架 1234567891011121314151617181920212223242526#自动布局pod &amp;apos;Masonry&amp;apos;				#依赖注入pod &amp;apos;Objection&amp;apos;#图片pod &amp;apos;SDWebImage&amp;apos;#网络pod &amp;ap">
<meta property="og:type" content="article">
<meta property="og:title" content="weibo">
<meta property="og:url" content="http://yoursite.com/2016/12/20/weibo/index.html">
<meta property="og:site_name" content="次元空间">
<meta property="og:description" content="###自己模仿Sina Weibo做了一个Demo，记录一下。  ###使用CocoaPods导入第三方的框架 1234567891011121314151617181920212223242526#自动布局pod &amp;apos;Masonry&amp;apos;				#依赖注入pod &amp;apos;Objection&amp;apos;#图片pod &amp;apos;SDWebImage&amp;apos;#网络pod &amp;ap">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://imgchr.com/images/iphoneipad.jpg">
<meta property="og:image" content="http://i5.tietuku.com/c3943cd9f4a53e75.png">
<meta property="og:image" content="http://i5.tietuku.com/efda687fd6187ce4.png">
<meta property="og:image" content="http://i5.tietuku.com/6105785533846699.png">
<meta property="og:image" content="http://i5.tietuku.com/f54bd6c49cf78ae0.png">
<meta property="og:image" content="http://i5.tietuku.com/09982d4441cf6bfe.png">
<meta property="og:image" content="http://i5.tietuku.com/8c5872ec1b6e925a.png">
<meta property="og:image" content="http://i5.tietuku.com/b8c4a0545678c82f.png">
<meta property="og:image" content="http://i12.tietuku.com/080168c769849398.png">
<meta property="og:image" content="http://i5.tietuku.com/b71671f241bed0dd.png">
<meta property="og:image" content="http://i12.tietuku.com/972818be9c4e7a27.png">
<meta property="og:image" content="http://i12.tietuku.com/3eddf5c021ff4df6.png">
<meta property="og:image" content="http://i12.tietuku.com/295783347c1cf3f7.png">
<meta property="og:image" content="http://i12.tietuku.com/3eddf5c021ff4df6.png">
<meta property="og:image" content="http://i5.tietuku.com/a4e33ca62f62c847.png">
<meta property="og:image" content="http://i5.tietuku.com/5396552a69aea743.png">
<meta property="og:image" content="http://i12.tietuku.com/295c15d39f695d1e.png">
<meta property="og:image" content="http://i12.tietuku.com/e464445c7384e7aa.png">
<meta property="og:image" content="http://i5.tietuku.com/98b355eda0e47f60.png">
<meta property="og:image" content="http://i5.tietuku.com/61f86f3c4d8b909d.png">
<meta property="og:image" content="http://i12.tietuku.com/8ad4cf4fde60f72d.png">
<meta property="og:image" content="http://i12.tietuku.com/dd56e5924099630f.png">
<meta property="og:image" content="http://i12.tietuku.com/f0900d861146fc51.png">
<meta property="og:image" content="http://i12.tietuku.com/922f9c7b02d301f7.png">
<meta property="og:image" content="http://i12.tietuku.com/71042278b899f81c.png">
<meta property="og:image" content="http://i12.tietuku.com/1125d7686d649bb1.png">
<meta property="og:image" content="http://i12.tietuku.com/bbc2c325330f33de.png">
<meta property="og:image" content="http://i12.tietuku.com/13710bbad82028db.png">
<meta property="og:image" content="http://i12.tietuku.com/3e022f9015c517be.png">
<meta property="og:image" content="http://i12.tietuku.com/5fccdb55210f7725.png">
<meta property="og:image" content="http://i5.tietuku.com/fb49b514fe37b43d.png">
<meta property="og:image" content="http://i5.tietuku.com/fb49b514fe37b43d.png">
<meta property="og:image" content="http://i5.tietuku.com/180ae0b0126a93eb.png">
<meta property="og:image" content="http://i12.tietuku.com/c09ee0333cf59abf.png">
<meta property="og:image" content="http://i12.tietuku.com/7d1372273232c293.png">
<meta property="og:image" content="http://i12.tietuku.com/344a4be7db6bb5c3.jpg">
<meta property="og:updated_time" content="2019-04-08T13:05:42.480Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="weibo">
<meta name="twitter:description" content="###自己模仿Sina Weibo做了一个Demo，记录一下。  ###使用CocoaPods导入第三方的框架 1234567891011121314151617181920212223242526#自动布局pod &amp;apos;Masonry&amp;apos;				#依赖注入pod &amp;apos;Objection&amp;apos;#图片pod &amp;apos;SDWebImage&amp;apos;#网络pod &amp;ap">
<meta name="twitter:image" content="http://imgchr.com/images/iphoneipad.jpg">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/courage.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/courage.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="次元空间" title="次元空间"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="次元空间">次元空间</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">异世界的大门</a></li>
					
						<li><a href="/archives">档案岛</a></li>
					
						<li><a href="/about">AboutMe</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search">
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/12/20/weibo/" title="weibo" itemprop="url">weibo</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="terriermon" target="_blank" itemprop="author">terriermon</a>
		
  </p><p class="article-time">
    <time datetime="2016-12-20T06:51:04.000Z" itemprop="datePublished"> Published 2016-12-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#找到一个ituns里面App的图片资源"><span class="toc-number">1.</span> <span class="toc-text">找到一个ituns里面App的图片资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#新浪服务器OAuth授权"><span class="toc-number">2.</span> <span class="toc-text">新浪服务器OAuth授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用于给定一个UIFont、最大宽度、最大高度、一个区域，来计算一段文字内容显示的size"><span class="toc-number">3.</span> <span class="toc-text">用于给定一个UIFont、最大宽度、最大高度、一个区域，来计算一段文字内容显示的size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义Cell的步骤"><span class="toc-number">4.</span> <span class="toc-text">自定义Cell的步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#举例微博Cell"><span class="toc-number">5.</span> <span class="toc-text">举例微博Cell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#首先弄基础Cell的类型"><span class="toc-number">5.1.</span> <span class="toc-text">首先弄基础Cell的类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带一张配图"><span class="toc-number">5.2.</span> <span class="toc-text">带一张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带三张配图"><span class="toc-number">5.3.</span> <span class="toc-text">带三张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带四张配图"><span class="toc-number">5.4.</span> <span class="toc-text">带四张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带九张配图"><span class="toc-number">5.5.</span> <span class="toc-text">带九张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带一张配图-1"><span class="toc-number">5.6.</span> <span class="toc-text">带一张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义Cell要显示数据的实体类模型"><span class="toc-number">5.7.</span> <span class="toc-text">定义Cell要显示数据的实体类模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在微博Cell上添加图片九宫格"><span class="toc-number">6.</span> <span class="toc-text">在微博Cell上添加图片九宫格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#给图片右下角添加识别为gif图片的功能"><span class="toc-number">7.</span> <span class="toc-text">给图片右下角添加识别为gif图片的功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图示效果"><span class="toc-number">7.1.</span> <span class="toc-text">图示效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现"><span class="toc-number">7.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义UITextView完成发送微博界面"><span class="toc-number">8.</span> <span class="toc-text">自定义UITextView完成发送微博界面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#问题-自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象"><span class="toc-number">8.1.</span> <span class="toc-text">问题: 自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题-直接在画布区域绘制文字，不能显示"><span class="toc-number">8.2.</span> <span class="toc-text">问题: 直接在画布区域绘制文字，不能显示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在键盘上方添加一个工具条ToolBar"><span class="toc-number">9.</span> <span class="toc-text">在键盘上方添加一个工具条ToolBar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图示效果-1"><span class="toc-number">9.1.</span> <span class="toc-text">图示效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#首先自定义一个工具条ToolBar"><span class="toc-number">9.2.</span> <span class="toc-text">首先自定义一个工具条ToolBar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的inputAccessoryView"><span class="toc-number">9.3.</span> <span class="toc-text">在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的inputAccessoryView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在键盘上方显示ToolBar方法二、"><span class="toc-number">9.4.</span> <span class="toc-text">在键盘上方显示ToolBar方法二、</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义一个表情键盘"><span class="toc-number">10.</span> <span class="toc-text">自定义一个表情键盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写一个选择图片的相册UI控件"><span class="toc-number">11.</span> <span class="toc-text">写一个选择图片的相册UI控件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#第一步、首先，导入用于获取用户手机设备上所有图片资源的framework-–-AssetsLibrary-framework"><span class="toc-number">11.1.</span> <span class="toc-text">第一步、首先，导入用于获取用户手机设备上所有图片资源的framework – AssetsLibrary.framework</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第二步、然后使用AssetsLibrary-framework获取"><span class="toc-number">11.2.</span> <span class="toc-text">第二步、然后使用AssetsLibrary.framework获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第三步、使用UICollectionView-UICollectionViewCell显示读取到的所有图片UIImage"><span class="toc-number">11.3.</span> <span class="toc-text">第三步、使用UICollectionView+UICollectionViewCell显示读取到的所有图片UIImage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第四步、提供回调Block，回传选择的多张UIImage"><span class="toc-number">11.4.</span> <span class="toc-text">第四步、提供回调Block，回传选择的多张UIImage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义表情键盘"><span class="toc-number">12.</span> <span class="toc-text">自定义表情键盘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#首先，理清楚UI的结构组成"><span class="toc-number">12.1.</span> <span class="toc-text">首先，理清楚UI的结构组成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#键盘上方的工具条"><span class="toc-number">12.2.</span> <span class="toc-text">键盘上方的工具条</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义键盘"><span class="toc-number">12.3.</span> <span class="toc-text">自定义键盘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义键盘底部选项卡按钮"><span class="toc-number">12.4.</span> <span class="toc-text">自定义键盘底部选项卡按钮</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读取表情文件"><span class="toc-number">13.</span> <span class="toc-text">读取表情文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#每一个表情都是使用Info-plist来配置"><span class="toc-number">13.1.</span> <span class="toc-text">每一个表情都是使用Info.plist来配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。"><span class="toc-number">13.2.</span> <span class="toc-text">查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#读取表情文件的info-plist"><span class="toc-number">13.3.</span> <span class="toc-text">读取表情文件的info.plist</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内部ScrollView布局每一个表情的思路"><span class="toc-number">14.</span> <span class="toc-text">内部ScrollView布局每一个表情的思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#接着上面在每一个表情按钮上填充图像"><span class="toc-number">14.1.</span> <span class="toc-text">接着上面在每一个表情按钮上填充图像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在网络上进行传输时，传输的是文字对应的十六进制数字，并不是直接传输图片或者字符串内容，大大减小流量"><span class="toc-number">15.</span> <span class="toc-text">在网络上进行传输时，传输的是文字对应的十六进制数字，并不是直接传输图片或者字符串内容，大大减小流量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#完成点击如上的表情按钮弹出一个View显示表情"><span class="toc-number">16.</span> <span class="toc-text">完成点击如上的表情按钮弹出一个View显示表情</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图"><span class="toc-number">16.1.</span> <span class="toc-text">效果图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片"><span class="toc-number">16.2.</span> <span class="toc-text">自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改EmotionKeyboradContentContainerView，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码"><span class="toc-number">16.3.</span> <span class="toc-text">修改EmotionKeyboradContentContainerView，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。"><span class="toc-number">16.4.</span> <span class="toc-text">修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#那么就需要把放大镜View添加到当前App程序的最上面的window中"><span class="toc-number">16.5.</span> <span class="toc-text">那么就需要把放大镜View添加到当前App程序的最上面的window中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame"><span class="toc-number">16.6.</span> <span class="toc-text">然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改后的效果图"><span class="toc-number">16.7.</span> <span class="toc-text">修改后的效果图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遇到的问题"><span class="toc-number">17.</span> <span class="toc-text">遇到的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CUICatalog-Invalid-asset-name-supplied-错误警告"><span class="toc-number">18.</span> <span class="toc-text">CUICatalog: Invalid asset name supplied:错误警告</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView基础使用"><span class="toc-number">19.</span> <span class="toc-text">UITextView基础使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView的代理方法如下"><span class="toc-number">20.</span> <span class="toc-text">UITextView的代理方法如下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#让UITextView自适应输入的文本的内容的高度"><span class="toc-number">21.</span> <span class="toc-text">让UITextView自适应输入的文本的内容的高度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView在光标所在处插入内容字符串"><span class="toc-number">22.</span> <span class="toc-text">UITextView在光标所在处插入内容字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView往回删除内容"><span class="toc-number">23.</span> <span class="toc-text">UITextView往回删除内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString"><span class="toc-number">24.</span> <span class="toc-text">将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView的如下两个属性"><span class="toc-number">25.</span> <span class="toc-text">UITextView的如下两个属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView内部特殊文字点击做出响应的思路"><span class="toc-number">26.</span> <span class="toc-text">UITextView内部特殊文字点击做出响应的思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结-Frame和显示的数据-随实体对象数据改变而动态更新的代码模板"><span class="toc-number">27.</span> <span class="toc-text">小结: Frame和显示的数据 随实体对象数据改变而动态更新的代码模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如果是需要通过drawRect形式绘制"><span class="toc-number">28.</span> <span class="toc-text">如果是需要通过drawRect形式绘制</span></a></li></ol>
		
		</div>
		
		<p>###自己模仿Sina Weibo做了一个Demo，记录一下。</p>
<hr>
<p>###使用CocoaPods导入第三方的框架</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#自动布局</span><br><span class="line">pod &apos;Masonry&apos;				</span><br><span class="line"></span><br><span class="line">#依赖注入</span><br><span class="line">pod &apos;Objection&apos;</span><br><span class="line"></span><br><span class="line">#图片</span><br><span class="line">pod &apos;SDWebImage&apos;</span><br><span class="line"></span><br><span class="line">#网络</span><br><span class="line">pod &apos;AFNetworking&apos;</span><br><span class="line"></span><br><span class="line">#保密存储</span><br><span class="line">pod &apos;SSKeychain&apos;</span><br><span class="line"></span><br><span class="line">#Aop</span><br><span class="line">pod &apos;Aspects&apos;</span><br><span class="line"></span><br><span class="line">#JSON Model</span><br><span class="line">pod &apos;NSObject-ObjectMap&apos;</span><br><span class="line"></span><br><span class="line">#CoreData</span><br><span class="line">pod &apos;ObjectiveRecord&apos;</span><br><span class="line"></span><br><span class="line">#TabBar</span><br><span class="line">pod &apos;RDVTabBarController&apos;</span><br></pre></td></tr></table></figure>
<hr>
<p>###首先规划一下项目的目录结构</p>
<ul>
<li><p><code>Classes</code>目录</p>
<ul>
<li><p><code>AppStart</code>目录</p>
<ul>
<li>AppDelegate</li>
<li>main.m</li>
</ul>
</li>
<li><p><code>AppConfig</code>目录</p>
<ul>
<li>存放App配置相关的文件</li>
</ul>
</li>
<li><p><code>Controllers</code></p>
<ul>
<li>Login<ul>
<li>ViewController目录</li>
<li>Subviews目录</li>
</ul>
</li>
<li>Regist<ul>
<li>ViewController目录</li>
<li>Subviews目录</li>
</ul>
</li>
</ul>
</li>
<li><p><code>BaseClass</code>目录</p>
<ul>
<li>存放一些提供基础公共代码的<code>父类</code></li>
<li>BaseViewController</li>
<li>BaseTableViewController</li>
<li>BaseCell</li>
<li>BaseViewModel</li>
</ul>
</li>
<li><p><code>Network</code>目录</p>
<ul>
<li>Login目录<ul>
<li>LoginRequest</li>
</ul>
</li>
<li>Regist目录<ul>
<li>RegistRequest</li>
</ul>
</li>
</ul>
</li>
<li><p><code>EntityModel</code>目录</p>
<ul>
<li>存放实体类模型</li>
<li>EntityCustomer</li>
<li>EntityXxx</li>
</ul>
</li>
<li><p><code>EntityPersistent</code>目录</p>
<ul>
<li>完成实体类对象与数据库表映射的框架类库</li>
<li>1) 基于CoreData封装，优先这种</li>
<li>2) 基于FMDB封装</li>
</ul>
</li>
<li><p><code>Modules</code>目录</p>
<ul>
<li>用于使用<code>Objection</code>将<code>业务接口</code>与<code>业务实现</code>关联起来的module</li>
<li>ViewControllerModule目录， 管理控制器抽象</li>
<li>BusinessViewModelModule目录，管理ViewModel抽象</li>
<li>等等..</li>
</ul>
</li>
<li><p><code>BusinessViewModel</code>目录</p>
<ul>
<li>业务模块1目录<ul>
<li><code>Interface</code>目录，<code>抽象接口</code></li>
<li><code>Implementation</code>目录，<code>接口具体实现</code></li>
</ul>
</li>
<li>业务模块2目录<ul>
<li>Interface目录，抽象接口</li>
<li>Implementation目录，接口具体实现</li>
</ul>
</li>
<li>业务模块3目录<ul>
<li>Interface目录，抽象接口</li>
<li>Implementation目录，接口具体实现</li>
</ul>
</li>
</ul>
</li>
<li><p>Tools目录</p>
<ul>
<li>存放一些工具类</li>
<li><code>Cache</code> 提供缓存相关功能</li>
<li>正则式</li>
<li>等等</li>
</ul>
</li>
<li><p>Categories目录</p>
<ul>
<li>存放一些分类</li>
<li>NSString分类</li>
<li>NSObject分类</li>
<li>UIView分类</li>
<li>NSMutableArray分类</li>
<li>等等..</li>
</ul>
</li>
<li><p>Vender目录</p>
<ul>
<li>存放一些SDK目录</li>
<li>腾讯SDK目录</li>
<li>微博SDK目录</li>
<li>支付SDK目录</li>
<li>等等…</li>
</ul>
</li>
</ul>
</li>
<li><p>Resources目录</p>
<ul>
<li>Weibo.xcdatamodeld</li>
<li>Info.plist</li>
<li>其他各种资源文件</li>
</ul>
</li>
</ul>
<hr>
<p>###整个应用程序从<code>main.m</code>开始，有必要总结下他干一些什么</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &quot;AppDelegate.h&quot;</span><br><span class="line"></span><br><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>####解析UIApplicationMain()</p>
<ul>
<li>函数的声明</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int UIApplicationMain(int argc, char *argv[], NSString * __nullable principalClassName, NSString * __nullable delegateClassName)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>该函数有4个参数是什么</p>
<ul>
<li>参数1和参数2，是传入给main函数的参数，我们不用管</li>
<li>参数3，一般传入nil，系统会创建默认UIApplication类的实例。那么也就是说可以传入我们自己继承自UIApplication完成的子类。</li>
<li>参数4，传入一个UIApplication对象的代理对象，需要实现<code>UIApplicationDelegate</code>定义的抽象方法</li>
</ul>
</li>
</ul>
<ul>
<li><p>该函数做的事情</p>
<ul>
<li><p>创建出一个<code>UIApplication</code>对象</p>
</li>
<li><p>将我们传入的<code>AppDelegate</code>类的实例，作为<code>UIApplication</code>的代理实现对象</p>
</li>
<li><p>启动<code>主事件运行循环</code>，并开始接收事件</p>
</li>
<li><p>加载info.plist文件，并判断是否加载<code>Main.storaboard</code>文件初始化.</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>将开启的<code>主事件循环</code>放入到autoreleasepool，为了最后释放掉内部使用的对象及变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;</span><br><span class="line">    return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="找到一个ituns里面App的图片资源"><a href="#找到一个ituns里面App的图片资源" class="headerlink" title="找到一个ituns里面App的图片资源"></a>找到一个ituns里面App的图片资源</h3><ul>
<li>打开ituns，下载一个App</li>
<li>在ituns目录下，会得到一个<code>xxx.ipa</code>文件</li>
<li>将<code>xxx.ipa</code>改成<code>xxx.rar</code></li>
<li>然后解压缩</li>
<li>找到解压缩的文件目录中的<code>Payload/</code>下有一个文件，比如<code>weibo</code></li>
<li>然后对着这个文件<code>weibo</code>，右键<code>显示包内容</code></li>
<li>即可显示所有的图片资源</li>
</ul>
<hr>
<p>###iphone、ipad适配</p>
<ul>
<li>Frame时代，使用<code>autoresizingMask</code>属性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">enum &#123;</span><br><span class="line">   UIViewAutoresizingNone                 = 0, //不设置自动调整</span><br><span class="line">   </span><br><span class="line">   UIViewAutoresizingFlexibleLeftMargin   = 1 &lt;&lt; 0,//保证与superView【左】边的距离不变</span><br><span class="line">   UIViewAutoresizingFlexibleRightMargin  = 1 &lt;&lt; 2,//保证与superView【右】边的距离不变</span><br><span class="line">   UIViewAutoresizingFlexibleTopMargin    = 1 &lt;&lt; 3,//保证与superView【顶】部的距离不变</span><br><span class="line">   UIViewAutoresizingFlexibleBottomMargin = 1 &lt;&lt; 5 //保证与superView【底】部的距离不变</span><br><span class="line">   </span><br><span class="line">   UIViewAutoresizingFlexibleWidth        = 1 &lt;&lt; 1,//自动调整自己的宽度，保证与superView的【左边】和【右边】的距离不变</span><br><span class="line">   UIViewAutoresizingFlexibleHeight       = 1 &lt;&lt; 4,//自动调整自己的高度，保证与superView的【顶部】和【底部】的距离不变</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>AutoLayout时代，给UIView设置<code>consrtaints</code>约束，但是只是针对<code>某一种类型</code>的设备的不同<code>屏幕方向</code></p>
<ul>
<li>xib设置</li>
<li>storaborad设置</li>
<li>代码设置、通过第三方框架<code>Masonry</code>等</li>
<li>问题: 无法一套代码，适配 iphone、ipad、itouch、iWatch…</li>
</ul>
</li>
<li><p><code>SizeClass + AutoLayout</code>可以更好的完成各种平台一套代码，到处运行</p>
<ul>
<li><code>SizeClass</code>可以针对不同的<code>设备类型</code>、不同的<code>屏幕方向</code>来区分写UI布局</li>
<li><code>AutoLayout</code>来完成具体的<code>设备类型+屏幕方向</code>UI布局的代码编写</li>
</ul>
</li>
</ul>
<p><img src="http://imgchr.com/images/iphoneipad.jpg" alt="iphoneipad.jpg"></p>
<hr>
<h3 id="新浪服务器OAuth授权"><a href="#新浪服务器OAuth授权" class="headerlink" title="新浪服务器OAuth授权"></a>新浪服务器OAuth授权</h3><ul>
<li>第一步、OAuth得到code</li>
<li>第二步、使用code获取AccessToken</li>
<li><p>第三步、以后的所有接口请求带上AccessToken即可（代替用户名和密码）</p>
</li>
<li><p>使用<code>UIWebView</code>加载H5页面，拦截到转发的URL，取出其中的code字段</p>
</li>
</ul>
<hr>
<h3 id="用于给定一个UIFont、最大宽度、最大高度、一个区域，来计算一段文字内容显示的size"><a href="#用于给定一个UIFont、最大宽度、最大高度、一个区域，来计算一段文字内容显示的size" class="headerlink" title="用于给定一个UIFont、最大宽度、最大高度、一个区域，来计算一段文字内容显示的size"></a>用于给定一个UIFont、<code>最大宽度、最大高度、一个区域</code>，来计算一段文字内容显示的size</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSString (Extension)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  给定一个最大的宽高区域，计算文字的显示的大小</span><br><span class="line"> */</span><br><span class="line">- (CGSize)sizeWithFont:(UIFont*)font maxSize:(CGSize)maxSize;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  给地一个最大的宽度，计算文字的显示的大小，适用于Label字典换行时</span><br><span class="line"> */</span><br><span class="line">- (CGSize)sizeWithfont:(UIFont*)font MaxWith:(CGFloat)maxWith;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  不限制宽度、不限制高度，来计算文字的显示的大小，适用于比较小的文字显示</span><br><span class="line"> */</span><br><span class="line">- (CGSize)sizeWithfont:(UIFont*)font;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;NSString+Extension.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation NSString (Extension)</span><br><span class="line"></span><br><span class="line">- (CGSize)sizeWithFont:(UIFont *)font maxSize:(CGSize)maxSize;</span><br><span class="line">&#123;</span><br><span class="line">    //1.</span><br><span class="line">    NSDictionary *attrs = @&#123;</span><br><span class="line">                            NSFontAttributeName : font</span><br><span class="line">                            &#125;;</span><br><span class="line">    </span><br><span class="line">    //2.</span><br><span class="line">    NSStringDrawingOptions options = NSStringDrawingUsesLineFragmentOrigin| \</span><br><span class="line">                                        NSStringDrawingTruncatesLastVisibleLine| \</span><br><span class="line">                                        NSStringDrawingUsesDeviceMetrics| \</span><br><span class="line">                                        NSStringDrawingUsesFontLeading;</span><br><span class="line">    //3.</span><br><span class="line">    CGSize size = [self boundingRectWithSize:maxSize</span><br><span class="line">                                     options:options</span><br><span class="line">                                  attributes:attrs</span><br><span class="line">                                     context:nil].size;</span><br><span class="line">    </span><br><span class="line">    return size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGSize)sizeWithfont:(UIFont*)font MaxWith:(CGFloat)maxWith</span><br><span class="line">&#123;</span><br><span class="line">    //1.</span><br><span class="line">    NSDictionary *attrs = @&#123;</span><br><span class="line">                            NSFontAttributeName : font</span><br><span class="line">                            &#125;;</span><br><span class="line">    </span><br><span class="line">    //2.</span><br><span class="line">    CGSize maxSize = CGSizeMake(maxWith, MAXFLOAT);</span><br><span class="line">    </span><br><span class="line">    //3.</span><br><span class="line">    return [self boundingRectWithSize:maxSize</span><br><span class="line">                              options:NSStringDrawingUsesLineFragmentOrigin</span><br><span class="line">                           attributes:attrs</span><br><span class="line">                              context:nil].size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGSize)sizeWithfont:(UIFont*)font</span><br><span class="line">&#123;</span><br><span class="line">    return [self sizeWithfont:font MaxWith:MAXFLOAT];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="自定义Cell的步骤"><a href="#自定义Cell的步骤" class="headerlink" title="自定义Cell的步骤"></a>自定义Cell的步骤</h3><ul>
<li><p>一、新建一个UITableViewCell子类</p>
</li>
<li><p>二、重写<code>initWithStyle:</code>方法</p>
<ul>
<li>创建所有的Sub UIView实例</li>
<li>将所有的subviews实例添加到UITableView.<code>contentView</code>中</li>
<li>对一些subview设置基础属性（字体大小、字体名、字体颜色、背景色..）</li>
</ul>
</li>
<li><p>三、提供两个模型</p>
<ul>
<li>模型1、<code>实体类</code>模型:存储Cell上所有subviews显示需要的数据，来决定某些subview是显示or隐藏</li>
<li>模型2、<code>Frame</code>模型: 存储Cell显示的frame大小，主要是高度</li>
</ul>
</li>
<li><p>四、UITableViewDelegate的高度回调函数中</p>
<ul>
<li>返回<code>Frame模型</code>记录的<code>高度</code></li>
<li>其实是做了一个Cell的<code>高度缓存</code>方案</li>
</ul>
</li>
</ul>
<hr>
<h3 id="举例微博Cell"><a href="#举例微博Cell" class="headerlink" title="举例微博Cell"></a>举例微博Cell</h3><h4 id="首先弄基础Cell的类型"><a href="#首先弄基础Cell的类型" class="headerlink" title="首先弄基础Cell的类型"></a>首先弄基础Cell的类型</h4><ul>
<li>Cell类型1、<code>原创微博</code> + <code>只有文字</code></li>
</ul>
<p><img src="http://i5.tietuku.com/c3943cd9f4a53e75.png" alt></p>
<ul>
<li>Cell类型2、<code>原创微博</code> + <code>有文字</code> + <code>有配图</code></li>
</ul>
<h4 id="带一张配图"><a href="#带一张配图" class="headerlink" title="带一张配图"></a>带一张配图</h4><p><img src="http://i5.tietuku.com/efda687fd6187ce4.png" alt></p>
<h4 id="带三张配图"><a href="#带三张配图" class="headerlink" title="带三张配图"></a>带三张配图</h4><p><img src="http://i5.tietuku.com/6105785533846699.png" alt></p>
<h4 id="带四张配图"><a href="#带四张配图" class="headerlink" title="带四张配图"></a>带四张配图</h4><p><img src="http://i5.tietuku.com/f54bd6c49cf78ae0.png" alt></p>
<h4 id="带九张配图"><a href="#带九张配图" class="headerlink" title="带九张配图"></a>带九张配图</h4><p><img src="http://i5.tietuku.com/09982d4441cf6bfe.png" alt></p>
<ul>
<li>Cell类型3、<code>转发微博</code> + <code>只有文字</code></li>
</ul>
<p><img src="http://i5.tietuku.com/8c5872ec1b6e925a.png" alt></p>
<ul>
<li>Cell类型4、<code>转发微博</code> + <code>有文字</code> + <code>有配图</code></li>
</ul>
<h4 id="带一张配图-1"><a href="#带一张配图-1" class="headerlink" title="带一张配图"></a>带一张配图</h4><p><img src="http://i5.tietuku.com/b8c4a0545678c82f.png" alt></p>
<p>####带二张配图</p>
<p><img src="http://i12.tietuku.com/080168c769849398.png" alt></p>
<p>####带九张配图</p>
<p><img src="http://i5.tietuku.com/b71671f241bed0dd.png" alt></p>
<h4 id="定义Cell要显示数据的实体类模型"><a href="#定义Cell要显示数据的实体类模型" class="headerlink" title="定义Cell要显示数据的实体类模型"></a>定义Cell要显示数据的<code>实体类</code>模型</h4><ul>
<li><code>Statuses</code>微博实体类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &quot;User.h&quot;</span><br><span class="line"></span><br><span class="line">@interface Statuses : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *idstr;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSNumber *attitudes_count;</span><br><span class="line">@property (nonatomic, strong) NSNumber *biz_feature;</span><br><span class="line">@property (nonatomic, strong) NSNumber *comments_count;</span><br><span class="line">@property (nonatomic, strong) NSNumber *favorited;</span><br><span class="line">@property (nonatomic, strong) NSNumber *reposts_count;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *created_at;</span><br><span class="line">@property (nonatomic, copy) NSString *text;</span><br><span class="line">@property (nonatomic, copy) NSString *source;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *thumbnail_pic;</span><br><span class="line">@property (nonatomic, copy) NSString *bmiddle_pic;</span><br><span class="line">@property (nonatomic, copy) NSString *original_pic;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) User *user;</span><br><span class="line"></span><br><span class="line">//来自的转发微博</span><br><span class="line">@property (nonatomic, strong) Statuses *retweeted_status;</span><br><span class="line"></span><br><span class="line">//配图数组</span><br><span class="line">@property (nonatomic, strong) NSArray *pic_urls;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  拼接得到转发微博的内容</span><br><span class="line"> */</span><br><span class="line">- (NSString *)retweetContent;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;Statuses.h&quot;</span><br><span class="line">#import &lt;MJExtension.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation Statuses</span><br><span class="line"></span><br><span class="line">//load方法中，添加对数组中的每一个元素类型的描述，方便JSON转Model</span><br><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">    [Statuses mj_setupObjectClassInArray:^NSDictionary *&#123;</span><br><span class="line">        </span><br><span class="line">        return @&#123;</span><br><span class="line">                 @&quot;pic_urls&quot; : @&quot;ThunbImage&quot;</span><br><span class="line">                 &#125;;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSString *)retweetContent &#123;</span><br><span class="line">    return [NSString stringWithFormat:@&quot;%@ : %@&quot;, self.retweeted_status.user.name, self.retweeted_status.text];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>User</code>实体类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface User : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *idstr;</span><br><span class="line">@property (nonatomic, strong) NSNumber *mbtype;</span><br><span class="line">@property (nonatomic, strong) NSNumber *mbrank;</span><br><span class="line">@property (nonatomic, copy) NSString *screen_name;</span><br><span class="line">@property (nonatomic, copy) NSString *name;</span><br><span class="line">@property (nonatomic, copy) NSString *location;</span><br><span class="line">@property (nonatomic, copy) NSString *url;</span><br><span class="line">@property (nonatomic, copy) NSString *profile_image_url;</span><br><span class="line">@property (nonatomic, copy) NSString *cover_image;</span><br><span class="line">@property (nonatomic, copy) NSString *cover_image_phone;</span><br><span class="line">@property (nonatomic, copy) NSString *profile_url;</span><br><span class="line">@property (nonatomic, copy) NSString *domain;</span><br><span class="line">@property (nonatomic, strong) NSNumber *followers_count;</span><br><span class="line">@property (nonatomic, strong) NSNumber *friends_count;</span><br><span class="line">@property (nonatomic, strong) NSNumber *favourites_count;</span><br><span class="line">@property (nonatomic, copy) NSString *created_at;</span><br><span class="line">@property (nonatomic, copy) NSString *avatar_large;</span><br><span class="line">@property (nonatomic, copy) NSString *avatar_hd;</span><br><span class="line">@property (nonatomic, copy) NSString *verified_reason;</span><br><span class="line"></span><br><span class="line">//添加一个vip变量，并且提供一个get方法叫做isVip</span><br><span class="line">@property (nonatomic, assign, getter = isVip) BOOL vip;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@implementation User</span><br><span class="line"></span><br><span class="line">- (BOOL)isVip &#123;</span><br><span class="line">    return self.mbrank.integerValue &gt; 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><p>接着定义<code>FrameModel</code>用来针对某一个<code>实体类Model</code>实例，来计算在Cell上显示的所有subviews的frame，以及cell的总高度。这样做的好处是，所有位置的实体类数据在cell上显示的frame都在第一次以及计算完毕，以后不用再计算。</p>
<ul>
<li>FrameModel包含一个<code>实体类Model</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">#import &quot;Statuses.h&quot;</span><br><span class="line">#define padding 10</span><br><span class="line">#define NameFont  [UIFont systemFontOfSize:13.f]</span><br><span class="line">#define TimeFont  [UIFont systemFontOfSize:12.f]</span><br><span class="line">#define ContentFont  [UIFont systemFontOfSize:14.f]</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  这个模型类的职责:</span><br><span class="line"> *</span><br><span class="line"> *    1. 承载实体类模型Statuses实例</span><br><span class="line"> *    2. 计算负责显示Statuses实例对应的TableViewCell需要的frame</span><br><span class="line"> *          2.1 TableViewCell内部所有subviews显示的frame</span><br><span class="line"> *          2.2 TableViewCell自己显示的总高度</span><br><span class="line"> *    3. 所有的frame基于`[UIScreen mainScreen].bounds.size`计算</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">@interface StatusFrameModel : NSObject</span><br><span class="line"></span><br><span class="line">//实体类模型</span><br><span class="line">@property (nonatomic, strong) Statuses *status;</span><br><span class="line"></span><br><span class="line">//对应subview显示数据的frame</span><br><span class="line">@property (nonatomic, assign) CGRect iconImageViewFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect vipImageViewFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect photoImageViewFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect nameLabelFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect timeLabelFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect sourceLabelFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect contentLabelFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect contentContainerFrame;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) CGRect retweetContainerFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect retweetContentLabelFrame;</span><br><span class="line">@property (nonatomic, assign) CGRect retweetImageViewFrame;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) CGRect bottomContainerFrame;</span><br><span class="line"></span><br><span class="line">//最终cell的高度</span><br><span class="line">@property (nonatomic, assign) CGFloat cellHeight;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;StatusFrameModel.h&quot;</span><br><span class="line">#import &quot;NSString+Extension.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation StatusFrameModel</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  重写setter实体类对象方法，计算实体类对象在cell上显示的所有frame以及总高度</span><br><span class="line"> */</span><br><span class="line">- (void)setStatus:(Statuses *)status &#123;</span><br><span class="line"></span><br><span class="line">    _status = status;</span><br><span class="line">    </span><br><span class="line">    /** </span><br><span class="line">     * 计算所有数据项显示在cell上时对应的frame </span><br><span class="line">     *</span><br><span class="line">     *  规则1. 从上到下，累计计算</span><br><span class="line">     *  规则2. 从左到右，累计计算</span><br><span class="line">     */</span><br><span class="line">     </span><br><span class="line">     User *user = status.user;</span><br><span class="line">    </span><br><span class="line">    //头像frame</span><br><span class="line">    CGFloat iconWH = 50;</span><br><span class="line">    CGFloat iconX = padding;</span><br><span class="line">    CGFloat iconY = padding;</span><br><span class="line">    _iconImageViewFrame = CGRectMake(iconX, iconY, iconWH, iconWH);</span><br><span class="line">    </span><br><span class="line">    //昵称</span><br><span class="line">    CGFloat nameX = CGRectGetMaxX(_iconImageViewFrame) + padding;</span><br><span class="line">    CGFloat nameY = iconY;</span><br><span class="line">    CGSize nameSize = [user.name sizeWithfont:NameFont];</span><br><span class="line">    _nameLabelFrame = CGRectMake(nameX, nameY, nameSize.width, nameSize.height);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    //Vip图像</span><br><span class="line">    if ([user isVip]) &#123;//如果是会员才设置Vip图像</span><br><span class="line">        CGFloat vipX = CGRectGetMaxX(_nameLabelFrame) + padding;</span><br><span class="line">        CGFloat vipY = nameY;</span><br><span class="line">        CGFloat vipW = 14;</span><br><span class="line">        CGFloat vipH = nameSize.height;</span><br><span class="line">        _vipImageViewFrame = CGRectMake(vipX, vipY , vipW, vipH);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //时间</span><br><span class="line">    CGFloat timeX = nameX;</span><br><span class="line">    CGFloat timeY = CGRectGetMaxY(_nameLabelFrame) + padding;</span><br><span class="line">    CGSize timeSize = [status.created_at sizeWithfont:TimeFont];</span><br><span class="line">    _timeLabelFrame = CGRectMake(timeX, timeY, timeSize.width, timeSize.height);</span><br><span class="line">    </span><br><span class="line">    //来源</span><br><span class="line">    CGFloat sourX = CGRectGetMaxX(_timeLabelFrame) + padding;</span><br><span class="line">    CGFloat sourY = timeY;</span><br><span class="line">    CGSize sourSize = [status.created_at sizeWithfont:TimeFont];</span><br><span class="line">    _sourceLabelFrame = CGRectMake(sourX, sourY, sourSize.width, sourSize.height);</span><br><span class="line">    </span><br><span class="line">    //正文</span><br><span class="line">    CGFloat contentX = iconX;</span><br><span class="line">    CGFloat contentY = MAX(CGRectGetMaxY(_timeLabelFrame), CGRectGetMaxY(_iconImageViewFrame)) + padding;</span><br><span class="line">    CGFloat contentW = [UIScreen mainScreen].bounds.size.width - 2 * contentX;</span><br><span class="line">    CGFloat contentH = [status.text sizeWithfont:ContentFont MaxWidth:contentW].height;</span><br><span class="line">    _contentLabelFrame = CGRectMake(contentX, contentY, contentW, contentH);</span><br><span class="line">    </span><br><span class="line">    //配图</span><br><span class="line">    BOOL isHasPhotos = status.pic_urls.count &gt; 0;</span><br><span class="line">    </span><br><span class="line">    if (isHasPhotos) &#123;</span><br><span class="line">        CGFloat photoX = iconX;</span><br><span class="line">        CGFloat photoY = CGRectGetMaxY(_contentLabelFrame) + padding;</span><br><span class="line">        CGSize photoSize = [WeiboPhotoView photoViewSizeWithPhotoCount:status.pic_urls.count];</span><br><span class="line">        </span><br><span class="line">        _photoImageViewFrame = CGRectMake(photoX, photoY, photoSize.width, photoSize.height);</span><br><span class="line">        </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        </span><br><span class="line">        //如果实体类数据没有这个subview显示的数据项</span><br><span class="line">        _photoImageViewFrame = CGRectZero;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //顶部和中间的容器</span><br><span class="line">    CGFloat containerMiddleX = 0;</span><br><span class="line">    CGFloat containerMiddleY = 0;</span><br><span class="line">    CGFloat containerMiddleW = [UIScreen mainScreen].bounds.size.width;</span><br><span class="line">    CGFloat containerMiddleH;</span><br><span class="line">    </span><br><span class="line">    if (!isHasPhotos) &#123;</span><br><span class="line">        containerMiddleH = CGRectGetMaxY(_contentLabelFrame) + padding;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        containerMiddleH = CGRectGetMaxY(_photoImageViewFrame) + padding;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _contentContainerFrame = CGRectMake(containerMiddleX, containerMiddleY, containerMiddleW, containerMiddleH);</span><br><span class="line">   </span><br><span class="line">    //转发微博</span><br><span class="line">    BOOL isHasRetweet = (status.retweeted_status != nil);</span><br><span class="line">    </span><br><span class="line">    if (isHasRetweet) &#123;//存在转发微博</span><br><span class="line">        </span><br><span class="line">        //转发微博正文</span><br><span class="line">        CGFloat retweetContentX = padding;</span><br><span class="line">        CGFloat retweetContentY = padding;</span><br><span class="line">        CGFloat retweetContentW = [UIScreen mainScreen].bounds.size.width - 2 * padding;</span><br><span class="line">        CGFloat retweetContentH = [[status retweetContent] sizeWithfont:ContentFont MaxWidth:retweetContentW].height;</span><br><span class="line">        </span><br><span class="line">        _retweetContentLabelFrame = CGRectMake(retweetContentX, retweetContentY, retweetContentW, retweetContentH);</span><br><span class="line">        </span><br><span class="line">        //转发微博图片</span><br><span class="line">        BOOL isHasRetweetImage = (status.retweeted_status.pic_urls.count &gt; 0);</span><br><span class="line">        </span><br><span class="line">        if (isHasRetweetImage) &#123;//有微博配图</span><br><span class="line">            CGFloat retweetImageX = retweetContentX;</span><br><span class="line">            CGFloat retweetImageY = CGRectGetMaxY(_retweetContentLabelFrame) + padding;</span><br><span class="line">            CGSize retweetImageSize = [WeiboPhotoView photoViewSizeWithPhotoCount:status.retweeted_status.pic_urls.count];</span><br><span class="line">            </span><br><span class="line">            _retweetImageViewFrame = CGRectMake(retweetImageX, retweetImageY, retweetImageSize.width, retweetImageSize.height);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            //如果实体类数据没有这个subview显示的数据项</span><br><span class="line">            _retweetImageViewFrame = CGRectZero;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        //转发微博容器</span><br><span class="line">        CGFloat retweetContainerX = 0;</span><br><span class="line">        CGFloat retweetContainerW = [UIScreen mainScreen].bounds.size.width;</span><br><span class="line">        CGFloat retweetContainerY = CGRectGetMaxY(_contentContainerFrame);</span><br><span class="line">        CGFloat retweetContainerH;</span><br><span class="line">        </span><br><span class="line">        if (isHasRetweetImage) &#123;</span><br><span class="line">            retweetContainerH = CGRectGetMaxY(_retweetImageViewFrame) + padding;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            retweetContainerH = CGRectGetMaxY(_retweetContentLabelFrame) + padding;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        _retweetContainerFrame = CGRectMake(retweetContainerX, retweetContainerY, retweetContainerW, retweetContainerH);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        </span><br><span class="line">        //如果实体类数据没有这个subview显示的数据项</span><br><span class="line">        _retweetContainerFrame = CGRectZero;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //底部按钮容器</span><br><span class="line">    CGFloat bootmContainerX = 0;</span><br><span class="line">    CGFloat bootmContainerY;</span><br><span class="line">    CGFloat bootmContainerW = [UIScreen mainScreen].bounds.size.width;;</span><br><span class="line">    CGFloat bootmContainerH = 44;</span><br><span class="line">    </span><br><span class="line">    if (isHasRetweet) &#123;//有转发微博</span><br><span class="line">        bootmContainerY = CGRectGetMaxY(_retweetContainerFrame) + padding;</span><br><span class="line">    &#125; else &#123;//没有转发微博</span><br><span class="line">        bootmContainerY = CGRectGetMaxY(_contentContainerFrame) + padding;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _bottomContainerFrame = CGRectMake(bootmContainerX, bootmContainerY, bootmContainerW, bootmContainerH);</span><br><span class="line">    </span><br><span class="line">    //最终Cell高度</span><br><span class="line">    _cellHeight = CGRectGetMaxY(_bottomContainerFrame) + padding;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>Cell统一赋值<code>实体类Model</code>的协议接口定义</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@protocol TableViewCellProtocol &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  1. 所有的cell实现这个方法，</span><br><span class="line"> *  2. 将传入的实体类对象数据，填充到subviews显示</span><br><span class="line"> */</span><br><span class="line">- (void)setupData:(id)data;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>BaseCell实现如上的协议，做一个空实现</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &quot;TableViewCellProtocol.h&quot;</span><br><span class="line"></span><br><span class="line">@interface BaseTableViewCell : UITableViewCell &lt;TableViewCellProtocol&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *	使用传入的TableView查询缓存得到Cell对象，来屏蔽cell identifier</span><br><span class="line"> */</span><br><span class="line">+ (instancetype)instanceWithTableView:(UITableView *)tv;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;BaseTableViewCell.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation BaseTableViewCell</span><br><span class="line"></span><br><span class="line">//协议方法默认空实现</span><br><span class="line">- (void)setupData:(id)data &#123;&#125;</span><br><span class="line"></span><br><span class="line">//查询缓存cell方法空实现</span><br><span class="line">+ (instancetype)instanceWithTableView:(UITableView *)tv &#123;return nil;&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>最终的Cell继承自<code>BaseCell</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">#import &quot;BaseTableViewCell.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;StatusFrameModel.h&quot;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  微博Cell</span><br><span class="line"> */</span><br><span class="line">@interface WBTableViewCell : BaseTableViewCell</span><br><span class="line"></span><br><span class="line">+ (instancetype)instanceWithTableView:(UITableView *)tv;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@interface WBTableViewCell ()</span><br><span class="line"></span><br><span class="line">//-----------------------原创微博-----------------------</span><br><span class="line">@property (nonatomic, strong) UIView *contentContainer;</span><br><span class="line">@property (nonatomic, strong) UIImageView *iconImageView;//头像</span><br><span class="line">@property (nonatomic, strong) UIImageView *vipImageView;//VIP图像</span><br><span class="line">@property (nonatomic, strong) UIImageView *photoImageView;//配图</span><br><span class="line">@property (nonatomic, strong) UILabel *nameLabel;//昵称</span><br><span class="line">@property (nonatomic, strong) UILabel *timeLabel;//时间</span><br><span class="line">@property (nonatomic, strong) UILabel *sourceLabel;//来源</span><br><span class="line">@property (nonatomic, strong) UILabel *contentLabel;//正文</span><br><span class="line"></span><br><span class="line">//-----------------------转发微博-----------------------</span><br><span class="line">@property (nonatomic, strong) UIView *retweetContainer;</span><br><span class="line">@property (nonatomic, strong) UILabel *retweetContentLabel;</span><br><span class="line">@property (nonatomic, strong) UIImageView *retweetImageView;</span><br><span class="line"></span><br><span class="line">//-----------------------底部按钮-----------------------</span><br><span class="line">@property (nonatomic, strong) UIView *bottomContainer;</span><br><span class="line">//@property (nonatomic, strong) UIView *bottomContainer;</span><br><span class="line">//@property (nonatomic, strong) UIView *bottomContainer;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line">@implementation WBTableViewCell</span><br><span class="line"></span><br><span class="line">+ (NSString *)identifier &#123;</span><br><span class="line">    return NSStringFromClass([WBTableViewCell class]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)instanceWithTableView:(UITableView *)tv &#123;</span><br><span class="line">    WBTableViewCell *cell = [tv dequeueReusableCellWithIdentifier:[self identifier]];</span><br><span class="line">    if (!cell) &#123;</span><br><span class="line">        cell = [[WBTableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:[self identifier]];</span><br><span class="line">    &#125;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dealloc &#123;</span><br><span class="line">    </span><br><span class="line">    _iconImageView = nil;</span><br><span class="line">    _vipImageView = nil;</span><br><span class="line">    _photoImageView = nil;</span><br><span class="line">    </span><br><span class="line">    _nameLabel = nil;</span><br><span class="line">    _timeLabel = nil;</span><br><span class="line">    _sourceLabel = nil;</span><br><span class="line">    _contentLabel = nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithStyle:(UITableViewCellStyle)style</span><br><span class="line">              reuseIdentifier:(NSString *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithStyle:style reuseIdentifier:reuseIdentifier];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [self initSubviews];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark  添加所有subviews、以及设置</span><br><span class="line"></span><br><span class="line">- (void)initSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 让cell背景色透明，显示tableView的背景颜色</span><br><span class="line">    self.backgroundColor = [UIColor clearColor];</span><br><span class="line">    </span><br><span class="line">    //2. 初始化原创微博subviews</span><br><span class="line">    [self initOriginWeiboSubviews];</span><br><span class="line">    </span><br><span class="line">    //3. 初始化转发微博subviews</span><br><span class="line">    [self initRetweetWeiboSubviews];</span><br><span class="line">    </span><br><span class="line">    //4. 底部按钮</span><br><span class="line">    [self initBottomWeiboSubviews];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initOriginWeiboSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 初始化subviews</span><br><span class="line">    _contentContainer = [[UIView alloc] init];</span><br><span class="line">    _contentContainer.backgroundColor = [UIColor whiteColor];</span><br><span class="line">    </span><br><span class="line">    _iconImageView = [[UIImageView alloc] init];</span><br><span class="line">    _vipImageView = [[UIImageView alloc] init];</span><br><span class="line">    _photoImageView = [[UIImageView alloc] init];</span><br><span class="line">    </span><br><span class="line">    _nameLabel = [[UILabel alloc] init];</span><br><span class="line">    _timeLabel = [[UILabel alloc] init];</span><br><span class="line">    _contentLabel = [[UILabel alloc] init];</span><br><span class="line">    _sourceLabel = [[UILabel alloc] init];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    //2. subview基础设置</span><br><span class="line">    _iconImageView.contentMode = UIViewContentModeCenter;</span><br><span class="line">    _vipImageView.contentMode = UIViewContentModeCenter;</span><br><span class="line">    _photoImageView.contentMode = UIViewContentModeCenter;</span><br><span class="line">    </span><br><span class="line">    _nameLabel.font = NameFont;</span><br><span class="line">    _timeLabel.font = TimeFont;</span><br><span class="line">    _sourceLabel.font = TimeFont;</span><br><span class="line">    </span><br><span class="line">    _contentLabel.font = ContentFont;</span><br><span class="line">    //自动换行Label</span><br><span class="line">    _contentLabel.numberOfLines = 0;</span><br><span class="line">    //最大显示宽大Label</span><br><span class="line">    _contentLabel.preferredMaxLayoutWidth = [UIScreen mainScreen].bounds.size.width - 2 * padding;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    //3. 添加subviews</span><br><span class="line">    </span><br><span class="line">    [_contentContainer addSubview:_iconImageView];</span><br><span class="line">    [_contentContainer addSubview:_vipImageView];</span><br><span class="line">    [_contentContainer addSubview:_photoImageView];</span><br><span class="line">    [_contentContainer addSubview:_nameLabel];</span><br><span class="line">    [_contentContainer addSubview:_timeLabel];</span><br><span class="line">    [_contentContainer addSubview:_contentLabel];</span><br><span class="line">    [_contentContainer addSubview:_sourceLabel];</span><br><span class="line">    </span><br><span class="line">    [self.contentView addSubview:_contentContainer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initRetweetWeiboSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    _retweetContainer = [[UIView alloc] init];</span><br><span class="line">    _retweetContainer.backgroundColor = [UIColor orangeColor];</span><br><span class="line">    [self.contentView addSubview:_retweetContainer];</span><br><span class="line">    </span><br><span class="line">    _retweetContentLabel = [[UILabel alloc] init];</span><br><span class="line">    _retweetContentLabel.font = ContentFont;</span><br><span class="line">    _retweetContentLabel.numberOfLines = 0;</span><br><span class="line">    _retweetContentLabel.preferredMaxLayoutWidth = [UIScreen mainScreen].bounds.size.width - 2 * padding;</span><br><span class="line">    [_retweetContainer addSubview:_retweetContentLabel];</span><br><span class="line">    </span><br><span class="line">    _retweetImageView = [[UIImageView alloc] init];</span><br><span class="line">    [_retweetContainer addSubview:_retweetImageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initBottomWeiboSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    _bottomContainer = [[UIView alloc] init];</span><br><span class="line">    [self.contentView addSubview:_bottomContainer];</span><br><span class="line">    _bottomContainer.backgroundColor = [UIColor blueColor];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark  实体对象赋值协议方法实现</span><br><span class="line"></span><br><span class="line">- (void)setupData:(id)data</span><br><span class="line">&#123;</span><br><span class="line">    //传入的是FrameModel</span><br><span class="line">    if ([data isMemberOfClass:[StatusFrameModel class]])</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        //1.转换成 FrameModel</span><br><span class="line">        StatusFrameModel *frameModel = (StatusFrameModel *)data;</span><br><span class="line">        </span><br><span class="line">        //2. 完成subviews显示的实体对象数据、以及决定隐藏哪些subviews</span><br><span class="line">        [self setupSubviewsDatas:frameModel.status];</span><br><span class="line">        </span><br><span class="line">        //3. 设置所有subviews的frame，不显示的subview设置frame为CGRectZero</span><br><span class="line">        [self setupSubviewsFrame:frameModel];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 主要完成给subviews设置显示的数据，</span><br><span class="line"> * 全部subview都设置frame，不区分有没有数据</span><br><span class="line"> * 因为FrameModel中将没有数据项的subview的frame设置为CGRectZero，没有显示的大小</span><br><span class="line"> */</span><br><span class="line">- (void)setupSubviewsDatas:(Statuses *)status &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 设置头像数据</span><br><span class="line">    [_iconImageView sd_setImageWithURL:[NSURL URLWithString:status.user.profile_image_url] placeholderImage:[UIImage imageNamed:@&quot;avatar_default&quot;] options:SDWebImageProgressiveDownload];</span><br><span class="line">    </span><br><span class="line">    //3. 昵称显示</span><br><span class="line">    _nameLabel.text = status.user.name;</span><br><span class="line">    </span><br><span class="line">    //4. 会员等级显示</span><br><span class="line">    if (status.user.isVip) &#123;</span><br><span class="line">        </span><br><span class="line">        _vipImageView.image = [UIImage imageNamed:@&quot;common_icon_membership&quot;];</span><br><span class="line">        </span><br><span class="line">        //显示会员等级</span><br><span class="line">        _vipImageView.hidden = NO;</span><br><span class="line">        </span><br><span class="line">        //修改名字颜色</span><br><span class="line">        _nameLabel.textColor = [UIColor orangeColor];</span><br><span class="line">        </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        </span><br><span class="line">        //隐藏会员等级</span><br><span class="line">        _vipImageView.hidden = YES;</span><br><span class="line">        </span><br><span class="line">        //修改名字颜色</span><br><span class="line">        _nameLabel.textColor = [UIColor blackColor];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //5. 配图</span><br><span class="line">    _photoImageView.backgroundColor = [UIColor redColor];</span><br><span class="line">    </span><br><span class="line">    if (status.pic_urls.count &gt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        _photoImageView.hidden = NO;</span><br><span class="line">        </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        </span><br><span class="line">        _photoImageView.hidden = YES;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //6. 时间</span><br><span class="line">    _timeLabel.text = status.created_at;</span><br><span class="line">    </span><br><span class="line">    //7.正文</span><br><span class="line">    _contentLabel.text = status.text;</span><br><span class="line">    </span><br><span class="line">    //8. 来源</span><br><span class="line">    _sourceLabel.text = status.source;</span><br><span class="line">    _sourceLabel.textColor = [UIColor lightGrayColor];</span><br><span class="line">    </span><br><span class="line">    //9. 转发微博</span><br><span class="line">    if (status.retweeted_status) &#123;//有转发微博</span><br><span class="line">        </span><br><span class="line">        //9.1 转发微博容器</span><br><span class="line">        _retweetContainer.hidden = NO;</span><br><span class="line">        </span><br><span class="line">        //9.2 转发内容</span><br><span class="line">        _retweetContentLabel.text = [status retweetContent];</span><br><span class="line">        </span><br><span class="line">        //9.3 转发配图</span><br><span class="line">        if (status.retweeted_status.pic_urls) &#123;//转发微博有配图</span><br><span class="line">            _retweetImageView.hidden = NO;</span><br><span class="line">            _retweetImageView.backgroundColor = [UIColor yellowColor];</span><br><span class="line">            </span><br><span class="line">        &#125; else &#123;//转发微博无配图</span><br><span class="line">            _retweetImageView.hidden = YES;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; else &#123;//无转发微博</span><br><span class="line">        _retweetContainer.hidden = YES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  主要完成给subview设置显示的frame</span><br><span class="line"> */</span><br><span class="line">- (void)setupSubviewsFrame:(StatusFrameModel *)frameModel</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    //1.</span><br><span class="line">    _contentContainer.frame = frameModel.contentContainerFrame;</span><br><span class="line">    </span><br><span class="line">    //2.</span><br><span class="line">    _iconImageView.frame = frameModel.iconImageViewFrame;</span><br><span class="line">    </span><br><span class="line">    //3.</span><br><span class="line">    _nameLabel.frame = frameModel.nameLabelFrame;</span><br><span class="line">    </span><br><span class="line">    //4.</span><br><span class="line">    _vipImageView.frame = frameModel.vipImageViewFrame;</span><br><span class="line">    </span><br><span class="line">    //5.</span><br><span class="line">    _photoImageView.frame = frameModel.photoImageViewFrame;</span><br><span class="line">    </span><br><span class="line">    //6.</span><br><span class="line">    _timeLabel.frame = frameModel.timeLabelFrame;</span><br><span class="line">    </span><br><span class="line">    //7.</span><br><span class="line">    _contentLabel.frame = frameModel.contentLabelFrame;</span><br><span class="line">    </span><br><span class="line">    //8.</span><br><span class="line">    _sourceLabel.frame = frameModel.sourceLabelFrame;</span><br><span class="line">    </span><br><span class="line">    //9.</span><br><span class="line">    _retweetContainer.frame = frameModel.retweetContainerFrame;</span><br><span class="line">    _retweetContentLabel.frame = frameModel.retweetContentLabelFrame;</span><br><span class="line">    _retweetImageView.frame = frameModel.retweetImageViewFrame;</span><br><span class="line">    </span><br><span class="line">    //10.</span><br><span class="line">    _bottomContainer.frame = frameModel.bottomContainerFrame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>UITableViewController使用Cell</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface PullRefreshController ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSMutableArray *dataList;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">@implementation PullRefreshController</span><br><span class="line"></span><br><span class="line">#pragma mark UITableViewDelegate</span><br><span class="line"></span><br><span class="line">//取出对应的FrameModel，返回其计算的cell总高度</span><br><span class="line">-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    //1. 取出FrmaeModel</span><br><span class="line">    StatusFrameModel *frameModel = self.dataList[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    //2. 取出保存的cell高度</span><br><span class="line">    CGFloat height = frameModel.cellHeight;</span><br><span class="line">    </span><br><span class="line">    //3. 返回缓存好的cell高度</span><br><span class="line">    return height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark UITableViewDataSource</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section</span><br><span class="line">&#123;</span><br><span class="line">    return [self.dataList count];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    //1. 调用cell提供获取cell实例的方法</span><br><span class="line">    //id &lt;TableViewCellProcotol&gt; cell = ....;</span><br><span class="line">    WBTableViewCell *cell = [WBTableViewCell instanceWithTableView:tableView];</span><br><span class="line">    </span><br><span class="line">    //2. 取出当前cell所在的indexPath对应 FrameModel</span><br><span class="line">    id data = self.dataList[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    //3. 调用cell赋值FrameModel的协议接口方法</span><br><span class="line">    [cell setupData:data];</span><br><span class="line">    </span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIScrollViewDelegate</span><br><span class="line"></span><br><span class="line">//判断是否滚动到底部</span><br><span class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView&#123;</span><br><span class="line">    </span><br><span class="line">    //如果没有数据直接返回</span><br><span class="line">    if (self.dataList.count &lt; 1 || self.tableView.tableFooterView.isHidden == NO) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //当前scrollView滚动到的y坐标</span><br><span class="line">    CGFloat currntOffsetY = scrollView.contentOffset.y;</span><br><span class="line">    </span><br><span class="line">    //当最后一个cell完全显示时，scrollView的y坐标</span><br><span class="line">    CGFloat desOffsetY = scrollView.contentSize.height + scrollView.contentInset.bottom - scrollView.height - self.tableView.tableFooterView.height;</span><br><span class="line">    </span><br><span class="line">    if (currntOffsetY &gt;= desOffsetY) &#123;</span><br><span class="line">        //当最后一个cell完全显示</span><br><span class="line">        </span><br><span class="line">        //1. 显示footer</span><br><span class="line">        self.tableView.tableFooterView.hidden = NO;</span><br><span class="line">        </span><br><span class="line">        //2. 调用Api加载更多的数据</span><br><span class="line">        [self getOldWeibos];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>OK，如上是在<code>Frame</code>时代，完成自定义Cell的步骤。<br>但是到了<code>AutoLayout</code>时代，就不需要计算frame了，而是在<code>init的时候</code>和<code>updateConstraints的时候</code>设置<code>约束</code></p>
<hr>
<h3 id="在微博Cell上添加图片九宫格"><a href="#在微博Cell上添加图片九宫格" class="headerlink" title="在微博Cell上添加图片九宫格"></a>在微博Cell上添加图片九宫格</h3><ul>
<li><p>将显示九宫格布局图片的单独的UIView类<code>WeiboPhotoView</code></p>
</li>
<li><p><code>WeiboPhotoView</code>做的事情</p>
<ul>
<li>事情1、完成九宫格图片布局</li>
<li>事情2、提供计算九宫格布局最终的Size</li>
<li>事情3、不断的重用内部的9个UIImageView<ul>
<li>当前显示图片张数 &lt; WeiboPhotoView.subviews.count时，添加UIImageView<ul>
<li>处理1、UIImageView.hiden = NO;</li>
</ul>
</li>
<li>当前显示图片张数 &gt; WeiboPhotoView.subviews.count时，将多余的UIImageView做如下处理<ul>
<li>处理1、UIImageView.hiden = YES;</li>
<li>处理2、UIImageView.image = nil;</li>
<li>处理3、UIImageView.frame = CGRectZero;</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">//每一张图片的宽度和高度</span><br><span class="line">extern CGFloat PhotoWH;</span><br><span class="line"></span><br><span class="line">@interface WeiboPhotoView : UIView</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSArray *photos;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  根据传入显示的图片的张数得到最终尺寸</span><br><span class="line"> *</span><br><span class="line"> *  规定1: 最多显示9张图片</span><br><span class="line"> *  规定2: 一行最多显示3张图片</span><br><span class="line"> *  规定3: 最多显示3行</span><br><span class="line"> */</span><br><span class="line">+ (CGSize)photoViewSizeWithPhotoCount:(NSInteger)count;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;WeiboPhotoView.h&quot;</span><br><span class="line">#import &lt;SDWebImage/UIImageView+WebCache.h&gt;</span><br><span class="line">#import &quot;ThunbImage.h&quot;</span><br><span class="line"></span><br><span class="line">CGFloat PhotoWH = 70;</span><br><span class="line">CGFloat PhotoPadding = 10;</span><br><span class="line"></span><br><span class="line">@interface WeiboPhotoView ()</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WeiboPhotoView</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)setPhotos:(NSArray *)photos &#123;</span><br><span class="line">    _photos = photos;</span><br><span class="line">    </span><br><span class="line">    //添加与传入图片数相对的ImageView</span><br><span class="line">    while (self.subviews.count &lt; _photos.count) &#123;</span><br><span class="line">        UIImageView *subview = [[UIImageView alloc] init];</span><br><span class="line">        [self addSubview:subview];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //遍历ImageView，显示图片</span><br><span class="line">    for (NSInteger index = 0; index &lt; _photos.count; index++)</span><br><span class="line">    &#123;</span><br><span class="line">        UIView *subview = [self.subviews objectAtIndex:index];</span><br><span class="line">        </span><br><span class="line">        if (![subview isMemberOfClass:[UIImageView class]])</span><br><span class="line">            return;</span><br><span class="line"></span><br><span class="line">        UIImageView *imageView = (UIImageView *)subview;</span><br><span class="line">        </span><br><span class="line">        ThunbImage *item = [_photos objectAtIndex:index];</span><br><span class="line">        NSURL *imageURL = [NSURL URLWithString:[item thumbnail_pic]];</span><br><span class="line">        </span><br><span class="line">        if (index &lt; _photos.count) &#123;</span><br><span class="line">            </span><br><span class="line">            imageView.hidden = NO;</span><br><span class="line">            imageView.image = nil;</span><br><span class="line">            [imageView sd_setImageWithURL:imageURL placeholderImage:nil];</span><br><span class="line">            </span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            </span><br><span class="line">            imageView.hidden = YES;</span><br><span class="line">            imageView.image = nil;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIColor *)randomColor &#123;</span><br><span class="line">    CGFloat hue = ( arc4random() % 256 / 256.0 );  //  0.0 to 1.0</span><br><span class="line">    CGFloat saturation = ( arc4random() % 128 / 256.0 ) + 0.5;  //  0.5 to 1.0, away from white</span><br><span class="line">    CGFloat brightness = ( arc4random() % 128 / 256.0 ) + 0.5;  //  0.5 to 1.0, away from black</span><br><span class="line">    return [UIColor colorWithHue:hue saturation:saturation brightness:brightness alpha:1];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 布局subviews的frame</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    for (NSInteger i = 0; i &lt; self.subviews.count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        UIView *subview = [self.subviews objectAtIndex:i];</span><br><span class="line">       </span><br><span class="line">        if (![subview isMemberOfClass:[UIImageView class]])</span><br><span class="line">            return;</span><br><span class="line">            </span><br><span class="line">        if (i &lt; self.photos.count) &#123;</span><br><span class="line">            </span><br><span class="line">            NSInteger row = i / [[self class] maxColCountWithTotolCount:self.photos.count];</span><br><span class="line">            NSInteger col = i % [[self class] maxColCountWithTotolCount:self.photos.count];</span><br><span class="line">            </span><br><span class="line">            CGFloat x = (PhotoPadding + PhotoWH) * col + PhotoPadding;</span><br><span class="line">            CGFloat y = (PhotoPadding + PhotoWH) * row + PhotoPadding;</span><br><span class="line">            </span><br><span class="line">            CGRect rect = CGRectMake(x, y, PhotoWH, PhotoWH);</span><br><span class="line">            </span><br><span class="line">            subview.frame = rect;</span><br><span class="line">            </span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            subview.hidden = YES;</span><br><span class="line">            subview.frame = CGRectZero;</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  返回最大列数</span><br><span class="line"> */</span><br><span class="line">+ (NSInteger)maxColCountWithTotolCount:(NSInteger)count &#123;</span><br><span class="line">    </span><br><span class="line">    if (count == 4) &#123;//四张图片时，按照田字布局</span><br><span class="line">        return 2;//返回两列</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return 3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (CGSize)photoViewSizeWithPhotoCount:(NSInteger)count &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 最大列数</span><br><span class="line">    NSInteger maxColCount = [self maxColCountWithTotolCount:count];</span><br><span class="line">    </span><br><span class="line">    //2. 计算总列数</span><br><span class="line">    NSInteger colCount = (count &gt;= maxColCount) ? maxColCount : count;</span><br><span class="line">    </span><br><span class="line">    //3. 计算总行数</span><br><span class="line">    NSUInteger rowCount = (count + maxColCount - 1) / maxColCount;</span><br><span class="line">    </span><br><span class="line">    //4. 总宽度</span><br><span class="line">    CGFloat w = colCount * (PhotoPadding + PhotoWH) + PhotoPadding;</span><br><span class="line">    CGFloat h = rowCount * (PhotoPadding + PhotoWH) + PhotoPadding;</span><br><span class="line">    CGSize size = CGSizeMake(w, h);</span><br><span class="line">    </span><br><span class="line">    return size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>修改之前的Cell类，将UIImageView替换为封装的<code>WeiboPhotoView</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@interface WBTableViewCell ()</span><br><span class="line"></span><br><span class="line">//-----------------------原创微博-----------------------</span><br><span class="line">//...</span><br><span class="line">//@property (nonatomic, strong) UIImageView *photoImageView;//配图</span><br><span class="line">@property (nonatomic, strong) WeiboPhotoView *photoImageView;//配图</span><br><span class="line">//..</span><br><span class="line"></span><br><span class="line">//-----------------------转发微博-----------------------</span><br><span class="line">//...</span><br><span class="line">//@property (nonatomic, strong) UIImageView *retweetImageView;</span><br><span class="line">@property (nonatomic, strong) WeiboPhotoView *retweetImageView;</span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@implementation WBTableViewCell</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">- (void)initOriginWeiboSubviews &#123;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">//_photoImageView = [[UIImageView alloc] init];</span><br><span class="line">_photoImageView = [[WeiboPhotoView alloc] init];</span><br><span class="line"></span><br><span class="line">//..</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initRetweetWeiboSubviews &#123;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">//_retweetImageView = [[UIImageView alloc] init];</span><br><span class="line">_retweetImageView = [[WeiboPhotoView alloc] init];</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>StatusFrameModel</code>使用<code>WeiboPhotoView</code>提供的计算size的方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">导入.h</span><br><span class="line"></span><br><span class="line">#import &quot;WeiboPhotoView.h&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  重写setter实体类对象方法</span><br><span class="line"> */</span><br><span class="line">- (void)setStatus:(Statuses *)status &#123;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">	//配图</span><br><span class="line">    BOOL isHasPhotos = status.pic_urls.count &gt; 0;</span><br><span class="line">    </span><br><span class="line">    if (isHasPhotos) &#123;</span><br><span class="line">        CGFloat photoX = iconX;</span><br><span class="line">        CGFloat photoY = CGRectGetMaxY(_contentLabelFrame) + padding;</span><br><span class="line">//        CGFloat photoW = 80;</span><br><span class="line">//        CGFloat photoH = 80;</span><br><span class="line"></span><br><span class="line">		//得到计算的配图View的大小size</span><br><span class="line">        CGSize photoSize = [WeiboPhotoView photoViewSizeWithPhotoCount:status.pic_urls.count];</span><br><span class="line">//         _photoImageViewFrame = CGRectMake(photoX, photoY, photoW, photoH);</span><br><span class="line">        _photoImageViewFrame = CGRectMake(photoX, photoY, photoSize.width, photoSize.height);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        </span><br><span class="line">        //如果实体类数据没有这个subview显示的数据项</span><br><span class="line">        _photoImageViewFrame = CGRectZero;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">//...</span><br><span class="line">	</span><br><span class="line">	//转发微博</span><br><span class="line">    BOOL isHasRetweet = (status.retweeted_status != nil);</span><br><span class="line">    </span><br><span class="line">    if (isHasRetweet) &#123;//存在转发微博</span><br><span class="line">    </span><br><span class="line">    	//...</span><br><span class="line">    	</span><br><span class="line">    	BOOL isHasRetweetImage = (status.retweeted_status.pic_urls.count &gt; 0);</span><br><span class="line">    	</span><br><span class="line">    	if (isHasRetweetImage) &#123;//有微博配图</span><br><span class="line">            CGFloat retweetImageX = retweetContentX;</span><br><span class="line">            CGFloat retweetImageY = CGRectGetMaxY(_retweetContentLabelFrame) + padding;</span><br><span class="line">//            CGFloat retweetImageW = 80;</span><br><span class="line">//            CGFloat retweetImageH = 80;</span><br><span class="line"></span><br><span class="line">			//得到计算的配图View的大小size</span><br><span class="line">            CGSize retweetImageSize = [WeiboPhotoView photoViewSizeWithPhotoCount:status.pic_urls.count];</span><br><span class="line">//            _retweetImageViewFrame = CGRectMake(retweetImageX, retweetImageY, retweetImageW, retweetImageH);</span><br><span class="line">            _retweetImageViewFrame = CGRectMake(retweetImageX, retweetImageY, retweetImageSize.width, retweetImageSize.height);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            </span><br><span class="line">            //如果实体类数据没有这个subview显示的数据项</span><br><span class="line">            _retweetImageViewFrame = CGRectZero;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		//...</span><br><span class="line">		</span><br><span class="line">	&#125; else &#123; </span><br><span class="line">		</span><br><span class="line">		//...</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">//...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="给图片右下角添加识别为gif图片的功能"><a href="#给图片右下角添加识别为gif图片的功能" class="headerlink" title="给图片右下角添加识别为gif图片的功能"></a>给图片右下角添加识别为gif图片的功能</h3><h4 id="图示效果"><a href="#图示效果" class="headerlink" title="图示效果"></a>图示效果</h4><p><img src="http://i12.tietuku.com/972818be9c4e7a27.png" alt></p>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface WeiboPhotoImageView : UIImageView</span><br><span class="line"></span><br><span class="line">- (void)setImageURL:(NSString *)url;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;WeiboPhotoImageView.h&quot;</span><br><span class="line">#import &lt;SDWebImage/UIImageView+WebCache.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation WeiboPhotoImageView &#123;</span><br><span class="line">    UIImageView *iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        </span><br><span class="line">        //添加右下角的图片</span><br><span class="line">        UIImage *image = [UIImage imageNamed:@&quot;timeline_image_gif&quot;];</span><br><span class="line">        iv = [[UIImageView alloc] initWithImage:image];</span><br><span class="line">        [self addSubview:iv];</span><br><span class="line">        </span><br><span class="line">        //设置图片防止拉伸变形</span><br><span class="line">        self.contentMode = UIViewContentModeScaleAspectFill;</span><br><span class="line">        self.clipsToBounds = YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    UIImage *image = [UIImage imageNamed:@&quot;timeline_image_gif&quot;];</span><br><span class="line">    </span><br><span class="line">    CGFloat x = CGRectGetWidth(self.frame) - image.size.width;</span><br><span class="line">    CGFloat y = CGRectGetHeight(self.frame) - image.size.height;</span><br><span class="line">    </span><br><span class="line">    iv.frame = CGRectMake(x, y, image.size.width, image.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setImageURL:(NSString *)url &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 查看对应路径图片是否是gif后缀</span><br><span class="line">    if ([url hasSuffix:@&quot;gif&quot;]) &#123;</span><br><span class="line">        [self setGif];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self setNoGif];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //2. 加载网络图片</span><br><span class="line">    [self sd_setImageWithURL:[NSURL URLWithString:url] placeholderImage:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setGif &#123;</span><br><span class="line">    iv.hidden = NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setNoGif &#123;</span><br><span class="line">    iv.hidden = YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="自定义UITextView完成发送微博界面"><a href="#自定义UITextView完成发送微博界面" class="headerlink" title="自定义UITextView完成发送微博界面"></a>自定义UITextView完成发送微博界面</h3><h4 id="问题-自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象"><a href="#问题-自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象" class="headerlink" title="问题: 自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象"></a>问题: 自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象</h4><ul>
<li><p>原因: 因为外界可能也会设置，那么内部就无法完成代理回调了</p>
</li>
<li><p>解决: 内部使用注册通知完成回调</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">- (void)addNotifiactions &#123;</span><br><span class="line">    NSNotificationCenter *center = [NSNotificationCenter defaultCenter];</span><br><span class="line">    </span><br><span class="line">    [center addObserver:self</span><br><span class="line">               selector:@selector(testDidChanged:)</span><br><span class="line">                   name:UITextViewTextDidChangeNotification</span><br><span class="line">                 object:nil];</span><br><span class="line">    </span><br><span class="line">    [center addObserver:self</span><br><span class="line">               selector:@selector(testBeginEditing:)</span><br><span class="line">                   name:UITextViewTextDidBeginEditingNotification</span><br><span class="line">                 object:nil];</span><br><span class="line">    </span><br><span class="line">    [center addObserver:self</span><br><span class="line">               selector:@selector(testDidEndEdit:)</span><br><span class="line">                   name:UITextViewTextDidEndEditingNotification</span><br><span class="line">                 object:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)testDidChanged:(NSNotification *)notify</span><br><span class="line">&#123;</span><br><span class="line">    //通知系统执行drawRwct:</span><br><span class="line">    [self setNeedsDisplay];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)testBeginEditing:(NSNotification *)notify</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)testDidEndEdit:(NSNotification *)notify</span><br><span class="line">&#123;</span><br><span class="line">    [self setNeedsDisplay];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="问题-直接在画布区域绘制文字，不能显示"><a href="#问题-直接在画布区域绘制文字，不能显示" class="headerlink" title="问题: 直接在画布区域绘制文字，不能显示"></a>问题: 直接在画布区域绘制文字，不能显示</h4><ul>
<li><p>原因: 系统传入的rect在有导航栏时，rect.y向上偏移64，所以看不到</p>
</li>
<li><p>解决: 必须指定绘制rect.y &gt;= 0，才会显示处理啊</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (void)drawRect:(CGRect)rect</span><br><span class="line">&#123;</span><br><span class="line">    //dwawRect:方法每次执行时</span><br><span class="line">    //1. 会全部清除掉，之前画布上的所有图像全部</span><br><span class="line">    //2. 再将新的图像绘制上去</span><br><span class="line">    </span><br><span class="line">    if (!self.hasText) &#123;</span><br><span class="line">        </span><br><span class="line">        NSDictionary *attr = @&#123;</span><br><span class="line">                               NSFontAttributeName : [UIFont systemFontOfSize:14.f]</span><br><span class="line">                               &#125;;</span><br><span class="line">        </span><br><span class="line">        //drawAtPoint:只会单行绘制</span><br><span class="line">        //[_placeHolder drawAtPoint:CGPointZero withAttributes:attr];</span><br><span class="line">        </span><br><span class="line">        //drawInRect:在制定的CGRect内部绘制</span><br><span class="line">        CGFloat placeX = 5;</span><br><span class="line">        CGFloat placeY = 5;【必须指定y坐标大于0，才会显示文字，否则向上偏移64】</span><br><span class="line">        CGFloat placeW = rect.size.width - 2 * 5;</span><br><span class="line">        CGFloat placeH = rect.size.height - 2 * 5;</span><br><span class="line">        CGRect placeRect = CGRectMake(placeX, placeY, placeW, placeH);</span><br><span class="line">        [_placeHolder drawInRect:placeRect withAttributes:attr];</span><br><span class="line">        </span><br><span class="line">        //注意如下直接在画布区域绘制显示不出来</span><br><span class="line">        //原因: 系统传入的rect在有导航栏时，rect.y向上偏移64，所以看不到</span><br><span class="line">        //所以要让文字看到，必须指定绘制rect.y &gt;= 0，才会显示处理啊</span><br><span class="line">        //[_placeHolder drawInRect:rect withAttributes:attr];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="在键盘上方添加一个工具条ToolBar"><a href="#在键盘上方添加一个工具条ToolBar" class="headerlink" title="在键盘上方添加一个工具条ToolBar"></a>在键盘上方添加一个工具条ToolBar</h3><h4 id="图示效果-1"><a href="#图示效果-1" class="headerlink" title="图示效果"></a>图示效果</h4><p><img src="http://i12.tietuku.com/3eddf5c021ff4df6.png" alt></p>
<h4 id="首先自定义一个工具条ToolBar"><a href="#首先自定义一个工具条ToolBar" class="headerlink" title="首先自定义一个工具条ToolBar"></a>首先自定义一个工具条ToolBar</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface KeyboardToolBar : UIView</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;KeyboardToolBar.h&quot;</span><br><span class="line">#import &quot;UIView+FrameExt.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation KeyboardToolBar</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line"></span><br><span class="line">        [self setToolBarBackgroudColor];</span><br><span class="line">        </span><br><span class="line">        [self setupSubviews];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  设置背景色是一个图片的平铺</span><br><span class="line"> */</span><br><span class="line">- (void)setToolBarBackgroudColor &#123;</span><br><span class="line">    </span><br><span class="line">    self.backgroundColor = [UIColor colorWithPatternImage:[UIImage imageNamed:@&quot;compose_toolbar_background&quot;]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    //添加ToolBar上的6个按钮</span><br><span class="line">    </span><br><span class="line">    [self _addButtonWithNormalImage:@&quot;compose_camerabutton_background&quot; HilightImage:@&quot;compose_camerabutton_background_highlighted&quot;];</span><br><span class="line">    </span><br><span class="line">    [self _addButtonWithNormalImage:@&quot;compose_emoticonbutton_background&quot; HilightImage:@&quot;compose_emoticonbutton_background_highlighted&quot;];</span><br><span class="line">    </span><br><span class="line">    [self _addButtonWithNormalImage:@&quot;compose_keyboardbutton_background&quot; HilightImage:@&quot;compose_keyboardbutton_background_highlighted&quot;];</span><br><span class="line">    </span><br><span class="line">    [self _addButtonWithNormalImage:@&quot;compose_mentionbutton_background&quot; HilightImage:@&quot;compose_mentionbutton_background_highlighted&quot;];</span><br><span class="line">    </span><br><span class="line">    [self _addButtonWithNormalImage:@&quot;compose_toolbar_picture&quot; HilightImage:@&quot;compose_toolbar_picture_highlighted&quot;];</span><br><span class="line">    </span><br><span class="line">    [self _addButtonWithNormalImage:@&quot;compose_trendbutton_background&quot; HilightImage:@&quot;compose_trendbutton_background_highlighted&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)_addButtonWithNormalImage:(NSString *)normal HilightImage:(NSString *)hilght</span><br><span class="line">&#123;</span><br><span class="line">    UIButton *btn = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">    [btn setImage:[UIImage imageNamed:normal] forState:UIControlStateNormal];</span><br><span class="line">    [btn setImage:[UIImage imageNamed:hilght] forState:UIControlStateHighlighted];</span><br><span class="line">    [self addSubview:btn];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - </span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    //设置所有按钮的frame</span><br><span class="line">    </span><br><span class="line">    CGFloat x = 0;</span><br><span class="line">    CGFloat y = 0;</span><br><span class="line">    CGFloat w = self.width / self.subviews.count;</span><br><span class="line">    CGFloat h = self.height;</span><br><span class="line">    </span><br><span class="line">    for (NSInteger i = 0; i &lt; self.subviews.count; i++) &#123;</span><br><span class="line">        </span><br><span class="line">        UIButton *button = [self.subviews objectAtIndex:i];</span><br><span class="line">        </span><br><span class="line">        CGRect rect = CGRectMake(x + i * w,</span><br><span class="line">                                 y,</span><br><span class="line">                                 w,</span><br><span class="line">                                 h);</span><br><span class="line">        </span><br><span class="line">        button.frame = rect;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的inputAccessoryView"><a href="#在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的inputAccessoryView" class="headerlink" title="在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的inputAccessoryView"></a>在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的<code>inputAccessoryView</code></h4><ul>
<li>ViewController使用ToolBar</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@implementation WeiboSendViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //1. textView</span><br><span class="line">    [self.view addSubview:self.contentTextView];</span><br><span class="line">    </span><br><span class="line">    //2. 方法一、添加键盘工具栏</span><br><span class="line">    [self addToolBarDemo1];</span><br><span class="line">    </span><br><span class="line">    //3. 方法二、添加键盘工具栏</span><br><span class="line">//    [self addToolBarDemo2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addToolBarDemo1 &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 设置inputAccessoryView的宽度和高度，必须设置，否则无法显示</span><br><span class="line">    self.keyboardToolBar.width = self.view.width;</span><br><span class="line">    self.keyboardToolBar.height = 44;</span><br><span class="line">    </span><br><span class="line">    //2. 将自定义的toolbar设置为UITextView的 inputAccessoryView</span><br><span class="line">    self.contentTextView.inputAccessoryView = self.keyboardToolBar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>效果图</li>
</ul>
<p><img src="http://i12.tietuku.com/295783347c1cf3f7.png" alt></p>
<ul>
<li>缺点: <code>当键盘被移除时，上面的ToolBar也随之被移除不见.</code></li>
</ul>
<h4 id="在键盘上方显示ToolBar方法二、"><a href="#在键盘上方显示ToolBar方法二、" class="headerlink" title="在键盘上方显示ToolBar方法二、"></a>在键盘上方显示ToolBar方法二、</h4><ul>
<li>ViewController使用ToolBar</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@implementation WeiboSendViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //1. textView</span><br><span class="line">    [self.view addSubview:self.contentTextView];</span><br><span class="line">    </span><br><span class="line">    //2. 方法一、添加键盘工具栏</span><br><span class="line">    [self addToolBarDemo1];</span><br><span class="line">    </span><br><span class="line">    //3. 方法二、添加键盘工具栏</span><br><span class="line">//    [self addToolBarDemo2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addToolBarDemo2 &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 将ToolBar添加到控制器View上</span><br><span class="line">    [self.view addSubview:self.keyboardToolBar];</span><br><span class="line">    </span><br><span class="line">    //2. 设置ToolBar的frame</span><br><span class="line">    self.keyboardToolBar.frame  = CGRectMake(0,</span><br><span class="line">                                             self.view.height - 44,</span><br><span class="line">                                             self.view.width,</span><br><span class="line">                                             44);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>让ToolBar自己监听<code>键盘事件通知</code>处理自己的<code>originY坐标</code>，修改上面的ToolBar代码如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">	</span><br><span class="line">		//...</span><br><span class="line">		</span><br><span class="line">		//注册键盘通知</span><br><span class="line">		[self addNotifications];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addNotifications &#123;</span><br><span class="line">    </span><br><span class="line">    NSNotificationCenter *center = [NSNotificationCenter defaultCenter];</span><br><span class="line">    </span><br><span class="line">    //监听键盘Frame将要改变的通知</span><br><span class="line">    [center addObserver:self</span><br><span class="line">               selector:@selector(KeyboardWillChangeFrame:)</span><br><span class="line">                   name:UIKeyboardWillChangeFrameNotification</span><br><span class="line">                 object:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)KeyboardWillChangeFrame:(NSNotification *)notify</span><br><span class="line">&#123;</span><br><span class="line">    //1. 取出动画执行事件</span><br><span class="line">    CGFloat duration = [notify.userInfo[UIKeyboardAnimationDurationUserInfoKey] doubleValue];</span><br><span class="line">    </span><br><span class="line">    //2. 取出当前键盘的frame</span><br><span class="line">    CGRect keyboardFrame = [notify.userInfo[UIKeyboardFrameEndUserInfoKey] CGRectValue];</span><br><span class="line">    </span><br><span class="line">    //3. 执行修改y坐标的动画</span><br><span class="line">    [UIView animateWithDuration:duration animations:^&#123;</span><br><span class="line">        self.originY = keyboardFrame.origin.y - self.height;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//....</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>效果图</li>
</ul>
<p><img src="http://i12.tietuku.com/3eddf5c021ff4df6.png" alt></p>
<p><img src="http://i5.tietuku.com/a4e33ca62f62c847.png" alt></p>
<hr>
<h3 id="自定义一个表情键盘"><a href="#自定义一个表情键盘" class="headerlink" title="自定义一个表情键盘"></a>自定义一个表情键盘</h3><hr>
<h3 id="写一个选择图片的相册UI控件"><a href="#写一个选择图片的相册UI控件" class="headerlink" title="写一个选择图片的相册UI控件"></a>写一个选择图片的相册UI控件</h3><h4 id="第一步、首先，导入用于获取用户手机设备上所有图片资源的framework-–-AssetsLibrary-framework"><a href="#第一步、首先，导入用于获取用户手机设备上所有图片资源的framework-–-AssetsLibrary-framework" class="headerlink" title="第一步、首先，导入用于获取用户手机设备上所有图片资源的framework – AssetsLibrary.framework"></a>第一步、首先，导入用于获取用户手机设备上所有图片资源的framework – <code>AssetsLibrary.framework</code></h4><p><img src="http://i5.tietuku.com/5396552a69aea743.png" alt></p>
<h4 id="第二步、然后使用AssetsLibrary-framework获取"><a href="#第二步、然后使用AssetsLibrary-framework获取" class="headerlink" title="第二步、然后使用AssetsLibrary.framework获取"></a>第二步、然后使用<code>AssetsLibrary.framework</code>获取</h4><ul>
<li>所有的相册</li>
<li>每个相册的所有图片</li>
</ul>
<h4 id="第三步、使用UICollectionView-UICollectionViewCell显示读取到的所有图片UIImage"><a href="#第三步、使用UICollectionView-UICollectionViewCell显示读取到的所有图片UIImage" class="headerlink" title="第三步、使用UICollectionView+UICollectionViewCell显示读取到的所有图片UIImage"></a>第三步、使用<code>UICollectionView</code>+<code>UICollectionViewCell</code>显示读取到的所有图片UIImage</h4><h4 id="第四步、提供回调Block，回传选择的多张UIImage"><a href="#第四步、提供回调Block，回传选择的多张UIImage" class="headerlink" title="第四步、提供回调Block，回传选择的多张UIImage"></a>第四步、提供回调Block，回传选择的<code>多张UIImage</code></h4><hr>
<h3 id="自定义表情键盘"><a href="#自定义表情键盘" class="headerlink" title="自定义表情键盘"></a>自定义表情键盘</h3><h4 id="首先，理清楚UI的结构组成"><a href="#首先，理清楚UI的结构组成" class="headerlink" title="首先，理清楚UI的结构组成"></a>首先，理清楚UI的结构组成</h4><ul>
<li><p>键盘上方的工具条 <code>KeyboardToolBar : UIView</code></p>
</li>
<li><p>自定义表情键盘 <code>EmotionKeyBoard : UIView</code></p>
<ul>
<li><code>EmotionKeyboardContentView : UIView</code> ，键盘上方显示各种表情的滑动的容器View </li>
<li><code>EmotionKeyboardTabView : UIView</code>，键盘下方显示Tab选项的容器View</li>
</ul>
</li>
</ul>
<p><img src="http://i12.tietuku.com/295c15d39f695d1e.png" alt></p>
<h4 id="键盘上方的工具条"><a href="#键盘上方的工具条" class="headerlink" title="键盘上方的工具条"></a>键盘上方的工具条</h4><ul>
<li>贴在弹出键盘的上方</li>
<li>贴在控制器View的底部</li>
<li>工具条添加到制器View上</li>
</ul>
<h4 id="自定义键盘"><a href="#自定义键盘" class="headerlink" title="自定义键盘"></a>自定义键盘</h4><ul>
<li><p><code>UITextView.inputView = 我们自己的键盘View</code>，就可以显示我们自己的键盘View了</p>
</li>
<li><p><code>UITextView.inputView = nil</code>，就是显示系统键盘View</p>
</li>
<li><p>整个自定义键盘的大致UI结构</p>
</li>
</ul>
<p><img src="http://i12.tietuku.com/e464445c7384e7aa.png" alt></p>
<h4 id="自定义键盘底部选项卡按钮"><a href="#自定义键盘底部选项卡按钮" class="headerlink" title="自定义键盘底部选项卡按钮"></a>自定义键盘底部选项卡按钮</h4><p><img src="http://i5.tietuku.com/98b355eda0e47f60.png" alt></p>
<p><img src="http://i5.tietuku.com/61f86f3c4d8b909d.png" alt></p>
<ul>
<li>抽了一个UIButton的公共方法分类，快速创建一个设置各种属性的按钮对象</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface UIButton (Factory)</span><br><span class="line"></span><br><span class="line">+ (instancetype) buttonWithTitle:(NSString *)title</span><br><span class="line">                          Target:(id)target</span><br><span class="line">                        ClickSEL:(SEL)sel</span><br><span class="line">                          Normal:(NSString *)normal</span><br><span class="line">                         Hilight:(NSString *)hilight</span><br><span class="line">                        NormalBG:(NSString *)normalBg</span><br><span class="line">                       HilightBG:(NSString *)hilightBg</span><br><span class="line">                 NormalTextColor:(UIColor *)normaltextColor</span><br><span class="line">                HilightTextColor:(UIColor *)hilightTextColor</span><br><span class="line">                      TouchEvent:(UIControlEvents)events;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;UIButton+Factory.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation UIButton (Factory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ (instancetype) buttonWithTitle:(NSString *)title</span><br><span class="line">                        Target:(id)target</span><br><span class="line">                      ClickSEL:(SEL)sel</span><br><span class="line">                        Normal:(NSString *)normal</span><br><span class="line">                       Hilight:(NSString *)hilight</span><br><span class="line">                      NormalBG:(NSString *)normalBg</span><br><span class="line">                     HilightBG:(NSString *)hilightBg</span><br><span class="line">               NormalTextColor:(UIColor *)normaltextColor</span><br><span class="line">              HilightTextColor:(UIColor *)hilightTextColor</span><br><span class="line">                    TouchEvent:(UIControlEvents)events</span><br><span class="line">&#123;</span><br><span class="line">    id btn = [self buttonWithType:UIButtonTypeCustom];</span><br><span class="line"></span><br><span class="line">    [btn setTitle:title forState:UIControlStateNormal];</span><br><span class="line">    </span><br><span class="line">    [btn setTitleColor:normaltextColor forState:UIControlStateNormal];</span><br><span class="line">//    [btn setTitleColor:hilightTextColor forState:UIControlStateHighlighted];</span><br><span class="line">    [btn setTitleColor:hilightTextColor forState:UIControlStateSelected];</span><br><span class="line">    </span><br><span class="line">    [btn setImage:[UIImage imageNamed:normal] forState:UIControlStateNormal];</span><br><span class="line">    [btn setImage:[UIImage imageNamed:hilight] forState:UIControlStateSelected];</span><br><span class="line"></span><br><span class="line">    [btn setBackgroundImage:[UIImage imageNamed:normalBg] forState:UIControlStateNormal];</span><br><span class="line">    [btn setBackgroundImage:[UIImage imageNamed:hilightBg] forState:UIControlStateSelected];</span><br><span class="line">    </span><br><span class="line">    [btn addTarget:target action:sel forControlEvents:events];</span><br><span class="line">    </span><br><span class="line">    return btn;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>又抽了一个UIView分类，用来计算水平等宽度的subviews的frame计算</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface UIView (FrameExt)</span><br><span class="line"></span><br><span class="line">- (CGFloat)height;</span><br><span class="line">- (void)setHeight:(CGFloat)h;</span><br><span class="line"></span><br><span class="line">- (CGFloat)width;</span><br><span class="line">- (void)setWidth:(CGFloat)w;</span><br><span class="line"></span><br><span class="line">- (CGPoint)origin;</span><br><span class="line">- (void)setOrigin:(CGPoint)point;</span><br><span class="line"></span><br><span class="line">- (CGSize)size;</span><br><span class="line">- (void)setSize:(CGSize)size;</span><br><span class="line"></span><br><span class="line">- (CGFloat)originX;</span><br><span class="line">- (void)setOriginX:(CGFloat)x;</span><br><span class="line"></span><br><span class="line">- (CGFloat)originY;</span><br><span class="line">- (void)setOriginY:(CGFloat)y;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  返回所在九宫格的frame</span><br><span class="line"> */</span><br><span class="line">- (CGRect)getFrameWithRegionRect:(CGRect)rect</span><br><span class="line">                       ItemCount:(NSInteger)itemCount</span><br><span class="line">                 perRowItemCount:(NSInteger)perRowItemCount</span><br><span class="line">               perColumItemCount:(NSInteger)perColumItemCount</span><br><span class="line">                       itemWidth:(CGFloat)itemWidth</span><br><span class="line">                      itemHeight:(NSInteger)itemHeight</span><br><span class="line">                        paddingX:(CGFloat)paddingX</span><br><span class="line">                        paddingY:(CGFloat)paddingY</span><br><span class="line">                         atIndex:(NSInteger)index</span><br><span class="line">                          onPage:(NSInteger)page;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  水平等间距布局subviews</span><br><span class="line"> */</span><br><span class="line">- (void)horizenLayoutSubviews;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;UIView+FrameExt.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation UIView (FrameExt)</span><br><span class="line"></span><br><span class="line">- (CGSize)size &#123;</span><br><span class="line">    return self.frame.size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSize:(CGSize)size &#123;</span><br><span class="line">    CGRect frame = self.frame;</span><br><span class="line">    frame.size = size;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)height &#123;</span><br><span class="line">    return self.frame.size.height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setHeight:(CGFloat)h &#123;</span><br><span class="line">    CGRect frame = [self frame];</span><br><span class="line">    frame.size.height = h;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)width &#123;</span><br><span class="line">    return self.frame.size.width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setWidth:(CGFloat)w &#123;</span><br><span class="line">    CGRect frame = [self frame];</span><br><span class="line">    frame.size.width = w;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGPoint)origin &#123;</span><br><span class="line">    return self.frame.origin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setOrigin:(CGPoint)point &#123;</span><br><span class="line">    CGRect frame = [self frame];</span><br><span class="line">    frame.origin = point;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)originX &#123;</span><br><span class="line">    return self.frame.origin.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setOriginX:(CGFloat)x &#123;</span><br><span class="line">    CGRect frame = [self frame];</span><br><span class="line">    frame.origin.x = x;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)originY &#123;</span><br><span class="line">    return self.frame.origin.y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setOriginY:(CGFloat)y &#123;</span><br><span class="line">    CGRect frame = [self frame];</span><br><span class="line">    frame.origin.y = y;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGRect)getFrameWithRegionRect:(CGRect)rect</span><br><span class="line">                       ItemCount:(NSInteger)itemCount</span><br><span class="line">                 perRowItemCount:(NSInteger)perRowItemCount</span><br><span class="line">               perColumItemCount:(NSInteger)perColumItemCount</span><br><span class="line">                       itemWidth:(CGFloat)itemWidth</span><br><span class="line">                      itemHeight:(NSInteger)itemHeight</span><br><span class="line">                        paddingX:(CGFloat)paddingX</span><br><span class="line">                        paddingY:(CGFloat)paddingY</span><br><span class="line">                         atIndex:(NSInteger)index</span><br><span class="line">                          onPage:(NSInteger)page</span><br><span class="line">&#123;</span><br><span class="line">    //1. 计算得到总共几行</span><br><span class="line">    NSUInteger rowCount = itemCount / perRowItemCount + (itemCount % perColumItemCount &gt; 0 ? 1 : 0);</span><br><span class="line">    </span><br><span class="line">    //2. 得到顶部与底部的多余的高度</span><br><span class="line">    CGFloat insetY = (CGRectGetHeight(rect) - (itemHeight + paddingY) * rowCount) / 2.0;</span><br><span class="line">    </span><br><span class="line">    //3. 获取起点x坐标</span><br><span class="line">    CGFloat originX = (index % perRowItemCount) * (itemWidth + paddingX) + paddingX + (page * CGRectGetWidth(rect));</span><br><span class="line">    </span><br><span class="line">    //4. 获取起点y坐标</span><br><span class="line">    CGFloat originY = ((index / perRowItemCount) - perColumItemCount * page) * (itemHeight + paddingY) + paddingY;</span><br><span class="line">    </span><br><span class="line">    //5. 构造当前index的frame</span><br><span class="line">    CGRect itemFrame = CGRectMake(originX, originY + insetY, itemWidth, itemHeight);</span><br><span class="line">    </span><br><span class="line">    return itemFrame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)horizenLayoutSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    CGFloat x = 0;</span><br><span class="line">    CGFloat y = 0;</span><br><span class="line">    CGFloat w = self.width / self.subviews.count;</span><br><span class="line">    CGFloat h = self.height;</span><br><span class="line">    </span><br><span class="line">    for (NSInteger i = 0; i &lt; self.subviews.count; i++) &#123;</span><br><span class="line">        </span><br><span class="line">        UIView *subview = [self.subviews objectAtIndex:i];</span><br><span class="line">        </span><br><span class="line">        CGRect rect = CGRectMake(x + i * w,</span><br><span class="line">                                 y,</span><br><span class="line">                                 w,</span><br><span class="line">                                 h);</span><br><span class="line">        </span><br><span class="line">        subview.frame = rect;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>键盘底部选项卡容器View，里面添加多个按钮，水平等宽度布局，去掉按钮高亮状态，多个按钮同时只可以选中一个</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;EmotionKeyboardTabView.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;UIView+FrameExt.h&quot;</span><br><span class="line">#import &quot;UIButton+Factory.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;CancelHilightEventButton.h&quot;</span><br><span class="line"></span><br><span class="line">@interface EmotionKeyboardTabView ()</span><br><span class="line"></span><br><span class="line">//记录当前被点击选中的按钮</span><br><span class="line">@property (nonatomic, strong) CancelHilightEventButton *selectedButton;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EmotionKeyboardTabView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [self setupButtons];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//根据subview所在的位置，得到对应的背景图</span><br><span class="line">- (NSString *)getBackgroudImagePrefixNameWithSunbiewIndex:(NSInteger)index &#123;</span><br><span class="line">    </span><br><span class="line">    NSString *prefix = @&quot;&quot;;</span><br><span class="line">    </span><br><span class="line">    if (index == 0) &#123;//最左边</span><br><span class="line">        prefix = @&quot;compose_emotion_table_left&quot;;</span><br><span class="line">    &#125; else if (index == 3) &#123;//最右边</span><br><span class="line">        prefix = @&quot;compose_emotion_table_right&quot;;</span><br><span class="line">    &#125; else &#123;//中间</span><br><span class="line">        prefix = @&quot;compose_emotion_table_mid&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return prefix;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupButtons &#123;</span><br><span class="line">    </span><br><span class="line">    NSArray *titles = @[@&quot;最近&quot;,@&quot;默认&quot;,@&quot;Emoji&quot;,@&quot;小浪花&quot;];</span><br><span class="line">    </span><br><span class="line">    for (NSInteger index = 0; index &lt; 4; index++) &#123;</span><br><span class="line">        </span><br><span class="line">        NSString *prefix = [self getBackgroudImagePrefixNameWithSunbiewIndex:index];</span><br><span class="line">        NSString *bgNormal = [NSString stringWithFormat:@&quot;%@_normal&quot;, prefix];</span><br><span class="line">        NSString *bgHilight = [NSString stringWithFormat:@&quot;%@_selected&quot;, prefix];</span><br><span class="line">        </span><br><span class="line">        NSString *title = titles[index];</span><br><span class="line">        </span><br><span class="line">        CancelHilightEventButton *btn = [CancelHilightEventButton buttonWithTitle:title Target:self ClickSEL:@selector(buttonClick:) Normal:@&quot;&quot; Hilight:@&quot;&quot; NormalBG:bgNormal HilightBG:bgHilight NormalTextColor:[UIColor blackColor] HilightTextColor:[UIColor redColor] TouchEvent:UIControlEventTouchDown];</span><br><span class="line">        </span><br><span class="line">        //默认选中`默认`</span><br><span class="line">        if (index == 1) &#123;</span><br><span class="line">            [self buttonClick:btn];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        [self addSubview:btn];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)buttonClick:(CancelHilightEventButton *)btn &#123;</span><br><span class="line"></span><br><span class="line">	//按钮的选中切换三部曲</span><br><span class="line">    </span><br><span class="line">    //1. 之前选中的按钮取消选中</span><br><span class="line">    self.selectedButton.selected = NO;</span><br><span class="line">    </span><br><span class="line">    //2. 新点击的按钮选中</span><br><span class="line">    btn.selected = YES;</span><br><span class="line">    </span><br><span class="line">    //3. 记录当前新点击的按钮作为被点击的按钮</span><br><span class="line">    self.selectedButton = btn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    //调用UIView分类中的水平布局subviews的方法</span><br><span class="line">    [self horizenLayoutSubviews];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="读取表情文件"><a href="#读取表情文件" class="headerlink" title="读取表情文件"></a>读取表情文件</h3><h4 id="每一个表情都是使用Info-plist来配置"><a href="#每一个表情都是使用Info-plist来配置" class="headerlink" title="每一个表情都是使用Info.plist来配置"></a><code>每一个表情</code>都是使用<code>Info.plist</code>来配置</h4><ul>
<li>这个是表情系列1，对每一个表情的配置项</li>
</ul>
<p><img src="http://i12.tietuku.com/8ad4cf4fde60f72d.png" alt></p>
<ul>
<li>这个是表情系列2（emoji表情），对每一个表情的配置项</li>
</ul>
<p><img src="http://i12.tietuku.com/dd56e5924099630f.png" alt></p>
<h4 id="查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。"><a href="#查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。" class="headerlink" title="查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。"></a>查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。</h4><p><img src="http://i12.tietuku.com/f0900d861146fc51.png" alt></p>
<p><img src="http://i12.tietuku.com/922f9c7b02d301f7.png" alt></p>
<p><img src="http://i12.tietuku.com/71042278b899f81c.png" alt></p>
<h4 id="读取表情文件的info-plist"><a href="#读取表情文件的info-plist" class="headerlink" title="读取表情文件的info.plist"></a>读取表情文件的<code>info.plist</code></h4><ul>
<li>将表情资源文件拖到磁盘目录之后，再直接拖入到Xcode工程</li>
</ul>
<p><img src="http://i12.tietuku.com/1125d7686d649bb1.png" alt></p>
<ul>
<li>App打包后，查看<code>Main Bundle</code>程序包目录结构是否为如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- App名字（项目名）</span><br><span class="line">	- EmotionIcons 		（磁盘目录）</span><br><span class="line">		- default		（磁盘目录）</span><br><span class="line">		- emoji			（磁盘目录）</span><br><span class="line">		- lxh			（磁盘目录）</span><br></pre></td></tr></table></figure>
<ul>
<li>程序包目录结构对了之后，读取对应的目录下的info.plist加载表情</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray *)defaultArray &#123;</span><br><span class="line">    if (!_defaultArray) &#123;</span><br><span class="line">        NSString *path = [[NSBundle mainBundle] pathForResource:@&quot;EmotionIcons/default/info.plist&quot; ofType:nil];</span><br><span class="line">        _defaultArray = [NSArray arrayWithContentsOfFile:path];</span><br><span class="line">    &#125;</span><br><span class="line">    return _defaultArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray *)emojiArray &#123;</span><br><span class="line">    if (!_emojiArray) &#123;</span><br><span class="line">        NSString *path = [[NSBundle mainBundle] pathForResource:@&quot;EmotionIcons/emoji/info.plist&quot; ofType:nil];</span><br><span class="line">        _emojiArray = [NSArray arrayWithContentsOfFile:path];</span><br><span class="line">    &#125;</span><br><span class="line">    return _emojiArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray *)lxhArray &#123;</span><br><span class="line">    if (!_lxhArray) &#123;</span><br><span class="line">        NSString *path = [[NSBundle mainBundle] pathForResource:@&quot;EmotionIcons/lxh/info.plist&quot; ofType:nil];</span><br><span class="line">        _lxhArray = [NSArray arrayWithContentsOfFile:path];</span><br><span class="line">    &#125;</span><br><span class="line">    return _lxhArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="内部ScrollView布局每一个表情的思路"><a href="#内部ScrollView布局每一个表情的思路" class="headerlink" title="内部ScrollView布局每一个表情的思路"></a>内部ScrollView布局每一个表情的思路</h3><p><img src="http://i12.tietuku.com/bbc2c325330f33de.png" alt></p>
<ul>
<li><p><code>EmotionKeyboardContentView</code>内部包含两个subviews: </p>
<ul>
<li>1) <code>UIScrollView Container</code> </li>
<li>2) <code>自定义显示原点图片的UIPageControl</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  info.plit中的每一个表情配置项实体类</span><br><span class="line"> */</span><br><span class="line">@interface EmotionModel : NSObject</span><br><span class="line"></span><br><span class="line">//这两个key是给【default表情plist】和【lxh表情plist】</span><br><span class="line">@property (nonatomic, copy) NSString *chs;</span><br><span class="line">@property (nonatomic, copy) NSString *png;</span><br><span class="line"></span><br><span class="line">//这个key是给emoji表情plist</span><br><span class="line">@property (nonatomic, copy) NSString *code;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//------------------------------------------------------</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  表情键盘上方显示所有表情的容器View</span><br><span class="line"> */</span><br><span class="line">@interface EmotionKeyboardContentView : UIView</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  传入表情模型数组</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, strong) NSArray *dataList;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;EmotionKeyboardContentView.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;EmotionKeyboardPageControl.h&quot;</span><br><span class="line">#import &quot;EmotionKeyboradContentContainerView.h&quot;</span><br><span class="line"></span><br><span class="line">#import &quot;UIColor+Extend.h&quot;</span><br><span class="line">#import &quot;UIView+FrameExt.h&quot;</span><br><span class="line"></span><br><span class="line">#define kPageMaxCount 20</span><br><span class="line"></span><br><span class="line">@interface EmotionButton : UIButton</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EmotionButton</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface EmotionKeyboardContentView () &lt;UIScrollViewDelegate&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) UIScrollView *scrollView;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) EmotionKeyboardPageControl *pageControl;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EmotionKeyboardContentView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        </span><br><span class="line">        //1.</span><br><span class="line">        _pageControl = [[EmotionKeyboardPageControl alloc] init];</span><br><span class="line">        _pageControl.hidesForSinglePage = YES;</span><br><span class="line">//        _pageControl.backgroundColor = [UIColor redColor];</span><br><span class="line">        [self addSubview:_pageControl];</span><br><span class="line">        </span><br><span class="line">        //2. 注意，scrollView内部自带两个竖向和横向滚动的ImageView作为subview</span><br><span class="line">        _scrollView = [[UIScrollView alloc] init];</span><br><span class="line">        _scrollView.pagingEnabled = YES;</span><br><span class="line">        _scrollView.showsVerticalScrollIndicator = NO;//去掉竖向滚动条ImageView</span><br><span class="line">        _scrollView.showsHorizontalScrollIndicator = NO;//去掉横向滚动条ImageView</span><br><span class="line">//        _scrollView.backgroundColor = [UIColor blueColor];</span><br><span class="line">        _scrollView.delegate = self;</span><br><span class="line">        [self addSubview:_scrollView];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setDataList:(NSArray *)dataList &#123;</span><br><span class="line">    </span><br><span class="line">    //1.</span><br><span class="line">    _dataList = dataList;</span><br><span class="line">    </span><br><span class="line">    //2. 设置pageControl显示原点数</span><br><span class="line">    _pageControl.numberOfPages = (_dataList.count + kPageMaxCount - 1) / kPageMaxCount;</span><br><span class="line">    </span><br><span class="line">    //3. 每一页使用一个单独的UIView容器</span><br><span class="line">    for (NSInteger i = 0; i &lt; _pageControl.numberOfPages; i++) &#123;</span><br><span class="line">        </span><br><span class="line">        //3.1 创建一个container，管理一个页面所有的表情按钮</span><br><span class="line">        EmotionKeyboradContentContainerView *container = [[EmotionKeyboradContentContainerView alloc] init];</span><br><span class="line">        [_scrollView addSubview:container];</span><br><span class="line">        </span><br><span class="line">       //3.2 获取当前页要显示的表情子数组的截取范围</span><br><span class="line">        NSRange subRange;</span><br><span class="line">        subRange.location = i * kPageMaxCount;//起点</span><br><span class="line">        </span><br><span class="line">        BOOL isLastPage = ((_dataList.count - subRange.location) &lt; kPageMaxCount);</span><br><span class="line">        if (isLastPage) &#123;//最后一页需要判断长度</span><br><span class="line">            subRange.length = (_dataList.count - subRange.location);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            subRange.length = kPageMaxCount;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        //3.3 从dataList截取表情子数组</span><br><span class="line">        NSArray *subArray = [_dataList subarrayWithRange:subRange];</span><br><span class="line">        </span><br><span class="line">        //3.4 截取的子数组设置给容器View显示</span><br><span class="line">        [container setEmotions:subArray];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //4. 重新计算frame</span><br><span class="line">    [self setNeedsLayout];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 设置subviews的frame</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    CGFloat selfW = CGRectGetWidth(self.frame);</span><br><span class="line">    CGFloat selfH = CGRectGetHeight(self.frame);</span><br><span class="line">    </span><br><span class="line">    //1. 先确定底部固定高度的PageControl的frame</span><br><span class="line">    CGFloat pageControlX = 0;</span><br><span class="line">    CGFloat pageControlH = 44;</span><br><span class="line">    CGFloat pageControlY = selfH - pageControlH;</span><br><span class="line">    CGFloat pageControlW = selfW;</span><br><span class="line">    _pageControl.frame = CGRectMake(pageControlX, pageControlY, pageControlW, pageControlH);</span><br><span class="line">    </span><br><span class="line">    //2. 在确定上面的ScrollView的frame</span><br><span class="line">    CGFloat scrollViewX = 0;</span><br><span class="line">    CGFloat scrollViewY = 0;</span><br><span class="line">    CGFloat scrollViewW = selfW;</span><br><span class="line">    CGFloat scrollViewH = pageControlY;</span><br><span class="line">    _scrollView.frame = CGRectMake(scrollViewX, scrollViewY, scrollViewW, scrollViewH);</span><br><span class="line">    </span><br><span class="line">    //3. 布局scrollView内部每一页Container的frame</span><br><span class="line">    NSInteger index = 0;</span><br><span class="line">    for (UIView *container in _scrollView.subviews)</span><br><span class="line">    &#123;</span><br><span class="line">        CGFloat containerX = selfW * index;</span><br><span class="line">        CGFloat containerY = 0;</span><br><span class="line">        CGFloat containerW = scrollViewW;</span><br><span class="line">        CGFloat containerH = scrollViewH;</span><br><span class="line">        </span><br><span class="line">        container.frame = CGRectMake(containerX, containerY, containerW, containerH);</span><br><span class="line">        </span><br><span class="line">        index++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //4. 设置scrollView的contensize</span><br><span class="line">    _scrollView.contentSize = CGSizeMake(_scrollView.subviews.count * scrollViewW, 0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIScrollViewDelegate</span><br><span class="line"></span><br><span class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 获取当前scrollView滚动的x值，是在第几页</span><br><span class="line">    CGPoint point = scrollView.contentOffset;</span><br><span class="line"></span><br><span class="line">    //2.</span><br><span class="line">    if ((int)point.x &lt; 0) &#123;//滑动到最左边</span><br><span class="line">       </span><br><span class="line">        //2.1 得到最后一页的x</span><br><span class="line">        CGFloat lastPageX = scrollView.width * (scrollView.subviews.count - 1);</span><br><span class="line">        </span><br><span class="line">        //2.2 让ScrollView滚动到计算的x位置</span><br><span class="line">        [scrollView setContentOffset:CGPointMake(lastPageX, 0) animated:NO];</span><br><span class="line">        </span><br><span class="line">        //2.3 设置PageControl显示页号</span><br><span class="line">        _pageControl.currentPage = scrollView.subviews.count;</span><br><span class="line">        </span><br><span class="line">    &#125;else if ((int)point.x &gt; (scrollView.width * (scrollView.subviews.count - 1))) &#123;//滑动到最右边</span><br><span class="line">        </span><br><span class="line">        //2.1</span><br><span class="line">        [scrollView setContentOffset:CGPointMake(0, 0) animated:NO];</span><br><span class="line">        </span><br><span class="line">        //2.2</span><br><span class="line">        _pageControl.currentPage = 0;</span><br><span class="line">        </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">    </span><br><span class="line">        double pageNumber = point.x / scrollView.width;</span><br><span class="line">        </span><br><span class="line">        //2. 四舍五入计算的页号</span><br><span class="line">        int pageNo = (int)(pageNumber + 0.5);</span><br><span class="line">        </span><br><span class="line">        //3. 设置给UIPageControl显示页号</span><br><span class="line">        _pageControl.currentPage = pageNo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EmotionModel</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>自定义的PageControl，使用KVC设置原点图片</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  表情键盘上显示分页控制器器</span><br><span class="line"> */</span><br><span class="line">@interface EmotionKeyboardPageControl : UIPageControl</span><br><span class="line"></span><br><span class="line">//没有选中时原点的图片</span><br><span class="line">@property (nonatomic, strong) UIImage *normalImage;</span><br><span class="line"></span><br><span class="line">//选中时原点的图片</span><br><span class="line">@property (nonatomic, strong) UIImage *selectedImage;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;EmotionKeyboardPageControl.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation EmotionKeyboardPageControl</span><br><span class="line"></span><br><span class="line">- (UIImage *)normalImage &#123;</span><br><span class="line">    UIImage *normal = [UIImage imageNamed:@&quot;compose_keyboard_dot_normal&quot;];</span><br><span class="line">    return normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIImage *)hilightImage &#123;</span><br><span class="line">    UIImage *hilight = [UIImage imageNamed:@&quot;compose_keyboard_dot_selected&quot;];</span><br><span class="line">    return hilight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         *  使用KVC直接设置私有变量</span><br><span class="line">         */</span><br><span class="line">        [self setValue:[self normalImage] forKeyPath:@&quot;_pageImage&quot;];</span><br><span class="line">        [self setValue:[self hilightImage] forKeyPath:@&quot;_currentPageImage&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>EmotionKeyboradContentContainerView</code>内部包含一个UIScrollView，并接收一个<code>最大20个表情数组</code>.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface EmotionKeyboradContentContainerView : UIView</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSArray *emotions;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;EmotionKeyboradContentContainerView.h&quot;</span><br><span class="line">#import &quot;UIColor+Extend.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation EmotionKeyboradContentContainerView &#123;</span><br><span class="line">    </span><br><span class="line">    NSInteger _rowCount;</span><br><span class="line">    NSInteger _colCount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        </span><br><span class="line">        self.backgroundColor = [UIColor randomColor];</span><br><span class="line">        </span><br><span class="line">        //每行显示七个表情</span><br><span class="line">        _rowCount = 7;</span><br><span class="line">        </span><br><span class="line">        //每列显示三个</span><br><span class="line">        _colCount = 3;</span><br><span class="line">        </span><br><span class="line">        //那么总共显示21个表情</span><br><span class="line">        //但是每页只显示20个表情</span><br><span class="line">        //每一页最后空出来的右下角的位置，放删除按钮</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setEmotions:(NSArray *)emotions &#123;</span><br><span class="line">    _emotions = emotions;</span><br><span class="line">    </span><br><span class="line">    //1. 依次创建表情按钮subview</span><br><span class="line">    for (NSInteger i = 0; i &lt; emotions.count; i++) &#123;</span><br><span class="line">        UIButton *btn = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">        btn.backgroundColor = [UIColor randomColor];</span><br><span class="line">        [self addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //2. 重新计算frame</span><br><span class="line">    [self setNeedsLayout];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    //四周的内边距</span><br><span class="line">    CGFloat inset = 25;</span><br><span class="line">    </span><br><span class="line">    //每个按钮的宽度</span><br><span class="line">    CGFloat btnW = (CGRectGetWidth(self.frame) - 2 * inset) / _rowCount;</span><br><span class="line">    </span><br><span class="line">    //每个按钮的高度</span><br><span class="line">    CGFloat btnH = (CGRectGetHeight(self.frame) - 2 * inset) / _colCount;</span><br><span class="line">    </span><br><span class="line">    NSInteger count = _emotions.count;</span><br><span class="line">    </span><br><span class="line">    //依次设置被加入的所有按钮的frame</span><br><span class="line">    for (NSInteger i = 0; i &lt; count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        UIButton *btn = [self.subviews objectAtIndex:i];</span><br><span class="line">        </span><br><span class="line">        //所在行号</span><br><span class="line">        NSInteger rowNo = i / _rowCount;</span><br><span class="line">        </span><br><span class="line">        //所在列号</span><br><span class="line">        NSInteger colNo = i % _rowCount;</span><br><span class="line">        </span><br><span class="line">        //x坐标</span><br><span class="line">        CGFloat btnX = inset + btnW * colNo;</span><br><span class="line">        </span><br><span class="line">        //y坐标</span><br><span class="line">        CGFloat btnY = inset + btnH * rowNo;</span><br><span class="line">        </span><br><span class="line">        CGRect rect = CGRectMake(btnX, btnY, btnW, btnH);</span><br><span class="line">        </span><br><span class="line">        btn.frame = rect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>图示效果</li>
</ul>
<p><img src="http://i12.tietuku.com/13710bbad82028db.png" alt></p>
<p><img src="http://i12.tietuku.com/3e022f9015c517be.png" alt></p>
<p><img src="http://i12.tietuku.com/5fccdb55210f7725.png" alt></p>
<h4 id="接着上面在每一个表情按钮上填充图像"><a href="#接着上面在每一个表情按钮上填充图像" class="headerlink" title="接着上面在每一个表情按钮上填充图像"></a>接着上面在每一个表情按钮上填充图像</h4><ul>
<li>第一种、<code>非emoji</code>表情，已经给出了对于每一种表情的<code>png图片</code></li>
</ul>
<p><img src="http://i5.tietuku.com/fb49b514fe37b43d.png" alt></p>
<p><img src="http://i5.tietuku.com/fb49b514fe37b43d.png" alt></p>
<ul>
<li>第二种、<code>emoji</code>表情，<code>并没有</code>给出了对于每一种表情的<code>png图片</code>，只是一个<code>十六进制的数字</code></li>
</ul>
<p><img src="http://i5.tietuku.com/180ae0b0126a93eb.png" alt></p>
<ul>
<li>修改<code>EmotionKeyboradContentContainerView.m</code>如下代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)setEmotionModle:(EmotionModel *)model Button:(UIButton *)btn &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 显示emoji表情（显示的是一串`文字`）</span><br><span class="line">    if (model.code &amp;&amp; ![model.code isEqualToString:@&quot;&quot;]) &#123;</span><br><span class="line">        //1. 第一步、将emoji十六进制数字，解析成字符串</span><br><span class="line">        NSString *deCodeStr = [model.code emoji];</span><br><span class="line">        </span><br><span class="line">        //2. 第二步、将字符串设置给按钮的标题</span><br><span class="line">        [btn setTitle:deCodeStr forState:UIControlStateNormal];</span><br><span class="line">        </span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //2. 非emoji，直接由png属性显示图片</span><br><span class="line">    UIImage *emotionImage = [UIImage imageNamed:model.png];</span><br><span class="line">    [btn setImage:emotionImage forState:UIControlStateNormal];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="在网络上进行传输时，传输的是文字对应的十六进制数字，并不是直接传输图片或者字符串内容，大大减小流量"><a href="#在网络上进行传输时，传输的是文字对应的十六进制数字，并不是直接传输图片或者字符串内容，大大减小流量" class="headerlink" title="在网络上进行传输时，传输的是文字对应的十六进制数字，并不是直接传输图片或者字符串内容，大大减小流量"></a>在网络上进行传输时，传输的是文字对应的<code>十六进制数字</code>，并不是直接传输图片或者字符串内容，大大减小流量</h3><hr>
<h3 id="完成点击如上的表情按钮弹出一个View显示表情"><a href="#完成点击如上的表情按钮弹出一个View显示表情" class="headerlink" title="完成点击如上的表情按钮弹出一个View显示表情"></a>完成点击如上的表情按钮弹出一个View显示表情</h3><h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="http://i12.tietuku.com/c09ee0333cf59abf.png" alt></p>
<h4 id="自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片"><a href="#自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片" class="headerlink" title="自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片"></a>自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  每一个表情按钮被触摸时弹出显示的View</span><br><span class="line"> */</span><br><span class="line">@interface EmotionTouchDownView : UIImageView</span><br><span class="line"></span><br><span class="line">+ (UIImage *)bgImage;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;EmotionTouchDownView.h&quot;</span><br><span class="line"></span><br><span class="line">@interface EmotionTouchDownView ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) UIButton *button;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EmotionTouchDownView</span><br><span class="line"></span><br><span class="line">+ (UIImage *)bgImage &#123;</span><br><span class="line">    return [UIImage imageNamed:@&quot;emoticon_keyboard_magnifier&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithImage:(UIImage *)image &#123;</span><br><span class="line">    self = [super initWithImage:image];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [self initSubviews];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)initSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    //添加一个按钮，用来显示被点击的表情图片</span><br><span class="line">    _button = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">    [self addSubview:_button];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    CGFloat btnW = [[self class] bgImage].size.width;</span><br><span class="line">    CGFloat btnH = [[self class] bgImage].size.height / 2.0 - 10;</span><br><span class="line">    </span><br><span class="line">    _button.frame = CGRectMake(0, 0, btnW, btnH);</span><br><span class="line">    </span><br><span class="line">    CGFloat btnCenterX = CGRectGetWidth(self.frame) / 2.0;</span><br><span class="line">    CGFloat btnCenterY = [[self class] bgImage].size.height / 2.0;</span><br><span class="line">    CGPoint center = CGPointMake(btnCenterX, btnCenterY);</span><br><span class="line">    _button.center = center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="修改EmotionKeyboradContentContainerView，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码"><a href="#修改EmotionKeyboradContentContainerView，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码" class="headerlink" title="修改EmotionKeyboradContentContainerView，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码"></a>修改<code>EmotionKeyboradContentContainerView</code>，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - Button Action</span><br><span class="line"></span><br><span class="line">- (void)buttonClick:(UIButton *)button</span><br><span class="line">&#123;</span><br><span class="line">    //1. 移除之前显示的放大镜View</span><br><span class="line">    [self.touchDownView removeFromSuperview];</span><br><span class="line">    </span><br><span class="line">    //2. 添加到当前container view上</span><br><span class="line">    [self addSubview:self.touchDownView];</span><br><span class="line">    </span><br><span class="line">    //3. 记录被点击的按钮</span><br><span class="line">    _clickButton = button;</span><br><span class="line">    </span><br><span class="line">    //4. 重新计算frame</span><br><span class="line">    [self setNeedsLayout];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    //1. 先布局20个表情按钮</span><br><span class="line">    [self layoutAllEmotionButtons];</span><br><span class="line">    </span><br><span class="line">    //2. 布局弹出的表情View</span><br><span class="line">    [self layoutTouchDownView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutAllEmotionButtons &#123;</span><br><span class="line">    </span><br><span class="line">    //四周的内边距</span><br><span class="line">    CGFloat inset = 25;</span><br><span class="line">    </span><br><span class="line">    //每个按钮的宽度</span><br><span class="line">    CGFloat btnW = (CGRectGetWidth(self.frame) - 2 * inset) / _rowCount;</span><br><span class="line">    </span><br><span class="line">    //每个按钮的高度</span><br><span class="line">    CGFloat btnH = (CGRectGetHeight(self.frame) - 2 * inset) / _colCount;</span><br><span class="line">    </span><br><span class="line">    NSInteger count = _emotions.count;</span><br><span class="line">    </span><br><span class="line">    //依次设置被加入的所有按钮的frame</span><br><span class="line">    for (NSInteger i = 0; i &lt; count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        UIButton *btn = [self.subviews objectAtIndex:i];</span><br><span class="line">        </span><br><span class="line">        //所在行号</span><br><span class="line">        NSInteger rowNo = i / _rowCount;</span><br><span class="line">        </span><br><span class="line">        //所在列号</span><br><span class="line">        NSInteger colNo = i % _rowCount;</span><br><span class="line">        </span><br><span class="line">        //x坐标</span><br><span class="line">        CGFloat btnX = inset + btnW * colNo;</span><br><span class="line">        </span><br><span class="line">        //y坐标</span><br><span class="line">        CGFloat btnY = inset + btnH * rowNo;</span><br><span class="line">        </span><br><span class="line">        CGRect rect = CGRectMake(btnX, btnY, btnW, btnH);</span><br><span class="line">        </span><br><span class="line">        btn.frame = rect;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutTouchDownView &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 获取被点击的表情按钮的坐标</span><br><span class="line">    CGFloat clickButtonCenterX = CGRectGetMidX(_clickButton.frame);</span><br><span class="line">    CGFloat clickButtonCenterY = CGRectGetMidY(_clickButton.frame);</span><br><span class="line">    </span><br><span class="line">    //2. 计算弹出View的坐标</span><br><span class="line">    CGFloat touchViewCnterX = clickButtonCenterX;</span><br><span class="line">    CGFloat touchViewY = clickButtonCenterY - CGRectGetHeight(self.touchDownView.frame);</span><br><span class="line">    </span><br><span class="line">    self.touchDownView.centerX = touchViewCnterX;</span><br><span class="line">    self.touchDownView.originY = touchViewY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。"><a href="#修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。" class="headerlink" title="修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。"></a>修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。</h4><p><img src="http://i12.tietuku.com/7d1372273232c293.png" alt></p>
<h4 id="那么就需要把放大镜View添加到当前App程序的最上面的window中"><a href="#那么就需要把放大镜View添加到当前App程序的最上面的window中" class="headerlink" title="那么就需要把放大镜View添加到当前App程序的最上面的window中"></a>那么就需要把放大镜View添加到当前App程序的<code>最上面的window</code>中</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - Button Action</span><br><span class="line"></span><br><span class="line">- (void)buttonClick:(UIButton *)button</span><br><span class="line">&#123;</span><br><span class="line">    //1.</span><br><span class="line">    [self.touchDownView removeFromSuperview];</span><br><span class="line">    </span><br><span class="line">    //2.1 添加到当前View上，存在一个问题，就是点击最顶部的表情按钮时，touchDownView不能显示完全</span><br><span class="line">//    [self addSubview:self.touchDownView];</span><br><span class="line">    </span><br><span class="line">    //2.2 也不能添加到keyWindow，因为当前弹出了键盘，而键盘所在window在最上面</span><br><span class="line">    //...</span><br><span class="line">    </span><br><span class="line">    //2.3 只能添加到键盘View所在的window</span><br><span class="line">    UIWindow *window = [[UIApplication sharedApplication].windows lastObject];</span><br><span class="line">    NSLog(@&quot;window = %@\n&quot;, window);</span><br><span class="line">    [window addSubview:self.touchDownView];</span><br><span class="line">    </span><br><span class="line">    //3.</span><br><span class="line">    _clickButton = button;</span><br><span class="line">    </span><br><span class="line">    //4.</span><br><span class="line">    [self setNeedsLayout];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame"><a href="#然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame" class="headerlink" title="然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame."></a>然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    //1. 先布局20个表情按钮</span><br><span class="line">    [self layoutAllEmotionButtons];</span><br><span class="line">    </span><br><span class="line">    //2. 布局弹出的表情View</span><br><span class="line">    [self layoutTouchDownView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutAllEmotionButtons &#123;</span><br><span class="line"></span><br><span class="line">//..略</span><br><span class="line">//因为代码不变</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutTouchDownView &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 计算弹出View的坐标</span><br><span class="line">    </span><br><span class="line">    //这样得到的按钮的y值，是相对当前View对象，而不是UIWindow</span><br><span class="line">    //CGFloat clickButtonCenterX = CGRectGetMidX(_clickButton.frame);</span><br><span class="line">    //CGFloat touchViewCnterX = clickButtonCenterX;</span><br><span class="line">    //CGFloat touchViewY = clickButtonCenterY - CGRectGetHeight(self.touchDownView.frame);</span><br><span class="line">    </span><br><span class="line">    //1.1 将当前被点击按钮的frame，转换成相对UIWindow的坐标系的frame</span><br><span class="line">    CGRect convertRect = [_clickButton convertRect:_clickButton.bounds toView:self.touchDownView.superview];</span><br><span class="line">    </span><br><span class="line">    //1.2</span><br><span class="line">    CGFloat touchViewCnterX = CGRectGetMidX(convertRect);</span><br><span class="line">    </span><br><span class="line">    //1.3</span><br><span class="line">    CGFloat touchViewY = CGRectGetMidY(convertRect) - CGRectGetHeight(self.touchDownView.frame);</span><br><span class="line">    </span><br><span class="line">    //2. 设置frame</span><br><span class="line">    self.touchDownView.centerX = touchViewCnterX;</span><br><span class="line">    self.touchDownView.originY = touchViewY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="修改后的效果图"><a href="#修改后的效果图" class="headerlink" title="修改后的效果图"></a>修改后的效果图</h4><p><img src="http://i12.tietuku.com/344a4be7db6bb5c3.jpg" alt></p>
<hr>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><ul>
<li>一个ViewController的view添加另一个ViewController的View</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIViewController *vc1 = [[UIViewController alloc]  init];</span><br><span class="line">UIViewController *vc2 = [[UIViewController alloc]  init];</span><br><span class="line"></span><br><span class="line">//1.     </span><br><span class="line">[vc1.view addSubview:vc2.view];</span><br><span class="line"></span><br><span class="line">//2. 必须写，这样vc1处理到一些事件时，也能够传递给vc2</span><br><span class="line">[vc1 addChildViewController:vc2];</span><br></pre></td></tr></table></figure>
<ul>
<li>替换UIPageControl小圆点的两个状态的图片</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  表情键盘上显示分页控制器器</span><br><span class="line"> */</span><br><span class="line">@interface EmotionKeyboardPageControl : UIPageControl</span><br><span class="line"></span><br><span class="line">//没有选中时原点的图片</span><br><span class="line">@property (nonatomic, strong) UIImage *normalImage;</span><br><span class="line"></span><br><span class="line">//选中时原点的图片</span><br><span class="line">@property (nonatomic, strong) UIImage *selectedImage;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;EmotionKeyboardPageControl.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation EmotionKeyboardPageControl</span><br><span class="line"></span><br><span class="line">- (UIImage *)normalImage &#123;</span><br><span class="line">    UIImage *normal = [UIImage imageNamed:@&quot;compose_keyboard_dot_normal&quot;];</span><br><span class="line">    return normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIImage *)hilightImage &#123;</span><br><span class="line">    UIImage *hilight = [UIImage imageNamed:@&quot;compose_keyboard_dot_selected&quot;];</span><br><span class="line">    return hilight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         *  使用KVC直接设置私有变量</span><br><span class="line">         */</span><br><span class="line">        [self setValue:[self normalImage] forKeyPath:@&quot;_pageImage&quot;];</span><br><span class="line">        [self setValue:[self hilightImage] forKeyPath:@&quot;_currentPageImage&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="CUICatalog-Invalid-asset-name-supplied-错误警告"><a href="#CUICatalog-Invalid-asset-name-supplied-错误警告" class="headerlink" title="CUICatalog: Invalid asset name supplied:错误警告"></a><code>CUICatalog: Invalid asset name supplied:</code>错误警告</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">加载了一个不存在的图片文件</span><br><span class="line"></span><br><span class="line">如:</span><br><span class="line"></span><br><span class="line">UIImage *image = [UIImage ImageNamed:@&quot;不存在的图片&quot;];</span><br><span class="line"></span><br><span class="line">就会报如上警告.</span><br></pre></td></tr></table></figure>
<h3 id="UITextView基础使用"><a href="#UITextView基础使用" class="headerlink" title="UITextView基础使用"></a>UITextView基础使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">UITextView *textview = [[UITextView alloc] initWithFrame:CGRectMake(20, 10, 280, 30)];</span><br><span class="line">textview.backgroundColor=[UIColor whiteColor]; //背景色</span><br><span class="line">textview.scrollEnabled = NO;    //当文字超过视图的边框时是否允许滑动，默认为“YES”</span><br><span class="line">textview.editable = YES;        //是否允许编辑内容，默认为“YES”</span><br><span class="line">textview.delegate = self;       //设置代理方法的实现类</span><br><span class="line">textview.font=[UIFont fontWithName:@&quot;Arial&quot; size:18.0]; //设置字体名字和字体大小;</span><br><span class="line">textview.returnKeyType = UIReturnKeyDefault;//return键的类型</span><br><span class="line">textview.keyboardType = UIKeyboardTypeDefault;//键盘类型</span><br><span class="line">textview.textAlignment = NSTextAlignmentLeft; //文本显示的位置默认为居左</span><br><span class="line">textview.dataDetectorTypes = UIDataDetectorTypeAll; //显示数据类型的连接模式（如电话号码、网址、地址等）</span><br><span class="line">textview.textColor = [UIColor blackColor];</span><br><span class="line">textview.text = @&quot;UITextView详解&quot;;//设置显示的文本内容</span><br><span class="line">[self.view addSubview:textview];</span><br></pre></td></tr></table></figure>
<h3 id="UITextView的代理方法如下"><a href="#UITextView的代理方法如下" class="headerlink" title="UITextView的代理方法如下"></a>UITextView的代理方法如下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//将要开始编辑</span><br><span class="line">- (BOOL)textViewShouldBeginEditing:(UITextView *)textView;</span><br><span class="line"></span><br><span class="line">//将要结束编辑</span><br><span class="line">- (BOOL)textViewShouldEndEditing:(UITextView *)textView;</span><br><span class="line"></span><br><span class="line">//开始编辑</span><br><span class="line">- (void)textViewDidBeginEditing:(UITextView *)textView;</span><br><span class="line"></span><br><span class="line">//结束编辑</span><br><span class="line">- (void)textViewDidEndEditing:(UITextView *)textView;</span><br><span class="line"></span><br><span class="line">//内容将要发生改变编辑</span><br><span class="line">- (BOOL)textView:(UITextView *)textView shouldChangeTextInRange:(NSRange)range replacementText:(NSString *)text;</span><br><span class="line"></span><br><span class="line">//内容发生改变编辑</span><br><span class="line">- (void)textViewDidChange:(UITextView *)textView;</span><br><span class="line"></span><br><span class="line">//焦点发生改变</span><br><span class="line">- (void)textViewDidChangeSelection:(UITextView *)textView;</span><br></pre></td></tr></table></figure>
<h3 id="让UITextView自适应输入的文本的内容的高度"><a href="#让UITextView自适应输入的文本的内容的高度" class="headerlink" title="让UITextView自适应输入的文本的内容的高度"></a>让UITextView自适应输入的文本的内容的高度</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">只要在textViewDidChange的代理方法中加入调整控件大小</span><br><span class="line"></span><br><span class="line">- (void)textViewDidChange:(UITextView *)textView&#123;</span><br><span class="line">	</span><br><span class="line">	//1. 设置TextView文字显示的最大宽度和最大高度</span><br><span class="line">    CGSize constraintSize;</span><br><span class="line">    constraintSize.width = textView.frame.size.width-16;</span><br><span class="line">    constraintSize.height = MAXFLOAT;</span><br><span class="line">    </span><br><span class="line">    //2. 计算文本内容的高度</span><br><span class="line">    //调用上面写的字符串计算Size的方法</span><br><span class="line">    CGSize size = ...;</span><br><span class="line">    </span><br><span class="line">    //3. 重新调整textView的高度</span><br><span class="line">    CGFloat x = textView.frame.origin.x;</span><br><span class="line">    CGFloat y = textView.frame.origin.y;</span><br><span class="line">    CGFloat w = textView.frame.size.width;</span><br><span class="line">    CGFloat h = size.height;//计算得到的高度</span><br><span class="line">    </span><br><span class="line">    textView.frame = CGRectMake(x,y,w,h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="UITextView在光标所在处插入内容字符串"><a href="#UITextView在光标所在处插入内容字符串" class="headerlink" title="UITextView在光标所在处插入内容字符串"></a>UITextView在光标所在处插入内容字符串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UITextView *textView = ....;</span><br><span class="line"></span><br><span class="line">//使用如下方法即可</span><br><span class="line">[textView insertText:@&quot;&quot;];</span><br></pre></td></tr></table></figure>
<h3 id="UITextView往回删除内容"><a href="#UITextView往回删除内容" class="headerlink" title="UITextView往回删除内容"></a>UITextView往回删除内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[UITextView实例 deleteBackward];</span><br></pre></td></tr></table></figure>
<h3 id="将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString"><a href="#将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString" class="headerlink" title="将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString"></a>将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@interface SenWeiboView : UITextView</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  将UITextView内部的富文本字符串转换成普通字符串</span><br><span class="line"> *</span><br><span class="line"> *      1. emoji字符串</span><br><span class="line"> *      2. 图片富文本字符串</span><br><span class="line"> */</span><br><span class="line">- (NSString *)stringValue;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">@implementation SenWeiboView</span><br><span class="line"></span><br><span class="line">- (NSString *)stringValue</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableString *mStr = [[NSMutableString alloc] init];</span><br><span class="line">    </span><br><span class="line">    //遍历UItextView的富文本字符串</span><br><span class="line">    //每一个富文本字符串会被分成一段</span><br><span class="line">    [self.attributedText enumerateAttributesInRange:NSMakeRange(0, self.attributedText.length)</span><br><span class="line">                                            options:0</span><br><span class="line">                                         usingBlock:^(NSDictionary&lt;NSString *,id&gt; * _Nonnull attrs,</span><br><span class="line">                                                      NSRange range,</span><br><span class="line">                                                      BOOL * _Nonnull stop)</span><br><span class="line">    &#123;</span><br><span class="line">        //是否是图片附件富文本</span><br><span class="line">        NSTextAttachment *attachment = attrs[@&quot;NSAttachment&quot;];</span><br><span class="line">        </span><br><span class="line">        if (attachment) &#123;</span><br><span class="line">            //是图片附件富文本</span><br><span class="line">            //将图片富文本转换成对应的普通字符串</span><br><span class="line">            //1. 浪小花表情图片</span><br><span class="line">            //2. 默认表情图片</span><br><span class="line">            //3. 得到对应的info.plist中定义的字符串</span><br><span class="line">            //4. 拼接到mStr</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //不是图片附件富文本</span><br><span class="line">            //1. emoji文字表情</span><br><span class="line">            //2. 普通富文本（字体、效果...）</span><br><span class="line">            NSAttributedString *attsStr = [self.attributedText attributedSubstringFromRange:range];</span><br><span class="line">            //3. 转换成普通字符串</span><br><span class="line">            NSString *normalStr = [attsStr string];</span><br><span class="line">            //4. 拼接到mStr</span><br><span class="line">            [mStr appendString:normalStr];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    return [mStr copy];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="UITextView的如下两个属性"><a href="#UITextView的如下两个属性" class="headerlink" title="UITextView的如下两个属性"></a>UITextView的如下两个属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//1. 这个属性可以设置UITextView内部内容选中范围</span><br><span class="line">self.selectedRange;</span><br><span class="line">    </span><br><span class="line">//2. 这个属性不可以设置，但是通过修改上面的属性，达到修改这个属性</span><br><span class="line">self.selectedTextRange;</span><br></pre></td></tr></table></figure>
<h3 id="UITextView内部特殊文字点击做出响应的思路"><a href="#UITextView内部特殊文字点击做出响应的思路" class="headerlink" title="UITextView内部特殊文字点击做出响应的思路"></a>UITextView内部特殊文字点击做出响应的思路</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSArray *frameArray = [UITextView对象 selectionRectsForRange:&lt;#(nonnull UITextRange *)#&gt;]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">@implementation MyTextView</span><br><span class="line"></span><br><span class="line">- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123;</span><br><span class="line">    </span><br><span class="line">    //1. 取出点击的Point</span><br><span class="line">    CGPoint pt = [[touches anyObject] locationInView:self];</span><br><span class="line">    </span><br><span class="line">    //2. 假设值某一串特殊字符的Range（如: http://dawdawd.com.dawd/）</span><br><span class="line">    //这里需要在获取当前UITextView内部所有的特殊字符串的Range，并使用数组保存起来</span><br><span class="line">    NSRange range;</span><br><span class="line">    </span><br><span class="line">    //3. 让UITextView选中这个range的内容</span><br><span class="line">    self.selectedRange = range;</span><br><span class="line">    </span><br><span class="line">    //4. 得到TextView内部被点击的所有范围</span><br><span class="line">    NSArray *rects = [self selectionRectsForRange:self.selectedTextRange];</span><br><span class="line">    </span><br><span class="line">    //5. 取消TextView选中范围</span><br><span class="line">    self.selectedRange = NSMakeRange(0, 0);</span><br><span class="line">    </span><br><span class="line">    //6. 遍历得到的所有Rect，看当前点击的Point是在哪一个Rect</span><br><span class="line">    for (UITextSelectionRect *selectionRect in rects) &#123;</span><br><span class="line"></span><br><span class="line">        CGRect rect = selectionRect.rect;</span><br><span class="line">        </span><br><span class="line">        if (rect.size.width == 0 || rect.size.height == 0) continue;</span><br><span class="line">        </span><br><span class="line">        //看当前遍历的Rect是否包含当前触摸的Point</span><br><span class="line">        if (CGRectContainsPoint(rect, pt))</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            NSLog(@&quot;找到被点击的特殊字符的Rect了\n&quot;);</span><br><span class="line">            </span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="小结-Frame和显示的数据-随实体对象数据改变而动态更新的代码模板"><a href="#小结-Frame和显示的数据-随实体对象数据改变而动态更新的代码模板" class="headerlink" title="小结: Frame和显示的数据 随实体对象数据改变而动态更新的代码模板"></a>小结: Frame和显示的数据 随实体对象数据改变而动态更新的代码模板</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"User.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DemoView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) User *user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DemoView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DemoView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DemoView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	重写实体对象的setter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setUser:(User *)user &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.</span></span><br><span class="line">    _user = user;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. 更新UI的数据</span></span><br><span class="line">    [_label setText:user.screen_name];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3. 通知系统重新计算当前DemoView的frame</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsLayout];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  所有subviews的frame计算代码，都放在这里</span></span><br><span class="line"><span class="comment"> *  一旦调用setNeedsLayout方法，这个方法就会被执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  计算所有Subviews的frame</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">CGFloat</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> w = <span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.frame);</span><br><span class="line">    <span class="built_in">CGFloat</span> h = <span class="built_in">CGRectGetHeight</span>(<span class="keyword">self</span>.frame);</span><br><span class="line">    </span><br><span class="line">    _label.frame = <span class="built_in">CGRectMake</span>(x, y, w, h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="如果是需要通过drawRect形式绘制"><a href="#如果是需要通过drawRect形式绘制" class="headerlink" title="如果是需要通过drawRect形式绘制"></a>如果是需要通过drawRect形式绘制</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DemoView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DemoView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DemoView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setUser:(User *)user &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.</span></span><br><span class="line">    _user = user;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. 更新UI的数据</span></span><br><span class="line">    [_label setText:user.screen_name];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3. 通知系统重新计算当前DemoView的frame</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsLayout];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4. 通知系统重新绘制DemoView内部元素</span></span><br><span class="line">    [<span class="keyword">self</span> setNeedsDisplay];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  所有subviews的frame计算代码，都放在这里</span></span><br><span class="line"><span class="comment"> *  一旦调用setNeedsLayout方法，这个方法就会被执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  计算所有Subviews的frame</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">CGFloat</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> w = <span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.frame);</span><br><span class="line">    <span class="built_in">CGFloat</span> h = <span class="built_in">CGRectGetHeight</span>(<span class="keyword">self</span>.frame);</span><br><span class="line">    </span><br><span class="line">    _label.frame = <span class="built_in">CGRectMake</span>(x, y, w, h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//dwawRect:方法每次执行时</span></span><br><span class="line">    <span class="comment">//1. 会全部清除掉，之前画布上的所有图像全部</span></span><br><span class="line">    <span class="comment">//2. 再将新的图像绘制上去</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.hasText) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSDictionary</span> *attr = @&#123;</span><br><span class="line">                               <span class="built_in">NSFontAttributeName</span> : [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">14.</span>f]</span><br><span class="line">                               &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//drawAtPoint:只会单行绘制</span></span><br><span class="line">        <span class="comment">//[_placeHolder drawAtPoint:CGPointZero withAttributes:attr];</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//drawInRect:在制定的CGRect内部绘制</span></span><br><span class="line">        <span class="built_in">CGFloat</span> placeX = <span class="number">5</span>;</span><br><span class="line">        <span class="built_in">CGFloat</span> placeY = <span class="number">5</span>;【必须指定y坐标大于<span class="number">0</span>，才会显示文字，否则向上偏移<span class="number">64</span>】</span><br><span class="line">        <span class="built_in">CGFloat</span> placeW = rect.size.width - <span class="number">2</span> * <span class="number">5</span>;</span><br><span class="line">        <span class="built_in">CGFloat</span> placeH = rect.size.height - <span class="number">2</span> * <span class="number">5</span>;</span><br><span class="line">        <span class="built_in">CGRect</span> placeRect = <span class="built_in">CGRectMake</span>(placeX, placeY, placeW, placeH);</span><br><span class="line">        [_placeHolder drawInRect:placeRect withAttributes:attr];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//注意如下直接在画布区域绘制显示不出来</span></span><br><span class="line">        <span class="comment">//原因: 系统传入的rect在有导航栏时，rect.y向上偏移64，所以看不到</span></span><br><span class="line">        <span class="comment">//所以要让文字看到，必须指定绘制rect.y &gt;= 0，才会显示处理啊</span></span><br><span class="line">        <span class="comment">//[_placeHolder drawInRect:rect withAttributes:attr];</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/12/20/weibo/" data-title="weibo | 次元空间" data-tsina class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/2017/01/05/Ping-Host-Select-Best-NetworkConnection/" title="Ping Host Select Best NetworkConnection">
  <strong>上一篇：</strong><br>
  <span>
  Ping Host Select Best NetworkConnection</span>
</a>
</div>


<div class="next">
<a href="/2016/11/20/UIWindow/" title="UIWindow">
 <strong>下一篇：</strong><br> 
 <span>UIWindow
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/12/20/weibo/" data-title="weibo" data-url="http://yoursite.com/2016/12/20/weibo/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#找到一个ituns里面App的图片资源"><span class="toc-number">1.</span> <span class="toc-text">找到一个ituns里面App的图片资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#新浪服务器OAuth授权"><span class="toc-number">2.</span> <span class="toc-text">新浪服务器OAuth授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用于给定一个UIFont、最大宽度、最大高度、一个区域，来计算一段文字内容显示的size"><span class="toc-number">3.</span> <span class="toc-text">用于给定一个UIFont、最大宽度、最大高度、一个区域，来计算一段文字内容显示的size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义Cell的步骤"><span class="toc-number">4.</span> <span class="toc-text">自定义Cell的步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#举例微博Cell"><span class="toc-number">5.</span> <span class="toc-text">举例微博Cell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#首先弄基础Cell的类型"><span class="toc-number">5.1.</span> <span class="toc-text">首先弄基础Cell的类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带一张配图"><span class="toc-number">5.2.</span> <span class="toc-text">带一张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带三张配图"><span class="toc-number">5.3.</span> <span class="toc-text">带三张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带四张配图"><span class="toc-number">5.4.</span> <span class="toc-text">带四张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带九张配图"><span class="toc-number">5.5.</span> <span class="toc-text">带九张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带一张配图-1"><span class="toc-number">5.6.</span> <span class="toc-text">带一张配图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义Cell要显示数据的实体类模型"><span class="toc-number">5.7.</span> <span class="toc-text">定义Cell要显示数据的实体类模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在微博Cell上添加图片九宫格"><span class="toc-number">6.</span> <span class="toc-text">在微博Cell上添加图片九宫格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#给图片右下角添加识别为gif图片的功能"><span class="toc-number">7.</span> <span class="toc-text">给图片右下角添加识别为gif图片的功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图示效果"><span class="toc-number">7.1.</span> <span class="toc-text">图示效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现"><span class="toc-number">7.2.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义UITextView完成发送微博界面"><span class="toc-number">8.</span> <span class="toc-text">自定义UITextView完成发送微博界面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#问题-自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象"><span class="toc-number">8.1.</span> <span class="toc-text">问题: 自定义UItextView实例不能设置自己为UITextDelegate的代理实现对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题-直接在画布区域绘制文字，不能显示"><span class="toc-number">8.2.</span> <span class="toc-text">问题: 直接在画布区域绘制文字，不能显示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在键盘上方添加一个工具条ToolBar"><span class="toc-number">9.</span> <span class="toc-text">在键盘上方添加一个工具条ToolBar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图示效果-1"><span class="toc-number">9.1.</span> <span class="toc-text">图示效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#首先自定义一个工具条ToolBar"><span class="toc-number">9.2.</span> <span class="toc-text">首先自定义一个工具条ToolBar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的inputAccessoryView"><span class="toc-number">9.3.</span> <span class="toc-text">在键盘上方显示ToolBar方法一、直接将Toolbar设置为UITextView的inputAccessoryView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在键盘上方显示ToolBar方法二、"><span class="toc-number">9.4.</span> <span class="toc-text">在键盘上方显示ToolBar方法二、</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义一个表情键盘"><span class="toc-number">10.</span> <span class="toc-text">自定义一个表情键盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写一个选择图片的相册UI控件"><span class="toc-number">11.</span> <span class="toc-text">写一个选择图片的相册UI控件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#第一步、首先，导入用于获取用户手机设备上所有图片资源的framework-–-AssetsLibrary-framework"><span class="toc-number">11.1.</span> <span class="toc-text">第一步、首先，导入用于获取用户手机设备上所有图片资源的framework – AssetsLibrary.framework</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第二步、然后使用AssetsLibrary-framework获取"><span class="toc-number">11.2.</span> <span class="toc-text">第二步、然后使用AssetsLibrary.framework获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第三步、使用UICollectionView-UICollectionViewCell显示读取到的所有图片UIImage"><span class="toc-number">11.3.</span> <span class="toc-text">第三步、使用UICollectionView+UICollectionViewCell显示读取到的所有图片UIImage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第四步、提供回调Block，回传选择的多张UIImage"><span class="toc-number">11.4.</span> <span class="toc-text">第四步、提供回调Block，回传选择的多张UIImage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义表情键盘"><span class="toc-number">12.</span> <span class="toc-text">自定义表情键盘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#首先，理清楚UI的结构组成"><span class="toc-number">12.1.</span> <span class="toc-text">首先，理清楚UI的结构组成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#键盘上方的工具条"><span class="toc-number">12.2.</span> <span class="toc-text">键盘上方的工具条</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义键盘"><span class="toc-number">12.3.</span> <span class="toc-text">自定义键盘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义键盘底部选项卡按钮"><span class="toc-number">12.4.</span> <span class="toc-text">自定义键盘底部选项卡按钮</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读取表情文件"><span class="toc-number">13.</span> <span class="toc-text">读取表情文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#每一个表情都是使用Info-plist来配置"><span class="toc-number">13.1.</span> <span class="toc-text">每一个表情都是使用Info.plist来配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。"><span class="toc-number">13.2.</span> <span class="toc-text">查看表情的plist文件、以及每一个表情对应的图片文件。emoji表情只提供plist文件，没有提供表情对应的图片。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#读取表情文件的info-plist"><span class="toc-number">13.3.</span> <span class="toc-text">读取表情文件的info.plist</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内部ScrollView布局每一个表情的思路"><span class="toc-number">14.</span> <span class="toc-text">内部ScrollView布局每一个表情的思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#接着上面在每一个表情按钮上填充图像"><span class="toc-number">14.1.</span> <span class="toc-text">接着上面在每一个表情按钮上填充图像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在网络上进行传输时，传输的是文字对应的十六进制数字，并不是直接传输图片或者字符串内容，大大减小流量"><span class="toc-number">15.</span> <span class="toc-text">在网络上进行传输时，传输的是文字对应的十六进制数字，并不是直接传输图片或者字符串内容，大大减小流量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#完成点击如上的表情按钮弹出一个View显示表情"><span class="toc-number">16.</span> <span class="toc-text">完成点击如上的表情按钮弹出一个View显示表情</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图"><span class="toc-number">16.1.</span> <span class="toc-text">效果图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片"><span class="toc-number">16.2.</span> <span class="toc-text">自定义一个UIImangeView子类，显示放大镜的图片，并且显示表情图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改EmotionKeyboradContentContainerView，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码"><span class="toc-number">16.3.</span> <span class="toc-text">修改EmotionKeyboradContentContainerView，内部完成添加所有的表情按钮，所以在这里加上处理按钮事件的代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。"><span class="toc-number">16.4.</span> <span class="toc-text">修改后的效果图，发现点击最顶部的按钮时，不能出现放大镜View，被挡住了一部分。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#那么就需要把放大镜View添加到当前App程序的最上面的window中"><span class="toc-number">16.5.</span> <span class="toc-text">那么就需要把放大镜View添加到当前App程序的最上面的window中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame"><span class="toc-number">16.6.</span> <span class="toc-text">然后布局frame中，也需要转换坐标系，因为被添加到UIWindow中去了。我们需要将被点击按钮的frame，相对UIWindow作为坐标系，进行转换frame.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改后的效果图"><span class="toc-number">16.7.</span> <span class="toc-text">修改后的效果图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遇到的问题"><span class="toc-number">17.</span> <span class="toc-text">遇到的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CUICatalog-Invalid-asset-name-supplied-错误警告"><span class="toc-number">18.</span> <span class="toc-text">CUICatalog: Invalid asset name supplied:错误警告</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView基础使用"><span class="toc-number">19.</span> <span class="toc-text">UITextView基础使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView的代理方法如下"><span class="toc-number">20.</span> <span class="toc-text">UITextView的代理方法如下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#让UITextView自适应输入的文本的内容的高度"><span class="toc-number">21.</span> <span class="toc-text">让UITextView自适应输入的文本的内容的高度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView在光标所在处插入内容字符串"><span class="toc-number">22.</span> <span class="toc-text">UITextView在光标所在处插入内容字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView往回删除内容"><span class="toc-number">23.</span> <span class="toc-text">UITextView往回删除内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString"><span class="toc-number">24.</span> <span class="toc-text">将UITextView内部表情图片、Emoji文字表情、其他富文本字符串，转换成一个统一的普通字符串NSString</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView的如下两个属性"><span class="toc-number">25.</span> <span class="toc-text">UITextView的如下两个属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITextView内部特殊文字点击做出响应的思路"><span class="toc-number">26.</span> <span class="toc-text">UITextView内部特殊文字点击做出响应的思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结-Frame和显示的数据-随实体对象数据改变而动态更新的代码模板"><span class="toc-number">27.</span> <span class="toc-text">小结: Frame和显示的数据 随实体对象数据改变而动态更新的代码模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如果是需要通过drawRect形式绘制"><span class="toc-number">28.</span> <span class="toc-text">如果是需要通过drawRect形式绘制</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  

  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 业精于勤而荒于嬉，行成于思而毁于随 <br>
			天空不曾流过痕迹，但鸟儿已飞过天空</p>
	</section>
	 
	<div class="social-font">
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:codermoe@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="terriermon">terriermon</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"codermoe"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 









<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77667620-1', '');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
